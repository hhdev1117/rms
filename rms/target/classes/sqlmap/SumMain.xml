<?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<mapper namespace="com.daekyo.rms.sum.dao.SumMainDAO"> 

	<resultMap type="sumMainVO" id="sumMain1">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zlevel" 			property="zlevel" />
		<id column="zregion" 			property="zregion" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_id" 			property="zdept_id" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_emp_nm" 		property="zdept_emp_nm" />
		<id column="zbrch_emp_nm" 		property="zbrch_emp_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zdept_brch_nm" 		property="zdept_brch_nm" />
		<id column="zemp_id" 			property="zemp_id" />
		<id column="zemp_nm" 			property="zemp_nm" />
		<id column="zcls_id" 			property="zcls_id" />
		<id column="zcls_nm" 			property="zcls_nm" />
		<id column="zitem1_p" 			property="zitem1_p" />
		<id column="zitem2_p" 			property="zitem2_p" />
		<id column="zitem3_p" 			property="zitem3_p" />
		<id column="zitem4_p" 			property="zitem4_p" />
		<id column="zitem5_p" 			property="zitem5_p" />
		<id column="zitem6_p" 			property="zitem6_p" />
		<id column="zitem7_p" 			property="zitem7_p" />
		<id column="zadmin_rank1" 		property="zadmin_rank1" />
		<id column="zadmin_rank2" 		property="zadmin_rank2" />
		<id column="check_gb" 			property="check_gb" />
	</resultMap>
	
	<select id="getSumMoni" parameterType="HashMap" resultMap="sumMain1" > 
		WITH ORG_NM AS
		(
			 SELECT ZDEPT_ID, ZDEPT_BRCH_ID, ZDUTY_CDE, LISTAGG(ZNM, ',') WITHIN GROUP(ORDER BY ZNM) AS ZNM
			 FROM ZSD7_LOGIN A
			     , ZSD7_ORG_MT B
			 WHERE A.MANDT = '300' 
			 AND A.ZLOCK = '1' 
			 AND B.ZRCD_YM = #{zreq_ym}
			 AND A.MANDT = B.MANDT
			 AND A.KUNNR = B.ZEMP_ID
			 GROUP BY ZDEPT_ID, ZDEPT_BRCH_ID, ZDUTY_CDE
		)
		,RMS_TOTAL AS
		(
		    SELECT A.*
                  , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
                  , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
                  , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
                  , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
                  , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '2' AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID) AS ZBRCH_EMP_NM
                  , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
                  , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
				  , ZADMIN_RANK
				  , ZUP_RANK
		    FROM ZSD7_RMS_TOTAL A
                , (SELECT *
                   FROM ZSD7_RMS_ADMIN_R
                   WHERE MANDT = '300'
                   <choose>
						<when test='brch_gb == "LC"'>
							AND ZLEVEL IN ('1', '3')
						</when>
						<when test='brch_gb == "BL"'>
							AND ZLEVEL IN ('1', '2')
						</when>
						<otherwise>
							<if test='active_bcg_id == "N"'>
								AND ZLEVEL = '99'
							</if>
						</otherwise>
					</choose>
                   ) B
		    WHERE A.MANDT = '300'
		    AND A.ZRMS_YM = #{zreq_ym}
            AND A.MANDT = B.MANDT(+)
            AND A.ZRMS_YM = B.ZRMS_YM(+)
            AND A.ZLEVEL = B.ZLEVEL(+)
            AND A.ZREGION = B.ZREGION(+)
            AND A.ZDEPT_ID = B.ZDEPT_ID(+)
            AND A.ZDEPT_BRCH_ID = B.ZDEPT_BRCH_ID(+)
		    AND (
			        A.ZLEVEL = '1' OR 
			        A.ZLEVEL = '2' OR
			        (A.ZLEVEL = '3' 
			        <if test='brch_gb == "LC"'>
			            AND EXISTS (SELECT 1 FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = TO_CHAR(ADD_MONTHS(TO_DATE(A.ZRMS_YM, 'YYYYMM'), -1), 'YYYYMM') AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID)
			        </if>
			        <if test='brch_gb == "BL"'>   
			            AND NOT EXISTS (SELECT 1 FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID)
			        </if>
			        )
			    )
		    <if test='active_bcg_id == "N"'>
				AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802' OR A.ZREGION = 'T410')
			</if>
			<if test='active_bcg_id == "C"'>
				AND A.ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND A.ZREGION = 'T885'
			</if>
		), RMS_TOTAL_R AS
		(
			SELECT MANDT, ZITEM_RATE, ZITEM_ID
		    FROM ZSD7_RMS_TOTAL_R A
		    WHERE MANDT = '300'
		    AND ZRMS_YM = #{zreq_ym}
           <choose>
				<when test='brch_gb == "LC"'>
					 AND ZLEVEL = '3'
				</when>
				<when test='brch_gb == "BL"'>
					 AND ZLEVEL = '2'
				</when>
				<otherwise>
					<if test='active_bcg_id == "N"'>
						AND ZLEVEL = '99'
					</if>
				</otherwise>
			</choose>
		    <if test='active_bcg_id == "N"'>
				AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802' OR A.ZREGION = 'T410')
			</if>
			<if test='active_bcg_id == "C"'>
				AND A.ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND A.ZREGION = 'T885'
			</if>
		    ORDER BY ZITEM_ID, TO_NUMBER(ZITEM_RANK)
		)
		SELECT *
		FROM(
			-- 상위20%
			SELECT #{zreq_ym} AS ZRMS_YM, 'A' AS ZLEVEL, ' ' AS ZREGION, ' ' AS ZREGION_NM, ' ' AS ZDEPT_ID, ' ' AS ZDEPT_EMP_NM, ' ' AS ZDEPT_NM, ' ' AS ZBRCH_EMP_NM, ' ' AS ZDEPT_BRCH_ID, ' ' AS ZDEPT_BRCH_NM, ' ' AS ZEMP_ID, ' ' AS ZEMP_NM, ' ' AS ZCLS_ID, ' ' AS ZCLS_NM
			    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_info') WHERE RNUM = 
			       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_info')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM1_P
			    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_card') WHERE RNUM = 
			       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_card')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM2_P
			    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_tran') WHERE RNUM = 
			       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_tran')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM3_P
			    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_arre') WHERE RNUM = 
			        ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_arre')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM4_P
			    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_pay') WHERE RNUM = 
			       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_pay')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM5_P
			    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_summ') WHERE RNUM = 
			       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_summ')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM6_P
			    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_stmng') WHERE RNUM = 
			       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_stmng')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM7_P
			    , ' ' AS ZADMIN_RANK1
			    , ' ' AS ZADMIN_RANK2
                , 'Y' AS CHECK_GB
			FROM DUAL
		
			UNION ALL
			
			-- 평균
			SELECT #{zreq_ym} AS ZRMS_YM, 'B' AS ZLEVEL, ' ' AS ZREGION, ' ' AS ZREGION_NM, ' ' AS ZDEPT_ID, ' ' AS ZDEPT_EMP_NM, ' ' AS ZDEPT_NM, ' ' AS ZBRCH_EMP_NM, ' ' AS ZDEPT_BRCH_ID, ' ' AS ZDEPT_BRCH_NM, ' ' AS ZEMP_ID, ' ' AS ZEMP_NM, ' ' AS ZCLS_ID, ' ' AS ZCLS_NM
			    , RTRIM(TO_CHAR(ROUND(
                    CASE 
                        WHEN SUM(ZITEM1_S) = 0 OR SUM(ZITEM1_T) = 0
                        THEN 0
                        ELSE SUM(ZITEM1_S)/SUM(ZITEM1_T)*100
                    END   
                , 2), 'FM9990.00'), '.') AS ZITEM1_P
			    , RTRIM(TO_CHAR(ROUND(
                    CASE 
                        WHEN SUM(ZITEM2_S) = 0 OR SUM(ZITEM2_T) = 0
                        THEN 0
                        ELSE SUM(ZITEM2_S)/SUM(ZITEM2_T)*100
                    END   
                , 2), 'FM9990.00'), '.') AS ZITEM2_P
			    , RTRIM(TO_CHAR(ROUND(
                    CASE 
                        WHEN SUM(ZITEM3_S) = 0 OR SUM(ZITEM3_T) = 0
                        THEN 0
                        ELSE SUM(ZITEM3_S)/SUM(ZITEM3_T)*100
                    END   
                , 2), 'FM9990.00'), '.') AS ZITEM3_P
			    , RTRIM(TO_CHAR(ROUND(
                    CASE 
                        WHEN SUM(ZITEM4_S) = 0 OR SUM(ZITEM4_T) = 0
                        THEN 0
                        ELSE SUM(ZITEM4_S)/SUM(ZITEM4_T)*100
                    END   
                , 2), 'FM9990.00'), '.') AS ZITEM4_P
			    , RTRIM(TO_CHAR(ROUND(
                    CASE 
                        WHEN SUM(ZITEM5_S) = 0 OR SUM(ZITEM5_T) = 0
                        THEN 0
                        ELSE SUM(ZITEM5_S)/SUM(ZITEM5_T)*100
                    END   
                , 2), 'FM9990.00'), '.') AS ZITEM5_P
			    , RTRIM(TO_CHAR(ROUND(
                    CASE 
                        WHEN SUM(ZITEM6_S) = 0 OR SUM(ZITEM6_T) = 0
                        THEN 0
                        ELSE SUM(ZITEM6_S)/SUM(ZITEM6_T)*100
                    END   
                , 2), 'FM9990.00'), '.') AS ZITEM6_P
			    , RTRIM(TO_CHAR(ROUND(
                    CASE 
                        WHEN SUM(ZITEM7_S) = 0 OR SUM(ZITEM7_T) = 0
                        THEN 0
                        ELSE SUM(ZITEM7_S)/SUM(ZITEM7_T)*100
                    END   
                , 2), 'FM9990.00'), '.') AS ZITEM7_P
                , ' ' AS ZADMIN_RANK1
                , ' ' AS ZADMIN_RANK2
                , 'Y' AS CHECK_GB
		    FROM RMS_TOTAL A
		    WHERE MANDT = '300'
		    AND ZLEVEL = '1'
		
			UNION ALL
			
			<if test='session_zregion_gb == "A"'>
		    SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
			    , RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
			    , RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
			    , RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
			    , RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
			    , RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
			    , RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
			    , RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
	    		, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
	    		, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
	    		, 'Y' AS CHECK_GB
		    FROM RMS_TOTAL A
		    WHERE MANDT = '300'
		    AND ((ZLEVEL = '1' AND EXISTS (SELECT 1 FROM RMS_TOTAL WHERE MANDT = '300' AND ZRMS_YM = A.ZRMS_YM AND ZLEVEL = '2' AND ZREGION = A.ZREGION)) OR 
			     (ZLEVEL = '2' AND EXISTS (SELECT 1 FROM RMS_TOTAL WHERE MANDT = '300' AND ZRMS_YM = A.ZRMS_YM AND ZLEVEL = '3' AND ZREGION = A.ZREGION AND ZDEPT_ID = A.ZDEPT_ID)) OR
			      ZLEVEL = '3')
			</if>
			<if test='session_zregion_gb != "A"'>
				<if test='session_zauth_grp == "NI" or session_zauth_grp == "NX"'>
				SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, DECODE(ZREGION, #{session_zregion}, 'Y', 'N') AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  
				  UNION ALL
				  
				  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL IN ('2', '3')
				  AND ZREGION = #{session_zregion}
				</if>
				<if test='session_zauth_grp == "NC"'>
				 SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, DECODE(ZREGION, #{session_zregion}, 'Y', 'N') AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  AND ZREGION = #{session_zregion}
				  
				  UNION ALL
				  
				  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL IN ('2', '3')
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				</if>
				<if test='session_zauth_grp == "NP"'>
				 SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  AND ZREGION = #{session_zregion}
				  
				  UNION ALL
				  
				  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '2'
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				  
				  UNION ALL
				  
				  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
			    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '3'
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				</if>
			</if>
		)
		ORDER BY ZREGION, ZDEPT_ID NULLS FIRST, ZDEPT_BRCH_ID NULLS FIRST, ZEMP_ID NULLS FIRST, ZCLS_ID NULLS FIRST, ZLEVEL
	</select>
	
	<resultMap type="sumMainVO" id="sumMain3">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zlevel" 			property="zlevel" />
		<id column="zregion" 			property="zregion" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_id" 			property="zdept_id" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_emp_nm" 		property="zdept_emp_nm" />
		<id column="zbrch_emp_nm" 		property="zbrch_emp_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zdept_brch_nm" 		property="zdept_brch_nm" />
		<id column="zemp_id" 			property="zemp_id" />
		<id column="zemp_nm" 			property="zemp_nm" />
		<id column="zcls_id" 			property="zcls_id" />
		<id column="zcls_nm" 			property="zcls_nm" />
		<id column="zitem1_s" 			property="zitem1_s" />
		<id column="zitem2_s" 			property="zitem2_s" />
		<id column="zitem3_s" 			property="zitem3_s" />
		<id column="zitem4_s" 			property="zitem4_s" />
		<id column="zitem5_s" 			property="zitem5_s" />
		<id column="zitem6_s" 			property="zitem6_s" />
		<id column="zitem7_s" 			property="zitem7_s" />
		<id column="zadmin_rank1" 		property="zadmin_rank1" />
		<id column="zadmin_rank2" 		property="zadmin_rank2" />
		<id column="check_gb" 			property="check_gb" />
	</resultMap>
	
	<select id="getSumMoniForCount" parameterType="HashMap" resultMap="sumMain3" > 
		WITH ORG_NM AS
		(
			 SELECT ZDEPT_ID, ZDEPT_BRCH_ID, ZDUTY_CDE, LISTAGG(ZNM, ',') WITHIN GROUP(ORDER BY ZNM) AS ZNM
			 FROM ZSD7_LOGIN A
			     , ZSD7_ORG_MT B
			 WHERE A.MANDT = '300' 
			 AND A.ZLOCK = '1' 
			 AND B.ZRCD_YM = #{zreq_ym}
			 AND A.MANDT = B.MANDT
			 AND A.KUNNR = B.ZEMP_ID
			 GROUP BY ZDEPT_ID, ZDEPT_BRCH_ID, ZDUTY_CDE
		)
		,RMS_TOTAL AS
		(
		    SELECT A.*
                  , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
                  , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
                  , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
                  , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
                  , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '2' AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID) AS ZBRCH_EMP_NM
                  , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
                  , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
				  , ZADMIN_RANK
				  , ZUP_RANK
		    FROM ZSD7_RMS_TOTAL A
                , (SELECT *
                   FROM ZSD7_RMS_ADMIN_R
                   WHERE MANDT = '300'
                   <choose>
						<when test='brch_gb == "LC"'>
							AND ZLEVEL IN ('1', '3')
						</when>
						<when test='brch_gb == "BL"'>
							AND ZLEVEL IN ('1', '2')
						</when>
						<otherwise>
							<if test='active_bcg_id == "N"'>
								AND ZLEVEL = '99'
							</if>
						</otherwise>
					</choose>
                   ) B
		    WHERE A.MANDT = '300'
		    AND A.ZRMS_YM = #{zreq_ym}
            AND A.MANDT = B.MANDT(+)
            AND A.ZRMS_YM = B.ZRMS_YM(+)
            AND A.ZLEVEL = B.ZLEVEL(+)
            AND A.ZREGION = B.ZREGION(+)
            AND A.ZDEPT_ID = B.ZDEPT_ID(+)
            AND A.ZDEPT_BRCH_ID = B.ZDEPT_BRCH_ID(+)
		    AND (
			        A.ZLEVEL = '1' OR 
			        A.ZLEVEL = '2' OR
			        (A.ZLEVEL = '3' 
			        <if test='brch_gb == "LC"'>
			            AND EXISTS (SELECT 1 FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = TO_CHAR(ADD_MONTHS(TO_DATE(A.ZRMS_YM, 'YYYYMM'), -1), 'YYYYMM') AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID)
			        </if>
			        <if test='brch_gb == "BL"'>   
			            AND NOT EXISTS (SELECT 1 FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID)
			        </if>
			        )
			    )
		    <if test='active_bcg_id == "N"'>
				AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802' OR A.ZREGION = 'T410')
			</if>
			<if test='active_bcg_id == "C"'>
				AND A.ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND A.ZREGION = 'T885'
			</if>
		), RMS_TOTAL_R AS
		(
			SELECT MANDT, ZITEM_RATE, ZITEM_ID, ZLEVEL, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID
		    FROM ZSD7_RMS_TOTAL_R A
		    WHERE MANDT = '300'
		    AND ZRMS_YM = #{zreq_ym}
           <choose>
				<when test='brch_gb == "LC"'>
					 AND ZLEVEL = '3'
				</when>
				<when test='brch_gb == "BL"'>
					 AND ZLEVEL = '2'
				</when>
				<otherwise>
					<if test='active_bcg_id == "N"'>
						AND ZLEVEL = '99'
					</if>
				</otherwise>
			</choose>
		    <if test='active_bcg_id == "N"'>
				AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802' OR A.ZREGION = 'T410')
			</if>
			<if test='active_bcg_id == "C"'>
				AND A.ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND A.ZREGION = 'T885'
			</if>
		    ORDER BY ZITEM_ID, TO_NUMBER(ZITEM_RANK)
		)
		SELECT *
		FROM(
			-- 상위20%
			SELECT #{zreq_ym} AS ZRMS_YM, 'A' AS ZLEVEL, ' ' AS ZREGION, ' ' AS ZREGION_NM, ' ' AS ZDEPT_ID, ' ' AS ZDEPT_EMP_NM, ' ' AS ZDEPT_NM, ' ' AS ZBRCH_EMP_NM, ' ' AS ZDEPT_BRCH_ID, ' ' AS ZDEPT_BRCH_NM, ' ' AS ZEMP_ID, ' ' AS ZEMP_NM, ' ' AS ZCLS_ID, ' ' AS ZCLS_NM
 				 , TO_CHAR((SELECT (SELECT ZITEM1_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_arre') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_arre')*20/100))) AS ZITEM1_S
         	     , TO_CHAR((SELECT (SELECT ZITEM2_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_card') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_card')*20/100))) AS ZITEM2_S
         	     , TO_CHAR((SELECT (SELECT ZITEM3_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_info') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_info')*20/100))) AS ZITEM3_S
         	     , TO_CHAR((SELECT (SELECT ZITEM4_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_pay') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_pay')*20/100))) AS ZITEM4_S
         	     , TO_CHAR((SELECT (SELECT ZITEM5_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_stmng') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_stmng')*20/100))) AS ZITEM5_S
         	     , TO_CHAR((SELECT (SELECT ZITEM6_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_summ') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_summ')*20/100))) AS ZITEM6_S
         	     , TO_CHAR((SELECT (SELECT ZITEM7_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_tran') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_tran')*20/100))) AS ZITEM7_S
			    , ' ' AS ZADMIN_RANK1
			    , ' ' AS ZADMIN_RANK2
                , 'Y' AS CHECK_GB
			FROM DUAL
			
			UNION ALL
			
			<if test='session_zregion_gb == "A"'>
		    SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
				, TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
				, TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
				, TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
				, TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
				, TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
				, TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
				, TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
	    		, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
	    		, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
	    		, 'Y' AS CHECK_GB
		    FROM RMS_TOTAL A
		    WHERE MANDT = '300'
		    AND ((ZLEVEL = '1' AND EXISTS (SELECT 1 FROM RMS_TOTAL WHERE MANDT = '300' AND ZRMS_YM = A.ZRMS_YM AND ZLEVEL = '2' AND ZREGION = A.ZREGION)) OR 
			     (ZLEVEL = '2' AND EXISTS (SELECT 1 FROM RMS_TOTAL WHERE MANDT = '300' AND ZRMS_YM = A.ZRMS_YM AND ZLEVEL = '3' AND ZREGION = A.ZREGION AND ZDEPT_ID = A.ZDEPT_ID)) OR
			      ZLEVEL = '3')
			</if>
			<if test='session_zregion_gb != "A"'>
				<if test='session_zauth_grp == "NI" or session_zauth_grp == "NX"'>
				SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, DECODE(ZREGION, #{session_zregion}, 'Y', 'N') AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  
				  UNION ALL
				  
				  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL IN ('2', '3')
				  AND ZREGION = #{session_zregion}
				</if>
				<if test='session_zauth_grp == "NC"'>
				 SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, DECODE(ZREGION, #{session_zregion}, 'Y', 'N') AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  AND ZREGION = #{session_zregion}
				  
				  UNION ALL
				  
				  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL IN ('2', '3')
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				</if>
				<if test='session_zauth_grp == "NP"'>
				 SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  AND ZREGION = #{session_zregion}
				  
				  UNION ALL
				  
				  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '2'
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				  
				  UNION ALL
				  
				  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '3'
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				</if>
			</if>
		)
		ORDER BY ZREGION, ZDEPT_ID NULLS FIRST, ZDEPT_BRCH_ID NULLS FIRST, ZEMP_ID NULLS FIRST, ZCLS_ID NULLS FIRST, ZLEVEL
	</select>
	
	<select id="getSumMoniDtl" parameterType="HashMap" resultMap="sumMain1" > 
		SELECT *
		FROM(
		    SELECT ZRMS_YM, ZLEVEL
		    , ZREGION
		    , ' ' AS ZREGION_NM
		    , ' ' AS ZDEPT_EMP_NM
		    , ZDEPT_ID
            , ' ' ZDEPT_NM
            , ZDEPT_BRCH_ID
            , ZDEPT_BRCH_ID AS ZDEPT_BRCH_NM
            , ZEMP_ID
            , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
            , ZCLS_ID
            , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
			, TO_CHAR(DECODE(ZITEM1_S, '-1', '-', RTRIM(TO_CHAR(ROUND(ZITEM1_P, 2), 'FM9990.00'), '.') || '%')) AS ZITEM1_P
			, TO_CHAR(DECODE(ZITEM2_S, '-1', '-', RTRIM(TO_CHAR(ROUND(ZITEM2_P, 2), 'FM9990.00'), '.') || '%')) AS ZITEM2_P
			, TO_CHAR(DECODE(ZITEM3_S, '-1', '-', RTRIM(TO_CHAR(ROUND(ZITEM3_P, 2), 'FM9990.00'), '.') || '%')) AS ZITEM3_P
			, TO_CHAR(DECODE(ZITEM4_S, '-1', '-', RTRIM(TO_CHAR(ROUND(ZITEM4_P, 2), 'FM9990.00'), '.') || '%')) AS ZITEM4_P
			, TO_CHAR(DECODE(ZITEM5_S, '-1', '-', RTRIM(TO_CHAR(ROUND(ZITEM5_P, 2), 'FM9990.00'), '.') || '%')) AS ZITEM5_P
			, TO_CHAR(DECODE(ZITEM6_S, '-1', '-', RTRIM(TO_CHAR(ROUND(ZITEM6_P, 2), 'FM9990.00'), '.') || '%')) AS ZITEM6_P
			, TO_CHAR(DECODE(ZITEM7_S, '-1', '-', RTRIM(TO_CHAR(ROUND(ZITEM7_P, 2), 'FM9990.00'), '.') || '%')) AS ZITEM7_P
		    FROM ZSD7_RMS_TOTAL A
		    WHERE MANDT = '300'
		    AND ZLEVEL IN ('4', '5')
		    AND ZRMS_YM = #{zreq_ym}
		    AND ZREGION = #{zregion}
		    AND ZDEPT_ID = #{zdept_id}
		    AND ZDEPT_BRCH_ID = #{zdept_brch_id}

		)
		ORDER BY ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID, ZCLS_ID, ZLEVEL
	</select>
	
	<select id="getSumMoniDtlForCount" parameterType="HashMap" resultMap="sumMain3" > 
		SELECT *
		FROM(
		    SELECT ZRMS_YM, ZLEVEL
		    , ZREGION
		    , ' ' AS ZREGION_NM
		    , ' ' AS ZDEPT_EMP_NM
		    , ZDEPT_ID
            , ' ' ZDEPT_NM
            , ZDEPT_BRCH_ID
            , ZDEPT_BRCH_ID AS ZDEPT_BRCH_NM
            , ZEMP_ID
            , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
            , ZCLS_ID
            , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
			, TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
			, TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
			, TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
			, TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
			, TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
			, TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
			, TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
		    FROM ZSD7_RMS_TOTAL A
		    WHERE MANDT = '300'
		    AND ZLEVEL IN ('4', '5')
		    AND ZRMS_YM = #{zreq_ym}
		    AND ZREGION = #{zregion}
		    AND ZDEPT_ID = #{zdept_id}
		    AND ZDEPT_BRCH_ID = #{zdept_brch_id}

		)
		ORDER BY ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID, ZCLS_ID, ZLEVEL
	</select>
	
	<resultMap type="sumMainVO" id="sumMain2">
		<id column="zlevel" 			property="zlevel" />
		<id column="zregion" 			property="zregion" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_id" 			property="zdept_id" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_emp_nm" 		property="zdept_emp_nm" />
		<id column="zbrch_emp_nm" 		property="zbrch_emp_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zdept_brch_nm" 		property="zdept_brch_nm" />
		<id column="rms_arre_r" 		property="rms_arre_r" />
		<id column="rms_card_r" 		property="rms_card_r" />
		<id column="rms_info_r" 		property="rms_info_r" />
		<id column="rms_pay_r" 			property="rms_pay_r" />
		<id column="rms_stmng_r" 		property="rms_stmng_r" />
		<id column="rms_summ_r" 		property="rms_summ_r" />
		<id column="rms_tran_r" 		property="rms_tran_r" />
		<id column="zsub_rank" 			property="zsub_rank" />
		<id column="zup_rank" 			property="zup_rank" />
	</resultMap>
	
	<select id="getSumRank" parameterType="HashMap" resultMap="sumMain2" >
		WITH ORG_NM AS
		(
			 SELECT ZDEPT_ID, ZDEPT_BRCH_ID, ZDUTY_CDE, LISTAGG(ZNM, ',') WITHIN GROUP(ORDER BY ZNM) AS ZNM
			 FROM ZSD7_LOGIN A
			     , ZSD7_ORG_MT B
			 WHERE A.MANDT = '300' 
			 AND A.ZLOCK = '1' 
			 AND B.ZRCD_YM = #{zreq_ym}
			 AND A.MANDT = B.MANDT
			 AND A.KUNNR = B.ZEMP_ID
			 GROUP BY ZDEPT_ID, ZDEPT_BRCH_ID, ZDUTY_CDE
		)
		, RMS_TOTAL_R AS
		(
			SELECT MANDT, ZITEM_RANK, ZITEM_ID
		    FROM ZSD7_RMS_TOTAL_R A
		    WHERE MANDT = '300'
		    AND ZRMS_YM = #{zreq_ym}
           <choose>
				<when test='brch_gb == "LC"'>
					 AND ZLEVEL = '3'
				</when>
				<when test='brch_gb == "BL"'>
					 AND ZLEVEL = '2'
				</when>
				<otherwise>
					<if test='active_bcg_id == "N"'>
						AND ZLEVEL = '99'
					</if>
				</otherwise>
			</choose>
		    <if test='active_bcg_id == "N"'>
				AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802' OR A.ZREGION = 'T410')
			</if>
			<if test='active_bcg_id == "C"'>
				AND A.ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND A.ZREGION = 'T885'
			</if>
			ORDER BY ZITEM_ID, TO_NUMBER(ZITEM_RANK)
		)
		-- 상위20%
		SELECT 'A' AS ZLEVEL, ' ' AS ZREGION, ' ' AS ZREGION_NM, ' ' AS ZDEPT_ID, ' ' AS ZDEPT_EMP_NM, ' ' AS ZDEPT_NM, ' ' AS ZBRCH_EMP_NM, ' ' AS ZDEPT_BRCH_ID, ' ' AS ZDEPT_BRCH_NM
		    , TO_CHAR(ROUND((SELECT ZITEM_RANK FROM (SELECT ROWNUM AS RNUM, ZITEM_RANK FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_info') WHERE RNUM = 
		       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_info')/100*20) ), 2)) AS RMS_INFO_R
		    , TO_CHAR(ROUND((SELECT ZITEM_RANK FROM (SELECT ROWNUM AS RNUM, ZITEM_RANK FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_card') WHERE RNUM = 
		       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_card')/100*20) ), 2)) AS RMS_CARD_R
		    , TO_CHAR(ROUND((SELECT ZITEM_RANK FROM (SELECT ROWNUM AS RNUM, ZITEM_RANK FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_tran') WHERE RNUM = 
		       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_tran')/100*20) ), 2)) AS RMS_TRAN_R
		    , TO_CHAR(ROUND((SELECT ZITEM_RANK FROM (SELECT ROWNUM AS RNUM, ZITEM_RANK FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_arre') WHERE RNUM = 
		        ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_arre')/100*20) ), 2)) AS RMS_ARRE_R
		    , TO_CHAR(ROUND((SELECT ZITEM_RANK FROM (SELECT ROWNUM AS RNUM, ZITEM_RANK FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_pay') WHERE RNUM = 
		       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_pay')/100*20) ), 2)) AS RMS_PAY_R
		    , TO_CHAR(ROUND((SELECT ZITEM_RANK FROM (SELECT ROWNUM AS RNUM, ZITEM_RANK FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_summ') WHERE RNUM = 
		       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_summ')/100*20) ), 2)) AS RMS_SUMM_R
		    , TO_CHAR(ROUND((SELECT ZITEM_RANK FROM (SELECT ROWNUM AS RNUM, ZITEM_RANK FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_stmng') WHERE RNUM = 
		       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_stmng')/100*20) ), 2)) AS RMS_STMNG_R
		    , ' ' AS ZSUB_RANK
		    , ' ' AS ZUP_RANK
		FROM DUAL
		
		UNION ALL

		SELECT T1.ZLEVEL
			  , T1.ZREGION
			  , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = T1.ZREGION) AS ZREGION_NM
			  , T1.ZDEPT_ID
              , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = T1.ZDEPT_ID) AS ZDEPT_EMP_NM
              , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = T1.ZDEPT_ID) AS ZDEPT_NM
              , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '2' AND ZDEPT_ID = T1.ZDEPT_ID AND ZDEPT_BRCH_ID = T1.ZDEPT_BRCH_ID) AS ZBRCH_EMP_NM
              , T1.ZDEPT_BRCH_ID
              , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = '202112' AND ZDEPT_ID = T1.ZDEPT_ID AND ZDEPT_BRCH_ID = T1.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
              , TO_CHAR(T1.RMS_INFO_R) AS RMS_INFO_R
              , TO_CHAR(T1.RMS_CARD_R) AS RMS_CARD_R
              , TO_CHAR(T1.RMS_TRAN_R) AS RMS_TRAN_R
              , TO_CHAR(T1.RMS_ARRE_R) AS RMS_ARRE_R
              , TO_CHAR(T1.RMS_PAY_R) AS RMS_PAY_R
              , TO_CHAR(T1.RMS_SUMM_R) AS RMS_SUMM_R
              , TO_CHAR(T1.RMS_STMNG_R) AS RMS_STMNG_R
              , TO_CHAR(T1.ZSUB_RANK) AS ZSUB_RANK
              , TO_CHAR(T1.ZUP_RANK) AS ZUP_RANK
		FROM(
		    SELECT ZLEVEL
		    	  , ZREGION
		          , ZDEPT_ID
		          , ZDEPT_BRCH_ID
		          , SUM(RMS_ARRE_R) AS RMS_ARRE_R
		          , SUM(RMS_CARD_R) AS RMS_CARD_R
		          , SUM(RMS_INFO_R) AS RMS_INFO_R
		          , SUM(RMS_PAY_R) AS RMS_PAY_R
		          , SUM(RMS_STMNG_R) AS RMS_STMNG_R
		          , SUM(RMS_SUMM_R) AS RMS_SUMM_R
		          , SUM(RMS_TRAN_R) AS RMS_TRAN_R
		          , ZSUB_RANK
		          , ZUP_RANK
		    FROM(
		        SELECT A.ZLEVEL
		        	   , A.ZREGION
		               , A.ZDEPT_ID
		               , A.ZDEPT_BRCH_ID
		               , DECODE( A.ZITEM_ID, 'rms_arre', A.ZITEM_RANK, 0) AS RMS_ARRE_R
		               , DECODE( A.ZITEM_ID, 'rms_card', A.ZITEM_RANK, 0) AS RMS_CARD_R
		               , DECODE( A.ZITEM_ID, 'rms_info', A.ZITEM_RANK, 0) AS RMS_INFO_R
		               , DECODE( A.ZITEM_ID, 'rms_pay', A.ZITEM_RANK, 0) AS RMS_PAY_R
		               , DECODE( A.ZITEM_ID, 'rms_stmng', A.ZITEM_RANK, 0) AS RMS_STMNG_R
		               , DECODE( A.ZITEM_ID, 'rms_summ', A.ZITEM_RANK, 0) AS RMS_SUMM_R
		               , DECODE( A.ZITEM_ID, 'rms_tran', A.ZITEM_RANK, 0) AS RMS_TRAN_R
		               , B.ZSUB_RANK
		               , B.ZUP_RANK
		        FROM ZSD7_RMS_TOTAL_R A
		            , ZSD7_RMS_ADMIN_R B
		        WHERE A.MANDT = B.MANDT
		        AND A.ZRMS_YM = B.ZRMS_YM
		        AND A.ZLEVEL = B.ZLEVEL
		        AND A.ZREGION = B.ZREGION
		        AND A.ZDEPT_ID = B.ZDEPT_ID
		        AND A.ZDEPT_BRCH_ID = B.ZDEPT_BRCH_ID
		        <choose>
					<when test='brch_gb == "LC"'>
						AND A.ZLEVEL = '3'
					</when>
					<when test='brch_gb == "BL"'>
						AND A.ZLEVEL = '2'
					</when>
					<otherwise>
						<if test='active_bcg_id == "N"'>
							AND ZLEVEL = '99'
						</if>
					</otherwise>
				</choose>
		        AND A.ZRMS_YM = #{zreq_ym}
			    <if test='active_bcg_id == "N"'>
					AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802' OR A.ZREGION = 'T410')
				</if>
				<if test='active_bcg_id == "C"'>
					AND A.ZREGION = 'T880'
				</if>
				<if test='active_bcg_id == "S"'>
					AND A.ZREGION = 'T885'
				</if>
		        GROUP BY A.ZLEVEL, A.ZREGION, A.ZDEPT_ID, A.ZDEPT_BRCH_ID, A.ZITEM_ID, A.ZITEM_RANK, B.ZSUB_RANK, B.ZUP_RANK
		        )
		    GROUP BY ZLEVEL, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZSUB_RANK, ZUP_RANK
		    ) T1
		ORDER BY ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID
	</select>
	
	<resultMap type="sumMainVO" id="sumMain4">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zlevel" 			property="zlevel" />
		<id column="zregion" 			property="zregion" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_id" 			property="zdept_id" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_emp_nm" 		property="zdept_emp_nm" />
		<id column="zbrch_emp_nm" 		property="zbrch_emp_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zdept_brch_nm" 		property="zdept_brch_nm" />
		<id column="rms_arre_r" 		property="rms_arre_r" />
		<id column="rms_card_r" 		property="rms_card_r" />
		<id column="rms_info_r" 		property="rms_info_r" />
		<id column="rms_pay_r" 			property="rms_pay_r" />
		<id column="rms_stmng_r" 		property="rms_stmng_r" />
		<id column="rms_summ_r" 		property="rms_summ_r" />
		<id column="rms_tran_r" 		property="rms_tran_r" />
		<id column="zsub_rank" 			property="zsub_rank" />
		<id column="zup_rank" 			property="zup_rank" />
	</resultMap>
	
	<select id="getSumRankInd" parameterType="HashMap" resultMap="sumMain4" >
		WITH ORG_NM AS
		(
			 SELECT ZDEPT_ID, ZDEPT_BRCH_ID, ZDUTY_CDE, LISTAGG(ZNM, ',') WITHIN GROUP(ORDER BY ZNM) AS ZNM
			 FROM ZSD7_LOGIN A
			     , ZSD7_ORG_MT B
			 WHERE A.MANDT = '300' 
			 AND A.ZLOCK = '1' 
			 AND B.ZRCD_YM = #{zreq_ym}
			 AND A.MANDT = B.MANDT
			 AND A.KUNNR = B.ZEMP_ID
			 GROUP BY ZDEPT_ID, ZDEPT_BRCH_ID, ZDUTY_CDE
		)
		,RMS_TOTAL AS
		(
			SELECT *
			FROM(
			    SELECT A.*
	                  , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
	                  , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
	                  , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
	                  , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
	                  , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '2' AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID) AS ZBRCH_EMP_NM
	                  , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
	                  , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
					  , ZADMIN_RANK
					  , ZUP_RANK
			    FROM ZSD7_RMS_TOTAL A
	                , (SELECT *
	                   FROM ZSD7_RMS_ADMIN_R
	                   WHERE MANDT = '300'
	                   <choose>
							<when test='brch_gb == "LC"'>
								AND ZLEVEL IN ('1', '3')
							</when>
							<when test='brch_gb == "BL"'>
								AND ZLEVEL IN ('1', '2')
							</when>
							<otherwise>
								<if test='active_bcg_id == "N"'>
									AND ZLEVEL = '99'
								</if>
							</otherwise>
						</choose>
	                   ) B
			    WHERE A.MANDT = '300'
			    AND A.ZRMS_YM = #{zreq_ym}
	            AND A.MANDT = B.MANDT(+)
	            AND A.ZRMS_YM = B.ZRMS_YM(+)
	            AND A.ZLEVEL = B.ZLEVEL(+)
	            AND A.ZREGION = B.ZREGION(+)
	            AND A.ZDEPT_ID = B.ZDEPT_ID(+)
	            AND A.ZDEPT_BRCH_ID = B.ZDEPT_BRCH_ID(+)
			    AND (
				        A.ZLEVEL = '1' OR 
				        A.ZLEVEL = '2' OR
				        (A.ZLEVEL = '3' 
				        <if test='brch_gb == "LC"'>
				            AND EXISTS (SELECT 1 FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = TO_CHAR(ADD_MONTHS(TO_DATE(A.ZRMS_YM, 'YYYYMM'), -1), 'YYYYMM') AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID)
				        </if>
				        <if test='brch_gb == "BL"'>   
				            AND NOT EXISTS (SELECT 1 FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID)
				        </if>
				        )
				    )
			    <if test='active_bcg_id == "N"'>
					AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802' OR A.ZREGION = 'T410')
				</if>
				<if test='active_bcg_id == "C"'>
					AND A.ZREGION = 'T880'
				</if>
				<if test='active_bcg_id == "S"'>
					AND A.ZREGION = 'T885'
				</if>
			)
			WHERE ZADMIN_RANK IS NOT NULL
		), RMS_TOTAL_R AS
		(
			SELECT MANDT, ZITEM_RATE, ZITEM_ID
		    FROM ZSD7_RMS_TOTAL_R A
		    WHERE MANDT = '300'
		    AND ZRMS_YM = #{zreq_ym}
           <choose>
				<when test='brch_gb == "LC"'>
					 AND ZLEVEL = '3'
				</when>
				<when test='brch_gb == "BL"'>
					 AND ZLEVEL = '2'
				</when>
				<otherwise>
					<if test='active_bcg_id == "N"'>
						AND ZLEVEL = '99'
					</if>
				</otherwise>
			</choose>
		    <if test='active_bcg_id == "N"'>
				AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802' OR A.ZREGION = 'T410')
			</if>
			<if test='active_bcg_id == "C"'>
				AND A.ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND A.ZREGION = 'T885'
			</if>
		    ORDER BY ZITEM_ID, TO_NUMBER(ZITEM_RANK)
		)
		
		SELECT ZRMS_YM
			  , ZLEVEL
			  , ZREGION
			  , ZREGION_NM
			  , ZDEPT_ID
			  , ZDEPT_EMP_NM
			  , ZDEPT_NM
			  , ZBRCH_EMP_NM
			  , ZDEPT_BRCH_ID
			  , ZDEPT_BRCH_NM
			  , ZITEM1_P AS RMS_INFO_R
			  , ZITEM2_P AS RMS_CARD_R
			  , ZITEM3_P AS RMS_TRAN_R
			  , ZITEM4_P AS RMS_ARRE_R
			  , ZITEM5_P AS RMS_PAY_R
			  , ZITEM6_P AS RMS_SUMM_R
			  , ZITEM7_P AS RMS_STMNG_R
			  , ZADMIN_RANK1 AS ZSUB_RANK
			  , ZADMIN_RANK2 AS ZUP_RANK
		FROM(
			SELECT *
			FROM(
				-- 상위20%
				SELECT #{zreq_ym} AS ZRMS_YM, 'A' AS ZLEVEL, ' ' AS ZREGION, ' ' AS ZREGION_NM, ' ' AS ZDEPT_ID, ' ' AS ZDEPT_EMP_NM, ' ' AS ZDEPT_NM, ' ' AS ZBRCH_EMP_NM, ' ' AS ZDEPT_BRCH_ID, ' ' AS ZDEPT_BRCH_NM, ' ' AS ZEMP_ID, ' ' AS ZEMP_NM, ' ' AS ZCLS_ID, ' ' AS ZCLS_NM
				    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_info') WHERE RNUM = 
				       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_info')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM1_P
				    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_card') WHERE RNUM = 
				       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_card')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM2_P
				    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_tran') WHERE RNUM = 
				       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_tran')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM3_P
				    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_arre') WHERE RNUM = 
				        ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_arre')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM4_P
				    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_pay') WHERE RNUM = 
				       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_pay')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM5_P
				    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_summ') WHERE RNUM = 
				       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_summ')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM6_P
				    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_stmng') WHERE RNUM = 
				       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_stmng')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM7_P
				    , ' ' AS ZADMIN_RANK1
				    , ' ' AS ZADMIN_RANK2
	                , 'Y' AS CHECK_GB
				FROM DUAL
			
				UNION ALL
				
				-- 평균
				SELECT #{zreq_ym} AS ZRMS_YM, 'B' AS ZLEVEL, ' ' AS ZREGION, ' ' AS ZREGION_NM, ' ' AS ZDEPT_ID, ' ' AS ZDEPT_EMP_NM, ' ' AS ZDEPT_NM, ' ' AS ZBRCH_EMP_NM, ' ' AS ZDEPT_BRCH_ID, ' ' AS ZDEPT_BRCH_NM, ' ' AS ZEMP_ID, ' ' AS ZEMP_NM, ' ' AS ZCLS_ID, ' ' AS ZCLS_NM
				    , RTRIM(TO_CHAR(ROUND(
	                    CASE 
	                        WHEN SUM(ZITEM1_S) = 0 OR SUM(ZITEM1_T) = 0
	                        THEN 0
	                        ELSE SUM(ZITEM1_S)/SUM(ZITEM1_T)*100
	                    END   
	                , 2), 'FM9990.00'), '.') AS ZITEM1_P
				    , RTRIM(TO_CHAR(ROUND(
	                    CASE 
	                        WHEN SUM(ZITEM2_S) = 0 OR SUM(ZITEM2_T) = 0
	                        THEN 0
	                        ELSE SUM(ZITEM2_S)/SUM(ZITEM2_T)*100
	                    END   
	                , 2), 'FM9990.00'), '.') AS ZITEM2_P
				    , RTRIM(TO_CHAR(ROUND(
	                    CASE 
	                        WHEN SUM(ZITEM3_S) = 0 OR SUM(ZITEM3_T) = 0
	                        THEN 0
	                        ELSE SUM(ZITEM3_S)/SUM(ZITEM3_T)*100
	                    END   
	                , 2), 'FM9990.00'), '.') AS ZITEM3_P
				    , RTRIM(TO_CHAR(ROUND(
	                    CASE 
	                        WHEN SUM(ZITEM4_S) = 0 OR SUM(ZITEM4_T) = 0
	                        THEN 0
	                        ELSE SUM(ZITEM4_S)/SUM(ZITEM4_T)*100
	                    END   
	                , 2), 'FM9990.00'), '.') AS ZITEM4_P
				    , RTRIM(TO_CHAR(ROUND(
	                    CASE 
	                        WHEN SUM(ZITEM5_S) = 0 OR SUM(ZITEM5_T) = 0
	                        THEN 0
	                        ELSE SUM(ZITEM5_S)/SUM(ZITEM5_T)*100
	                    END   
	                , 2), 'FM9990.00'), '.') AS ZITEM5_P
				    , RTRIM(TO_CHAR(ROUND(
	                    CASE 
	                        WHEN SUM(ZITEM6_S) = 0 OR SUM(ZITEM6_T) = 0
	                        THEN 0
	                        ELSE SUM(ZITEM6_S)/SUM(ZITEM6_T)*100
	                    END   
	                , 2), 'FM9990.00'), '.') AS ZITEM6_P
				    , RTRIM(TO_CHAR(ROUND(
	                    CASE 
	                        WHEN SUM(ZITEM7_S) = 0 OR SUM(ZITEM7_T) = 0
	                        THEN 0
	                        ELSE SUM(ZITEM7_S)/SUM(ZITEM7_T)*100
	                    END   
	                , 2), 'FM9990.00'), '.') AS ZITEM7_P
	                , ' ' AS ZADMIN_RANK1
	                , ' ' AS ZADMIN_RANK2
	                , 'Y' AS CHECK_GB
			    FROM RMS_TOTAL A
			    WHERE MANDT = '300'
			    AND ZLEVEL = '1'
			
				UNION ALL
				
				<if test='session_zregion_gb == "A"'>
			    SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
				    , RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
				    , RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
				    , RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
				    , RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
				    , RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
				    , RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
				    , RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
		    		, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
		    		, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
		    		, 'Y' AS CHECK_GB
			    FROM RMS_TOTAL A
			    WHERE MANDT = '300'
				</if>
				<if test='session_zregion_gb != "A"'>
					<if test='session_zauth_grp == "NI" or session_zauth_grp == "NX"'>
					SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
				    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
				    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
				    	 	, DECODE(ZREGION, #{session_zregion}, 'Y', 'N') AS CHECK_GB
					  FROM RMS_TOTAL A
					  WHERE MANDT = '300'
					  AND ZLEVEL = '1'
					  
					  UNION ALL
					  
					  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
				    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
				    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
				    	 	, 'Y' AS CHECK_GB
					  FROM RMS_TOTAL A
					  WHERE MANDT = '300'
					  AND ZLEVEL IN ('2', '3')
					  AND ZREGION = #{session_zregion}
					</if>
					<if test='session_zauth_grp == "NC"'>
					 SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
				    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
				    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
				    	 	, DECODE(ZREGION, #{session_zregion}, 'Y', 'N') AS CHECK_GB
					  FROM RMS_TOTAL A
					  WHERE MANDT = '300'
					  AND ZLEVEL = '1'
					  AND ZREGION = #{session_zregion}
					  
					  UNION ALL
					  
					  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
				    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
				    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
				    	 	, 'Y' AS CHECK_GB
					  FROM RMS_TOTAL A
					  WHERE MANDT = '300'
					  AND ZLEVEL IN ('2', '3')
					  AND ZREGION = #{session_zregion}
					  AND ZDEPT_ID = #{session_zdept_id}
					</if>
					<if test='session_zauth_grp == "NP"'>
					 SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
				    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
				    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
				    	 	, 'Y' AS CHECK_GB
					  FROM RMS_TOTAL A
					  WHERE MANDT = '300'
					  AND ZLEVEL = '1'
					  AND ZREGION = #{session_zregion}
					  
					  UNION ALL
					  
					  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
				    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
				    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
				    	 	, 'Y' AS CHECK_GB
					  FROM RMS_TOTAL A
					  WHERE MANDT = '300'
					  AND ZLEVEL = '2'
					  AND ZREGION = #{session_zregion}
					  AND ZDEPT_ID = #{session_zdept_id}
					  
					  UNION ALL
					  
					  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
				    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
				    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
				    	 	, 'Y' AS CHECK_GB
					  FROM RMS_TOTAL A
					  WHERE MANDT = '300'
					  AND ZLEVEL = '3'
					  AND ZREGION = #{session_zregion}
					  AND ZDEPT_ID = #{session_zdept_id}
					</if>
				</if>
			)
			ORDER BY TO_NUMBER(DECODE(TRIM(ZLEVEL), 'A', 0, 'B', 0, (NVL(REPLACE(TRIM(ZADMIN_RANK1), '-', ''), 9999)))), ZREGION, ZDEPT_ID NULLS FIRST, ZDEPT_BRCH_ID NULLS FIRST, ZEMP_ID NULLS FIRST, ZCLS_ID NULLS FIRST, ZLEVEL
		)
		
	</select>
	
	<select id="getSumRankCnt" parameterType="HashMap" resultMap="sumMain4" > 
		WITH ORG_NM AS
		(
			 SELECT ZDEPT_ID, ZDEPT_BRCH_ID, ZDUTY_CDE, LISTAGG(ZNM, ',') WITHIN GROUP(ORDER BY ZNM) AS ZNM
			 FROM ZSD7_LOGIN A
			     , ZSD7_ORG_MT B
			 WHERE A.MANDT = '300' 
			 AND A.ZLOCK = '1' 
			 AND B.ZRCD_YM = #{zreq_ym}
			 AND A.MANDT = B.MANDT
			 AND A.KUNNR = B.ZEMP_ID
			 GROUP BY ZDEPT_ID, ZDEPT_BRCH_ID, ZDUTY_CDE
		)
		,RMS_TOTAL AS
		(
		    SELECT A.*
                  , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
                  , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
                  , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
                  , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
                  , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '2' AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID) AS ZBRCH_EMP_NM
                  , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
                  , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
				  , ZADMIN_RANK
				  , ZUP_RANK
		    FROM ZSD7_RMS_TOTAL A
                , (SELECT *
                   FROM ZSD7_RMS_ADMIN_R
                   WHERE MANDT = '300'
                   <choose>
						<when test='brch_gb == "LC"'>
							AND ZLEVEL IN ('1', '3')
						</when>
						<when test='brch_gb == "BL"'>
							AND ZLEVEL IN ('1', '2')
						</when>
						<otherwise>
							<if test='active_bcg_id == "N"'>
								AND ZLEVEL = '99'
							</if>
						</otherwise>
					</choose>
                   ) B
		    WHERE A.MANDT = '300'
		    AND A.ZRMS_YM = #{zreq_ym}
            AND A.MANDT = B.MANDT(+)
            AND A.ZRMS_YM = B.ZRMS_YM(+)
            AND A.ZLEVEL = B.ZLEVEL(+)
            AND A.ZREGION = B.ZREGION(+)
            AND A.ZDEPT_ID = B.ZDEPT_ID(+)
            AND A.ZDEPT_BRCH_ID = B.ZDEPT_BRCH_ID(+)
		    AND (
			        A.ZLEVEL = '1' OR 
			        A.ZLEVEL = '2' OR
			        (A.ZLEVEL = '3' 
			        <if test='brch_gb == "LC"'>
			            AND EXISTS (SELECT 1 FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = TO_CHAR(ADD_MONTHS(TO_DATE(A.ZRMS_YM, 'YYYYMM'), -1), 'YYYYMM') AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID)
			        </if>
			        <if test='brch_gb == "BL"'>   
			            AND NOT EXISTS (SELECT 1 FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID)
			        </if>
			        )
			    )
		    <if test='active_bcg_id == "N"'>
				AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802' OR A.ZREGION = 'T410')
			</if>
			<if test='active_bcg_id == "C"'>
				AND A.ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND A.ZREGION = 'T885'
			</if>
		), RMS_TOTAL_R AS
		(
			SELECT MANDT, ZITEM_RATE, ZITEM_ID, ZLEVEL, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID
		    FROM ZSD7_RMS_TOTAL_R A
		    WHERE MANDT = '300'
		    AND ZRMS_YM = #{zreq_ym}
           <choose>
				<when test='brch_gb == "LC"'>
					 AND ZLEVEL = '3'
				</when>
				<when test='brch_gb == "BL"'>
					 AND ZLEVEL = '2'
				</when>
				<otherwise>
					<if test='active_bcg_id == "N"'>
						AND ZLEVEL = '99'
					</if>
				</otherwise>
			</choose>
		    <if test='active_bcg_id == "N"'>
				AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802' OR A.ZREGION = 'T410')
			</if>
			<if test='active_bcg_id == "C"'>
				AND A.ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND A.ZREGION = 'T885'
			</if>
		    ORDER BY ZITEM_ID, TO_NUMBER(ZITEM_RANK)
		)
		SELECT ZRMS_YM
			  , ZLEVEL
			  , ZREGION
			  , ZREGION_NM
			  , ZDEPT_ID
			  , ZDEPT_EMP_NM
			  , ZDEPT_NM
			  , ZBRCH_EMP_NM
			  , ZDEPT_BRCH_ID
			  , ZDEPT_BRCH_NM
			  , TO_CHAR(ZITEM1_S) AS RMS_INFO_R  
			  , TO_CHAR(ZITEM2_S) AS RMS_CARD_R  
			  , TO_CHAR(ZITEM3_S) AS RMS_TRAN_R  
			  , TO_CHAR(ZITEM4_S) AS RMS_ARRE_R  
			  , TO_CHAR(ZITEM5_S) AS RMS_PAY_R   
			  , TO_CHAR(ZITEM6_S) AS RMS_SUMM_R  
			  , TO_CHAR(ZITEM7_S) AS RMS_STMNG_R 
			  , ZADMIN_RANK1 AS ZSUB_RANK
			  , ZADMIN_RANK2 AS ZUP_RANK
		FROM(
			-- 상위20%
			SELECT #{zreq_ym} AS ZRMS_YM, 'A' AS ZLEVEL, ' ' AS ZREGION, ' ' AS ZREGION_NM, ' ' AS ZDEPT_ID, ' ' AS ZDEPT_EMP_NM, ' ' AS ZDEPT_NM, ' ' AS ZBRCH_EMP_NM, ' ' AS ZDEPT_BRCH_ID, ' ' AS ZDEPT_BRCH_NM, ' ' AS ZEMP_ID, ' ' AS ZEMP_NM, ' ' AS ZCLS_ID, ' ' AS ZCLS_NM
 				 , TO_CHAR((SELECT (SELECT ZITEM1_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_arre') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_arre')*20/100))) AS ZITEM1_S
         	     , TO_CHAR((SELECT (SELECT ZITEM2_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_card') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_card')*20/100))) AS ZITEM2_S
         	     , TO_CHAR((SELECT (SELECT ZITEM3_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_info') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_info')*20/100))) AS ZITEM3_S
         	     , TO_CHAR((SELECT (SELECT ZITEM4_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_pay') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_pay')*20/100))) AS ZITEM4_S
         	     , TO_CHAR((SELECT (SELECT ZITEM5_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_stmng') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_stmng')*20/100))) AS ZITEM5_S
         	     , TO_CHAR((SELECT (SELECT ZITEM6_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_summ') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_summ')*20/100))) AS ZITEM6_S
         	     , TO_CHAR((SELECT (SELECT ZITEM7_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_tran') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_tran')*20/100))) AS ZITEM7_S
			    , ' ' AS ZADMIN_RANK1
			    , ' ' AS ZADMIN_RANK2
                , 'Y' AS CHECK_GB
			FROM DUAL
			
			UNION ALL
			
			<if test='session_zregion_gb == "A"'>
		    SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
				, TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
				, TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
				, TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
				, TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
				, TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
				, TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
				, TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
	    		, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
	    		, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
	    		, 'Y' AS CHECK_GB
		    FROM RMS_TOTAL A
		    WHERE MANDT = '300'
			</if>
			<if test='session_zregion_gb != "A"'>
				<if test='session_zauth_grp == "NI" or session_zauth_grp == "NX"'>
				SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, DECODE(ZREGION, #{session_zregion}, 'Y', 'N') AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  
				  UNION ALL
				  
				  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL IN ('2', '3')
				  AND ZREGION = #{session_zregion}
				</if>
				<if test='session_zauth_grp == "NC"'>
				 SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, DECODE(ZREGION, #{session_zregion}, 'Y', 'N') AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  AND ZREGION = #{session_zregion}
				  
				  UNION ALL
				  
				  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL IN ('2', '3')
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				</if>
				<if test='session_zauth_grp == "NP"'>
				 SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  AND ZREGION = #{session_zregion}
				  
				  UNION ALL
				  
				  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '2'
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				  
				  UNION ALL
				  
				  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '3'
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				</if>
			</if>
		)
		ORDER BY TO_NUMBER(DECODE(TRIM(ZLEVEL), 'A', 0, 'B', 0, (NVL(REPLACE(TRIM(ZADMIN_RANK1), '-', ''), 9999)))), ZREGION, ZDEPT_ID NULLS FIRST, ZDEPT_BRCH_ID NULLS FIRST, ZEMP_ID NULLS FIRST, ZCLS_ID NULLS FIRST, ZLEVEL
	</select>
	
</mapper>
