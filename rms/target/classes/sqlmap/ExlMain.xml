<?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<mapper namespace="com.daekyo.rms.exl.dao.ExlMainDAO"> 

	<!-- ********************************************** -->
	<!-- 엑셀다운 로그 입력								-->
	<!-- ********************************************** -->
	<insert id="insertExcelLog">
		INSERT INTO ZSD7_EXCEL_LOG
		(    MANDT
			,ZINDATE
			,ZINTIME
			,ZLOGIN_ID
			,ZAUTH_GRP
			,ZMENU_URL
			,ZMENUID
			,ZMENUNM
			,ZPAGEID
			,VKBUR
			,VKGRP
			,KUNNR
			,ZGRID_CNT
			,ZDIS_YN
			,ZDIS_DTIME
			,ZDIS_ID
			,ZDIS_KUNNR
			,ZERDAT
		    ,ZERZET
		    ,ZAEDAT
		    ,ZAEZET
		    ,ZAGREE_YN
		) VALUES (
		    '300'
		    ,TO_CHAR(SYSDATE, 'YYYYMMDD')
		    ,TO_CHAR(SYSDATE, 'HH24MISS')
		    ,NVL(#{session_zlogin_id}, ' ')
		    ,NVL(#{session_zauth_grp}, ' ')
		    ,NVL(#{zmenu_url}, ' ')
		    ,(SELECT ZMENU_ID FROM ZSD7_RMS_MENU WHERE MANDT = '300' AND ZAUTH_GB = #{session_zauth_grp} AND ZMENU_URL = #{zmenu_url} AND ROWNUM = 1)
		    ,(SELECT ZMENU_NM FROM ZSD7_RMS_MENU WHERE MANDT = '300' AND ZAUTH_GB = #{session_zauth_grp} AND ZMENU_URL = #{zmenu_url} AND ROWNUM = 1)
		    ,(SELECT ZPAGE_ID FROM ZSD7_RMS_MENU WHERE MANDT = '300' AND ZAUTH_GB = #{session_zauth_grp} AND ZMENU_URL = #{zmenu_url} AND ROWNUM = 1)
		    ,NVL(#{session_zdept_id}, ' ')
		    ,NVL(#{session_zdept_brch_id}, ' ')
		    ,NVL(NVL(TRIM(#{session_zemp_id}), #{session_zlogin_id}), ' ')
		    ,#{rowcnt}
		    ,'N'
		    ,' '
		    ,' '
		    ,' '
		    ,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
		    ,NVL(#{session_zlogin_id}, ' ')
		    ,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
		    ,NVL(#{session_zlogin_id}, ' ')
		    ,'Y'
		)
	</insert>

	<!-- ********************************************** -->
	<!-- [ 현장용 ] 카드결제 현황 엑셀다운				-->
	<!-- ********************************************** -->
	<resultMap type="exlCardPaymentVO" id="exlCardPayment_d">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zcard_nm" 			property="zcard_nm" />
		<id column="zcard_no" 			property="zcard_no" />
		<id column="zemp_nm"			property="zemp_nm" />
		<id column="zemp_id" 			property="zemp_id" />
		<id column="zauth_grp" 			property="zauth_grp" />
		<id column="kunnr" 				property="kunnr" />
		<id column="zmbr_nm" 			property="zmbr_nm" />
		<id column="zgrade_cde" 		property="zgrade_cde" />
		<id column="matnr_nm" 			property="matnr_nm" />
		<id column="matnr" 				property="matnr" />
		<id column="zapprv_dt" 			property="zapprv_dt" />
		<id column="zapprv_no" 			property="zapprv_no" />
		<id column="zcard_amt" 			property="zcard_amt" />
	</resultMap>
	
	<select id="excelCardPayment_d" parameterType="HashMap" resultMap="exlCardPayment_d" > 
		SELECT ZRMS_YM
		      , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		      , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		      , ZDEPT_BRCH_ID || DECODE(TRIM(ZLC_NM), '', ' ', '(' || ZLC_NM || ')') AS ZDEPT_BRCH_ID
		      , ZCARD_NM
		      , SUBSTR(TO_CHAR(SCP.DEC_B64('DAMO','SID','ACCOUNT_CODE',ZCARD_NO)), -4) AS ZCARD_NO
              , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
			  , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
			  , DECODE((SELECT ZAUTH_GRP FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = ZEMP_ID AND ROWNUM = 1), 'NC', '사업국장', 'NE', '행정교사', 'NP', '팀장', 'NT', '교사') AS ZAUTH_GRP
			  , KUNNR
			  , ZMBR_NM
		      , ZGRADE_CDE
		      , (SELECT MAKTX FROM MAKT WHERE MANDT = '300' AND MATNR = A.MATNR) AS MATNR_NM
		      , MATNR
		      , ZAPPRV_DT
		      , ZAPPRV_NO
		      , ZCARD_AMT
		FROM ZSD7_RMS_CARD_D A
		WHERE MANDT = '300'
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802' OR ZREGION = 'T410') -- T410 : 성장사업본부
			</if>
			<if test='active_bcg_id == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			<if test='zregion != null and zregion != ""'>
				AND ZREGION = #{zregion}
			</if>
			<if test='zdept_id != null and zdept_id != ""'>
				AND ZDEPT_ID = #{zdept_id}
			</if>
			<if test='zdept_brch_id != null and zdept_brch_id != ""'>
				AND ZDEPT_BRCH_ID = #{zdept_brch_id}
			</if>
			<if test='zemp_id != null and zemp_id != ""'>
				AND ZEMP_ID = #{zemp_id}
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			<if test='session_zregion_gb == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802')
			</if>
			<if test='session_zregion_gb == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='session_zregion_gb == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			
			<if test="session_zauth_grp == 'NI' or session_zauth_grp == 'NX'">
				AND ZREGION = #{session_zregion}
				<if test='zdept_id != null and zdept_id != ""'>
					AND ZDEPT_ID = #{zdept_id}
				</if>
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if> 
			<if test="session_zauth_grp == 'NC' or session_zauth_grp == 'NE'">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
			<if test="session_zauth_grp == 'NP' ">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				AND ZDEPT_BRCH_ID = #{session_zdept_brch_id}
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
		</if>
		ORDER BY ZRMS_YM DESC, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 관리용 ] 카드결제 현황 엑셀다운				-->
	<!-- ********************************************** -->
	<resultMap type="exlCardPaymentVO" id="exlCardPayment_da">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zcard_nm" 			property="zcard_nm" />
		<id column="zcard_no" 			property="zcard_no" />
		<id column="zemp_nm"			property="zemp_nm" />
		<id column="zemp_id" 			property="zemp_id" />
		<id column="zauth_grp" 			property="zauth_grp" />
		<id column="kunnr" 				property="kunnr" />
		<id column="zmbr_nm" 			property="zmbr_nm" />
		<id column="zgrade_cde" 		property="zgrade_cde" />
		<id column="matnr_nm" 			property="matnr_nm" />
		<id column="matnr" 				property="matnr" />
		<id column="zapprv_dt" 			property="zapprv_dt" />
		<id column="zapprv_no" 			property="zapprv_no" />
		<id column="zcard_amt" 			property="zcard_amt" />
		<id column="zadmin_etc" 		property="zadmin_etc" />
	</resultMap>
	
	<select id="excelCardPayment_da" parameterType="HashMap" resultMap="exlCardPayment_da" > 
		SELECT ZRMS_YM
		      , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		      , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		      , ZDEPT_BRCH_ID || DECODE(TRIM(ZLC_NM), '', ' ', '(' || ZLC_NM || ')') AS ZDEPT_BRCH_ID
		      , ZCARD_NM
		      , SUBSTR(TO_CHAR(SCP.DEC_B64('DAMO','SID','ACCOUNT_CODE',ZCARD_NO)), -4) AS ZCARD_NO
              , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
			  , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
			  , DECODE((SELECT ZAUTH_GRP FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = ZEMP_ID AND ROWNUM = 1), 'NC', '사업국장', 'NE', '행정교사', 'NP', '팀장', 'NT', '교사') AS ZAUTH_GRP
			  , KUNNR
			  , ZMBR_NM
		      , ZGRADE_CDE
		      , (SELECT MAKTX FROM MAKT WHERE MANDT = '300' AND MATNR = A.MATNR) AS MATNR_NM
		      , MATNR
		      , ZAPPRV_DT
		      , ZAPPRV_NO
		      , ZCARD_AMT
		      , ZADMIN_ETC
		FROM ZSD7_RMS_CARD_DA A
		WHERE MANDT = '300'
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802' OR ZREGION = 'T410') -- T410 : 성장사업본부
			</if>
			<if test='active_bcg_id == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			<if test='zregion != null and zregion != ""'>
				AND ZREGION = #{zregion}
			</if>
			<if test='zdept_id != null and zdept_id != ""'>
				AND ZDEPT_ID = #{zdept_id}
			</if>
			<if test='zdept_brch_id != null and zdept_brch_id != ""'>
				AND ZDEPT_BRCH_ID = #{zdept_brch_id}
			</if>
			<if test='zemp_id != null and zemp_id != ""'>
				AND ZEMP_ID = #{zemp_id}
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			AND 1 = 2
		</if>
		ORDER BY ZRMS_YM DESC, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 현장용 ] 이체 제외 후 학습 엑셀다운			-->
	<!-- ********************************************** -->
	<resultMap type="exlTranStudyVO" id="exlTranStudy_d">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zemp_nm" 			property="zemp_nm" />
		<id column="zemp_id" 			property="zemp_id" />
		<id column="zauth_grp" 			property="zauth_grp" />
		<id column="zmbr_nm" 			property="zmbr_nm" />
		<id column="kunnr" 				property="kunnr" />
		<id column="zgrade_cde" 		property="zgrade_cde" />
		<id column="matnr_nm" 			property="matnr_nm" />
		<id column="matnr" 				property="matnr" />
		<id column="zexc_month" 		property="zexc_month" />
	</resultMap>
	
	<select id="excelTranStudy_d" parameterType="HashMap" resultMap="exlTranStudy_d" > 
        SELECT ZRMS_YM
              , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
              , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
              , ZDEPT_BRCH_ID || DECODE(TRIM(ZLC_NM), '', ' ', '(' || ZLC_NM || ')') AS ZDEPT_BRCH_ID
              , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
              , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
              , DECODE((SELECT ZAUTH_GRP FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = ZEMP_ID AND ROWNUM = 1), 'NC', '사업국장', 'NE', '행정교사', 'NP', '팀장', 'NT', '교사') AS ZAUTH_GRP
              , ZMBR_NM
              , KUNNR
              , ZGRADE_CDE
              , (SELECT MAKTX FROM MAKT WHERE MANDT = '300' AND MATNR = A.MATNR) AS MATNR_NM
              , MATNR
              , DECODE(ZEXC_MONTH, 0, ' ', ZEXC_MONTH) AS ZEXC_MONTH
		FROM ZSD7_RMS_TRAN_D A
		WHERE MANDT = '300'
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802' OR ZREGION = 'T410') -- T410 : 성장사업본부
			</if>
			<if test='active_bcg_id == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			<if test='zregion != null and zregion != ""'>
				AND ZREGION = #{zregion}
			</if>
			<if test='zdept_id != null and zdept_id != ""'>
				AND ZDEPT_ID = #{zdept_id}
			</if>
			<if test='zdept_brch_id != null and zdept_brch_id != ""'>
				AND ZDEPT_BRCH_ID = #{zdept_brch_id}
			</if>
			<if test='zemp_id != null and zemp_id != ""'>
				AND ZEMP_ID = #{zemp_id}
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			<if test='session_zregion_gb == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802')
			</if>
			<if test='session_zregion_gb == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='session_zregion_gb == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			
			<if test="session_zauth_grp == 'NI' or session_zauth_grp == 'NX'">
				AND ZREGION = #{session_zregion}
				<if test='zdept_id != null and zdept_id != ""'>
					AND ZDEPT_ID = #{zdept_id}
				</if>
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if> 
			<if test="session_zauth_grp == 'NC' or session_zauth_grp == 'NE'">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
			<if test="session_zauth_grp == 'NP' ">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				AND ZDEPT_BRCH_ID = #{session_zdept_brch_id}
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
		</if>
		ORDER BY ZRMS_YM DESC, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 관리용 ] 이체 제외 후 학습 엑셀다운			-->
	<!-- ********************************************** -->
	<resultMap type="exlTranStudyVO" id="exlTranStudy_da">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zemp_nm" 			property="zemp_nm" />
		<id column="zemp_id" 			property="zemp_id" />
		<id column="zauth_grp" 			property="zauth_grp" />
		<id column="zmbr_nm" 			property="zmbr_nm" />
		<id column="kunnr" 				property="kunnr" />
		<id column="zgrade_cde" 		property="zgrade_cde" />
		<id column="matnr_nm" 			property="matnr_nm" />
		<id column="matnr" 				property="matnr" />
		<id column="zexc_month" 		property="zexc_month" />
	</resultMap>
	
	<select id="excelTranStudy_da" parameterType="HashMap" resultMap="exlTranStudy_da" > 
        SELECT ZRMS_YM
              , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
              , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
              , ZDEPT_BRCH_ID || DECODE(TRIM(ZLC_NM), '', ' ', '(' || ZLC_NM || ')') AS ZDEPT_BRCH_ID
              , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
              , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
              , DECODE((SELECT ZAUTH_GRP FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = ZEMP_ID AND ROWNUM = 1), 'NC', '사업국장', 'NE', '행정교사', 'NP', '팀장', 'NT', '교사') AS ZAUTH_GRP
              , ZMBR_NM
              , KUNNR
              , ZGRADE_CDE
              , (SELECT MAKTX FROM MAKT WHERE MANDT = '300' AND MATNR = A.MATNR) AS MATNR_NM
              , MATNR
              , DECODE(ZEXC_MONTH, 0, ' ', ZEXC_MONTH) AS ZEXC_MONTH
		FROM ZSD7_RMS_TRAN_D A
		WHERE MANDT = '300'
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802' OR ZREGION = 'T410') -- T410 : 성장사업본부
			</if>
			<if test='active_bcg_id == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			<if test='zregion != null and zregion != ""'>
				AND ZREGION = #{zregion}
			</if>
			<if test='zdept_id != null and zdept_id != ""'>
				AND ZDEPT_ID = #{zdept_id}
			</if>
			<if test='zdept_brch_id != null and zdept_brch_id != ""'>
				AND ZDEPT_BRCH_ID = #{zdept_brch_id}
			</if>
			<if test='zemp_id != null and zemp_id != ""'>
				AND ZEMP_ID = #{zemp_id}
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			AND 1 = 2
		</if>
		ORDER BY ZRMS_YM DESC, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 현장용 ] 개인정보 인증 엑셀다운				-->
	<!-- ********************************************** -->
	<resultMap type="exlIndAuthVO" id="exlIndAuth_d">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zemp_nm" 			property="zemp_nm" />
		<id column="zemp_id" 			property="zemp_id" />
		<id column="zauth_grp" 			property="zauth_grp" />
		<id column="zsms_send_dt" 		property="zsms_send_dt" />
		<id column="zmbr_nm" 			property="zmbr_nm" />
		<id column="kunnr" 				property="kunnr" />
		<id column="zcert_gb" 			property="zcert_gb" />
		<id column="zrec_conn" 			property="zrec_conn" />
		<id column="zcert_name" 		property="zcert_name" />
		<id column="zcert_tel" 			property="zcert_tel" />
	</resultMap>
	
	<select id="excelIndAuth_d" parameterType="HashMap" resultMap="exlIndAuth_d" > 
		SELECT ZRMS_YM
		     , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		     , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		     , ZDEPT_BRCH_ID || DECODE(TRIM(ZLC_NM), '', ' ', '(' || ZLC_NM || ')') AS ZDEPT_BRCH_ID
             , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
		     , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		     , DECODE((SELECT ZAUTH_GRP FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = ZEMP_ID AND ROWNUM = 1), 'NC', '사업국장', 'NE', '행정교사', 'NP', '팀장', 'NT', '교사') AS ZAUTH_GRP
		     , ZSMS_SEND_DT 
		     , ZMBR_NM
		     , KUNNR
		     , DECODE(ZCERT_GB, 'S', 'SMS', 'R', '녹취') AS ZCERT_GB
		     , NVL((SELECT ZCODENM FROM ZSD_COCDT WHERE MANDT = '300' AND ZGRCODE = 'C009' AND ZCODE = A.ZCERT_CONN), ' ') AS ZREC_CONN
			 , ZCERT_NAME
			 , SUBSTR(REPLACE(SCP.DEC_B64('DAMO','SID','NIST_TEL', ZCERT_TEL), '-', ''), 0, 3) || '-****-' || SUBSTR(REPLACE(SCP.DEC_B64('DAMO','SID','NIST_TEL', ZCERT_TEL), '-', ''), 8, 4) AS ZCERT_TEL
		FROM ZSD7_RMS_INFO_D A
		WHERE MANDT = '300'
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802' OR ZREGION = 'T410') -- T410 : 성장사업본부
			</if>
			<if test='active_bcg_id == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			<if test='zregion != null and zregion != ""'>
				AND ZREGION = #{zregion}
			</if>
			<if test='zdept_id != null and zdept_id != ""'>
				AND ZDEPT_ID = #{zdept_id}
			</if>
			<if test='zdept_brch_id != null and zdept_brch_id != ""'>
				AND ZDEPT_BRCH_ID = #{zdept_brch_id}
			</if>
			<if test='zemp_id != null and zemp_id != ""'>
				AND ZEMP_ID = #{zemp_id}
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			<if test='session_zregion_gb == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802')
			</if>
			<if test='session_zregion_gb == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='session_zregion_gb == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			
			<if test="session_zauth_grp == 'NI' or session_zauth_grp == 'NX'">
				AND ZREGION = #{session_zregion}
				<if test='zdept_id != null and zdept_id != ""'>
					AND ZDEPT_ID = #{zdept_id}
				</if>
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if> 
			<if test="session_zauth_grp == 'NC' or session_zauth_grp == 'NE'">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
			<if test="session_zauth_grp == 'NP' ">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				AND ZDEPT_BRCH_ID = #{session_zdept_brch_id}
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
		</if>
		ORDER BY ZRMS_YM DESC, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 관리용 ] 개인정보 인증 엑셀다운				-->
	<!-- ********************************************** -->
	<resultMap type="exlIndAuthVO" id="exlIndAuth_da">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zemp_nm" 			property="zemp_nm" />
		<id column="zemp_id" 			property="zemp_id" />
		<id column="zauth_grp" 			property="zauth_grp" />
		<id column="zsms_send_dt" 		property="zsms_send_dt" />
		<id column="zmbr_nm" 			property="zmbr_nm" />
		<id column="kunnr" 				property="kunnr" />
		<id column="zbirth_day" 		property="zbirth_day" />
		<id column="ztel" 				property="ztel" />
		<id column="zaddr" 				property="zaddr" />
		<id column="zcert_gb" 			property="zcert_gb" />
		<id column="zrec_conn" 			property="zrec_conn" />
		<id column="zcert_name" 		property="zcert_name" />
		<id column="zcert_tel" 			property="zcert_tel" />
		<id column="zadmin_etc" 		property="zadmin_etc" />
	</resultMap>
	
	<select id="excelIndAuth_da" parameterType="HashMap" resultMap="exlIndAuth_da" > 
		SELECT ZRMS_YM
		     , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		     , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		     , ZDEPT_BRCH_ID || DECODE(TRIM(ZLC_NM), '', ' ', '(' || ZLC_NM || ')') AS ZDEPT_BRCH_ID
             , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
		     , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		     , DECODE((SELECT ZAUTH_GRP FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = ZEMP_ID AND ROWNUM = 1), 'NC', '사업국장', 'NE', '행정교사', 'NP', '팀장', 'NT', '교사') AS ZAUTH_GRP
		     , ZSMS_SEND_DT 
		     , ZMBR_NM
		     , KUNNR
             , ZBIRTH_DAY
             , SUBSTR(REPLACE(SCP.DEC_B64('DAMO','SID','NIST_TEL', ZTEL), '-', ''), 0, 3) || '-****-' || SUBSTR(REPLACE(SCP.DEC_B64('DAMO','SID','NIST_TEL', ZTEL), '-', ''), 8, 4) AS ZTEL
             , ZADDR
		     , DECODE(ZCERT_GB, 'S', 'SMS', 'R', '녹취') AS ZCERT_GB
		     , NVL((SELECT ZCODENM FROM ZSD_COCDT WHERE MANDT = '300' AND ZGRCODE = 'C009' AND ZCODE = A.ZCERT_CONN), ' ') AS ZREC_CONN
			 , ZCERT_NAME
			 , SUBSTR(REPLACE(SCP.DEC_B64('DAMO','SID','NIST_TEL', ZCERT_TEL), '-', ''), 0, 3) || '-****-' || SUBSTR(REPLACE(SCP.DEC_B64('DAMO','SID','NIST_TEL', ZCERT_TEL), '-', ''), 8, 4) AS ZCERT_TEL
			 , ZADMIN_ETC
		FROM ZSD7_RMS_INFO_DA A
		WHERE MANDT = '300'
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802' OR ZREGION = 'T410') -- T410 : 성장사업본부
			</if>
			<if test='active_bcg_id == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			<if test='zregion != null and zregion != ""'>
				AND ZREGION = #{zregion}
			</if>
			<if test='zdept_id != null and zdept_id != ""'>
				AND ZDEPT_ID = #{zdept_id}
			</if>
			<if test='zdept_brch_id != null and zdept_brch_id != ""'>
				AND ZDEPT_BRCH_ID = #{zdept_brch_id}
			</if>
			<if test='zemp_id != null and zemp_id != ""'>
				AND ZEMP_ID = #{zemp_id}
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			AND 1 = 2
		</if>
		ORDER BY ZRMS_YM DESC, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 현장용 ] 2개월 체납 엑셀다운					-->
	<!-- ********************************************** -->
	<resultMap type="exlArrPaymentVO" id="exlArrPayment_d">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zemp_nm" 			property="zemp_nm" />
		<id column="zemp_id" 			property="zemp_id" />
		<id column="zauth_grp" 			property="zauth_grp" />
		<id column="zmbr_nm" 			property="zmbr_nm" />
		<id column="kunnr" 				property="kunnr" />
		<id column="zgrade_cde" 		property="zgrade_cde" />
		<id column="matnr" 				property="matnr" />
		<id column="matnr_nm" 			property="matnr_nm" />
		<id column="zrcpt_amt" 			property="zrcpt_amt" />
		<id column="zlastfee_ym" 		property="zlastfee_ym" />
	</resultMap>
	
	<select id="excelArrPayment_d" parameterType="HashMap" resultMap="exlArrPayment_d" > 
		SELECT ZRMS_YM
		     , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		     , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		     , ZDEPT_BRCH_ID || DECODE(TRIM(ZLC_NM), '', ' ', '(' || ZLC_NM || ')') AS ZDEPT_BRCH_ID
             , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
		     , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		     , DECODE((SELECT ZAUTH_GRP FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = ZEMP_ID AND ROWNUM = 1), 'NC', '사업국장', 'NE', '행정교사', 'NP', '팀장', 'NT', '교사') AS ZAUTH_GRP
		     , ZMBR_NM
		     , KUNNR
		     , ZGRADE_CDE
			 , MATNR
			 , (SELECT MAKTX FROM MAKT WHERE MANDT = '300' AND MATNR = A.MATNR) AS MATNR_NM
			 , ZRCPT_AMT
			 , ZLASTFEE_YM
		FROM ZSD7_RMS_ARRE_D A
		WHERE MANDT = '300'
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802' OR ZREGION = 'T410') -- T410 : 성장사업본부
			</if>
			<if test='active_bcg_id == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			<if test='zregion != null and zregion != ""'>
				AND ZREGION = #{zregion}
			</if>
			<if test='zdept_id != null and zdept_id != ""'>
				AND ZDEPT_ID = #{zdept_id}
			</if>
			<if test='zdept_brch_id != null and zdept_brch_id != ""'>
				AND ZDEPT_BRCH_ID = #{zdept_brch_id}
			</if>
			<if test='zemp_id != null and zemp_id != ""'>
				AND ZEMP_ID = #{zemp_id}
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			<if test='session_zregion_gb == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802')
			</if>
			<if test='session_zregion_gb == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='session_zregion_gb == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			
			<if test="session_zauth_grp == 'NI' or session_zauth_grp == 'NX'">
				AND ZREGION = #{session_zregion}
				<if test='zdept_id != null and zdept_id != ""'>
					AND ZDEPT_ID = #{zdept_id}
				</if>
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if> 
			<if test="session_zauth_grp == 'NC' or session_zauth_grp == 'NE'">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
			<if test="session_zauth_grp == 'NP' ">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				AND ZDEPT_BRCH_ID = #{session_zdept_brch_id}
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
		</if>
		ORDER BY ZRMS_YM DESC, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 관리용 ] 2개월 체납 엑셀다운					-->
	<!-- ********************************************** -->
	<resultMap type="exlArrPaymentVO" id="exlArrPayment_da">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zemp_nm" 			property="zemp_nm" />
		<id column="zemp_id" 			property="zemp_id" />
		<id column="zauth_grp" 			property="zauth_grp" />
		<id column="zmbr_nm" 			property="zmbr_nm" />
		<id column="kunnr" 				property="kunnr" />
		<id column="zgrade_cde" 		property="zgrade_cde" />
		<id column="matnr" 				property="matnr" />
		<id column="matnr_nm" 			property="matnr_nm" />
		<id column="zrcpt_amt" 			property="zrcpt_amt" />
		<id column="zlastfee_ym" 		property="zlastfee_ym" />
	</resultMap>
	
	<select id="excelArrPayment_da" parameterType="HashMap" resultMap="exlArrPayment_da" > 
		SELECT ZRMS_YM
		     , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		     , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		     , ZDEPT_BRCH_ID || DECODE(TRIM(ZLC_NM), '', ' ', '(' || ZLC_NM || ')') AS ZDEPT_BRCH_ID
             , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
		     , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		     , DECODE((SELECT ZAUTH_GRP FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = ZEMP_ID AND ROWNUM = 1), 'NC', '사업국장', 'NE', '행정교사', 'NP', '팀장', 'NT', '교사') AS ZAUTH_GRP
		     , ZMBR_NM
		     , KUNNR
		     , ZGRADE_CDE
			 , MATNR
			 , (SELECT MAKTX FROM MAKT WHERE MANDT = '300' AND MATNR = A.MATNR) AS MATNR_NM
			 , ZRCPT_AMT
			 , ZLASTFEE_YM
		FROM ZSD7_RMS_ARRE_D A
		WHERE MANDT = '300'
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802' OR ZREGION = 'T410') -- T410 : 성장사업본부
			</if>
			<if test='active_bcg_id == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			<if test='zregion != null and zregion != ""'>
				AND ZREGION = #{zregion}
			</if>
			<if test='zdept_id != null and zdept_id != ""'>
				AND ZDEPT_ID = #{zdept_id}
			</if>
			<if test='zdept_brch_id != null and zdept_brch_id != ""'>
				AND ZDEPT_BRCH_ID = #{zdept_brch_id}
			</if>
			<if test='zemp_id != null and zemp_id != ""'>
				AND ZEMP_ID = #{zemp_id}
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			AND 1 = 2
		</if>
		ORDER BY ZRMS_YM DESC, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 현장용 ] 직접결제 중복발송 엑셀다운			-->
	<!-- ********************************************** -->
	<resultMap type="exlPayDirectVO" id="exlPayDirect_d">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zemp_nm" 			property="zemp_nm" />
		<id column="zemp_id" 			property="zemp_id" />
		<id column="zauth_grp" 			property="zauth_grp" />
		<id column="zmbr_nm" 			property="zmbr_nm" />
		<id column="kunnr" 				property="kunnr" />
		<id column="zreq_gb" 			property="zreq_gb" />
		<id column="zsms_send_dt" 		property="zsms_send_dt" />
		<id column="zrec_name" 			property="zrec_name" />
		<id column="zrec_conn" 			property="zrec_conn" />
		<id column="zrec_tel" 			property="zrec_tel" />
		<id column="zappr_type" 		property="zappr_type" />
		<id column="zappr_no" 			property="zappr_no" />
		<id column="zappr_dt" 			property="zappr_dt" />
		<id column="zappr_state" 		property="zappr_state" />
		<id column="zappr_amt" 			property="zappr_amt" />
	</resultMap>
	
	<select id="excelPayDirect_d" parameterType="HashMap" resultMap="exlPayDirect_d" > 
		SELECT ZRMS_YM
		     , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		     , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		     , ZDEPT_BRCH_ID || DECODE(TRIM(ZLC_NM), '', ' ', '(' || ZLC_NM || ')') AS ZDEPT_BRCH_ID
             , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
		     , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		     , DECODE((SELECT ZAUTH_GRP FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = ZEMP_ID AND ROWNUM = 1), 'NC', '사업국장', 'NE', '행정교사', 'NP', '팀장', 'NT', '교사') AS ZAUTH_GRP
		     , ZMBR_NM
		     , KUNNR
			 , (SELECT ZCODENM FROM ZSD_COCDT WHERE MANDT = '300' AND ZGRCODE = 'C128' AND ZCODE = A.ZREQ_GB) AS ZREQ_GB
			 , ZSMS_SEND_DT
			 , ZREC_NAME
             , NVL((SELECT ZCODENM FROM ZSD_COCDT WHERE MANDT = '300' AND ZGRCODE = 'C009' AND ZCODE = A.ZREC_CONN), ' ') AS ZREC_CONN
			 , SUBSTR(REPLACE(SCP.DEC_B64('DAMO','SID','NIST_TEL', ZREC_TEL), '-', ''), 0, 3) || '-****-' || SUBSTR(REPLACE(SCP.DEC_B64('DAMO','SID','NIST_TEL', ZREC_TEL), '-', ''), 8, 4) AS ZREC_TEL
			 , NVL(DECODE(ZAPPR_TYPE, '0', '간편결제', '1', '카드', '3', '카드', ZAPPR_TYPE), ' ') AS ZAPPR_TYPE
			 , NVL(ZAPPR_NO, ' ') AS ZAPPR_NO
			 , NVL(ZAPPR_DT, ' ') AS ZAPPR_DT
             , NVL(DECODE(ZAPPR_STATE, 'A', '결제완료', 'C', '결제취소', '미결제'), ' ') AS ZAPPR_STATE
			 , NVL(TO_CHAR(ZAPPR_AMT), ' ') AS ZAPPR_AMT
		FROM ZSD7_RMS_PAY_D A
		WHERE MANDT = '300'
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802' OR ZREGION = 'T410') -- T410 : 성장사업본부
			</if>
			<if test='active_bcg_id == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			<if test='zregion != null and zregion != ""'>
				AND ZREGION = #{zregion}
			</if>
			<if test='zdept_id != null and zdept_id != ""'>
				AND ZDEPT_ID = #{zdept_id}
			</if>
			<if test='zdept_brch_id != null and zdept_brch_id != ""'>
				AND ZDEPT_BRCH_ID = #{zdept_brch_id}
			</if>
			<if test='zemp_id != null and zemp_id != ""'>
				AND ZEMP_ID = #{zemp_id}
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			<if test='session_zregion_gb == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802')
			</if>
			<if test='session_zregion_gb == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='session_zregion_gb == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			
			<if test="session_zauth_grp == 'NI' or session_zauth_grp == 'NX'">
				AND ZREGION = #{session_zregion}
				<if test='zdept_id != null and zdept_id != ""'>
					AND ZDEPT_ID = #{zdept_id}
				</if>
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if> 
			<if test="session_zauth_grp == 'NC' or session_zauth_grp == 'NE'">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
			<if test="session_zauth_grp == 'NP' ">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				AND ZDEPT_BRCH_ID = #{session_zdept_brch_id}
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
		</if>
		ORDER BY ZRMS_YM DESC, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 관리용 ] 직접결제 중복발송 엑셀다운			-->
	<!-- ********************************************** -->
	<resultMap type="exlPayDirectVO" id="exlPayDirect_da">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zemp_nm" 			property="zemp_nm" />
		<id column="zemp_id" 			property="zemp_id" />
		<id column="zauth_grp" 			property="zauth_grp" />
		<id column="zmbr_nm" 			property="zmbr_nm" />
		<id column="kunnr" 				property="kunnr" />
		<id column="matnr" 				property="matnr" />
		<id column="zreq_gb" 			property="zreq_gb" />
		<id column="zsms_send_dt" 		property="zsms_send_dt" />
		<id column="zrec_name" 			property="zrec_name" />
		<id column="zrec_conn" 			property="zrec_conn" />
		<id column="zrec_tel" 			property="zrec_tel" />
		<id column="zappr_type" 		property="zappr_type" />
		<id column="zappr_no" 			property="zappr_no" />
		<id column="zappr_dt" 			property="zappr_dt" />
		<id column="zappr_state" 		property="zappr_state" />
		<id column="zappr_amt" 			property="zappr_amt" />
		<id column="zdup_month" 		property="zdup_month" />
		<id column="zadmin_etc" 		property="zadmin_etc" />
	</resultMap>
	
	<select id="excelPayDirect_da" parameterType="HashMap" resultMap="exlPayDirect_da" > 
		SELECT ZRMS_YM
		     , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		     , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		     , ZDEPT_BRCH_ID || DECODE(TRIM(ZLC_NM), '', ' ', '(' || ZLC_NM || ')') AS ZDEPT_BRCH_ID
             , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
		     , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		     , DECODE((SELECT ZAUTH_GRP FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = ZEMP_ID AND ROWNUM = 1), 'NC', '사업국장', 'NE', '행정교사', 'NP', '팀장', 'NT', '교사') AS ZAUTH_GRP
		     , ZMBR_NM
		     , KUNNR
			 , MATNR
			 , (SELECT ZCODENM FROM ZSD_COCDT WHERE MANDT = '300' AND ZGRCODE = 'C128' AND ZCODE = A.ZREQ_GB) AS ZREQ_GB
			 , ZSMS_SEND_DT
			 , ZREC_NAME
             , NVL((SELECT ZCODENM FROM ZSD_COCDT WHERE MANDT = '300' AND ZGRCODE = 'C009' AND ZCODE = A.ZREC_CONN), ' ') AS ZREC_CONN
			 , SUBSTR(REPLACE(SCP.DEC_B64('DAMO','SID','NIST_TEL', ZREC_TEL), '-', ''), 0, 3) || '-***' || SUBSTR(REPLACE(SCP.DEC_B64('DAMO','SID','NIST_TEL', ZREC_TEL), '-', ''), 7, 1) || '-'  || SUBSTR(REPLACE(SCP.DEC_B64('DAMO','SID','NIST_TEL', ZREC_TEL), '-', ''), 8, 4) AS ZREC_TEL
			 , NVL(DECODE(ZAPPR_TYPE, '0', '간편결제', '1', '카드', '3', '카드', ZAPPR_TYPE), ' ') AS ZAPPR_TYPE
			 , NVL(ZAPPR_NO, ' ') AS ZAPPR_NO
			 , NVL(ZAPPR_DT, ' ') AS ZAPPR_DT
             , NVL(DECODE(ZAPPR_STATE, 'A', '결제완료', 'C', '결제취소', '미결제'), ' ') AS ZAPPR_STATE
			 , NVL(TO_CHAR(ZAPPR_AMT), ' ') AS ZAPPR_AMT
             , ZDUP_MONTH
             , ZADMIN_ETC
		FROM ZSD7_RMS_PAY_DA A
		WHERE MANDT = '300'
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802' OR ZREGION = 'T410') -- T410 : 성장사업본부
			</if>
			<if test='active_bcg_id == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			<if test='zregion != null and zregion != ""'>
				AND ZREGION = #{zregion}
			</if>
			<if test='zdept_id != null and zdept_id != ""'>
				AND ZDEPT_ID = #{zdept_id}
			</if>
			<if test='zdept_brch_id != null and zdept_brch_id != ""'>
				AND ZDEPT_BRCH_ID = #{zdept_brch_id}
			</if>
			<if test='zemp_id != null and zemp_id != ""'>
				AND ZEMP_ID = #{zemp_id}
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			AND 1 = 2
		</if>
		ORDER BY ZRMS_YM DESC, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 현장용 ] 주요지표 엑셀다운					-->
	<!-- ********************************************** -->
	<resultMap type="exlMoniSumVO" id="excelMoniSum_d">
		<id column="zlevel" 			property="zlevel" />
		<id column="zregion" 			property="zregion" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_id" 			property="zdept_id" />
		<id column="zdept_emp_nm" 		property="zdept_emp_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zdept_brch_nm" 		property="zdept_brch_nm" />
		<id column="zemp_nm" 			property="zemp_id" />
		<id column="zemp_id" 			property="zemp_nm" />
		<id column="zcls_nm" 			property="zcls_nm" />
		<id column="zcls_id" 			property="zcls_id" />
		<id column="zitem1_p" 			property="zitem1_p" />
		<id column="zitem2_p" 			property="zitem2_p" />
		<id column="zitem3_p" 			property="zitem3_p" />
		<id column="zitem4_p" 			property="zitem4_p" />
		<id column="zitem5_p" 			property="zitem5_p" />
		<id column="zitem6_p" 			property="zitem6_p" />
		<id column="zitem7_p" 			property="zitem7_p" />
	</resultMap>
	
	<select id="excelMoniSum_d" parameterType="HashMap" resultMap="excelMoniSum_d" >
	WITH ORG_NM AS
	(
		 SELECT ZDEPT_ID, ZDEPT_BRCH_ID, ZDUTY_CDE, LISTAGG(ZNM, ',') WITHIN GROUP(ORDER BY ZNM) AS ZNM
		 FROM ZSD7_LOGIN A
		     , ZSD7_ORG_MT B
		 WHERE A.MANDT = '300' 
		 AND A.ZLOCK = '1' 
		 AND B.ZRCD_YM = #{zreq_ym_b}
		 AND A.MANDT = B.MANDT
		 AND A.KUNNR = B.ZEMP_ID
		 GROUP BY ZDEPT_ID, ZDEPT_BRCH_ID, ZDUTY_CDE
	)
	,RMS_TOTAL AS
	(
		SELECT *
		FROM ZSD7_RMS_TOTAL A
		WHERE MANDT = '300'
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802' OR ZREGION = 'T410') -- T410 : 성장사업본부
			</if>
			<if test='active_bcg_id == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM = #{zreq_ym_b}
				</if>
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			<if test='session_zregion_gb == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802')
			</if>
			<if test='session_zregion_gb == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='session_zregion_gb == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM = #{zreq_ym_b}
				</if>
			</if>
		</if>
	)
		-- 평균
		SELECT 'B' AS ZLEVEL, ' ' AS ZREGION, ' ' AS ZREGION_NM, ' ' AS ZDEPT_NM, ' ' AS ZDEPT_ID, ' ' AS ZDEPT_EMP_NM, ' ' AS ZDEPT_BRCH_ID, ' ' AS ZDEPT_BRCH_NM, ' ' AS ZEMP_NM, ' ' AS ZEMP_ID, ' ' AS ZCLS_NM, ' ' AS ZCLS_ID
		    , RTRIM(TO_CHAR(ROUND(
                CASE 
                    WHEN SUM(ZITEM1_S) = 0 OR SUM(ZITEM1_T) = 0
                    THEN 0
                    ELSE SUM(ZITEM1_S)/SUM(ZITEM1_T)*100
                END   
            , 2), 'FM9990.00'), '.') AS ZITEM1_P
		    , RTRIM(TO_CHAR(ROUND(
                CASE 
                    WHEN SUM(ZITEM2_S) = 0 OR SUM(ZITEM2_T) = 0
                    THEN 0
                    ELSE SUM(ZITEM2_S)/SUM(ZITEM2_T)*100
                END   
            , 2), 'FM9990.00'), '.') AS ZITEM2_P
		    , RTRIM(TO_CHAR(ROUND(
                CASE 
                    WHEN SUM(ZITEM3_S) = 0 OR SUM(ZITEM3_T) = 0
                    THEN 0
                    ELSE SUM(ZITEM3_S)/SUM(ZITEM3_T)*100
                END   
            , 2), 'FM9990.00'), '.') AS ZITEM3_P
		    , RTRIM(TO_CHAR(ROUND(
                CASE 
                    WHEN SUM(ZITEM4_S) = 0 OR SUM(ZITEM4_T) = 0
                    THEN 0
                    ELSE SUM(ZITEM4_S)/SUM(ZITEM4_T)*100
                END   
            , 2), 'FM9990.00'), '.') AS ZITEM4_P
		    , RTRIM(TO_CHAR(ROUND(
                CASE 
                    WHEN SUM(ZITEM5_S) = 0 OR SUM(ZITEM5_T) = 0
                    THEN 0
                    ELSE SUM(ZITEM5_S)/SUM(ZITEM5_T)*100
                END   
            , 2), 'FM9990.00'), '.') AS ZITEM5_P
		    , RTRIM(TO_CHAR(ROUND(
                CASE 
                    WHEN SUM(ZITEM6_S) = 0 OR SUM(ZITEM6_T) = 0
                    THEN 0
                    ELSE SUM(ZITEM6_S)/SUM(ZITEM6_T)*100
                END   
            , 2), 'FM9990.00'), '.') AS ZITEM6_P
		    , RTRIM(TO_CHAR(ROUND(
                CASE 
                    WHEN SUM(ZITEM7_S) = 0 OR SUM(ZITEM7_T) = 0
                    THEN 0
                    ELSE SUM(ZITEM7_S)/SUM(ZITEM7_T)*100
                END   
            , 2), 'FM9990.00'), '.') AS ZITEM7_P
	    FROM RMS_TOTAL A
	    WHERE MANDT = '300'
	    AND ZLEVEL = '1'
	    
	    UNION ALL
	
		<if test='session_zregion_gb == "A"'>
		SELECT ZLEVEL
			 , ZREGION 
			 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
             , ZDEPT_ID
             , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
             , ZDEPT_BRCH_ID
             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
             , ZCLS_ID
		     , DECODE(ZITEM1_S, '-1', '-', RTRIM(TO_CHAR(ZITEM1_P, 'FM9990.00'), '.')) AS ZITEM1_P
		     , DECODE(ZITEM2_S, '-1', '-', RTRIM(TO_CHAR(ZITEM2_P, 'FM9990.00'), '.')) AS ZITEM2_P
		     , DECODE(ZITEM3_S, '-1', '-', RTRIM(TO_CHAR(ZITEM3_P, 'FM9990.00'), '.')) AS ZITEM3_P
		     , DECODE(ZITEM4_S, '-1', '-', RTRIM(TO_CHAR(ZITEM4_P, 'FM9990.00'), '.')) AS ZITEM4_P
		     , DECODE(ZITEM5_S, '-1', '-', RTRIM(TO_CHAR(ZITEM5_P, 'FM9990.00'), '.')) AS ZITEM5_P
		     , DECODE(ZITEM6_S, '-1', '-', RTRIM(TO_CHAR(ZITEM6_P, 'FM9990.00'), '.')) AS ZITEM6_P
		     , DECODE(ZITEM7_S, '-1', '-', RTRIM(TO_CHAR(ZITEM7_P, 'FM9990.00'), '.')) AS ZITEM7_P
		FROM RMS_TOTAL A
		WHERE MANDT = '300'
		AND ((ZLEVEL = '1' AND EXISTS (SELECT 1 FROM RMS_TOTAL WHERE MANDT = '300' AND ZREGION = A.ZREGION AND ZLEVEL = '2'))
			OR (ZLEVEL = '2' AND EXISTS (SELECT 1 FROM RMS_TOTAL WHERE MANDT = '300' AND ZREGION = A.ZREGION AND ZDEPT_ID = A.ZDEPT_ID AND ZLEVEL = '3'))
			OR ZLEVEL IN ('3', '4', '5')
		)
		</if>
		<if test='session_zregion_gb != "A"'>
			<if test='session_zauth_grp == "NI" or session_zauth_grp == "NX"'>
				SELECT ZLEVEL
					 , ZREGION 
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', RTRIM(TO_CHAR(ZITEM1_P, 'FM9990.00'), '.')) AS ZITEM1_P
				     , DECODE(ZITEM2_S, '-1', '-', RTRIM(TO_CHAR(ZITEM2_P, 'FM9990.00'), '.')) AS ZITEM2_P
				     , DECODE(ZITEM3_S, '-1', '-', RTRIM(TO_CHAR(ZITEM3_P, 'FM9990.00'), '.')) AS ZITEM3_P
				     , DECODE(ZITEM4_S, '-1', '-', RTRIM(TO_CHAR(ZITEM4_P, 'FM9990.00'), '.')) AS ZITEM4_P
				     , DECODE(ZITEM5_S, '-1', '-', RTRIM(TO_CHAR(ZITEM5_P, 'FM9990.00'), '.')) AS ZITEM5_P
				     , DECODE(ZITEM6_S, '-1', '-', RTRIM(TO_CHAR(ZITEM6_P, 'FM9990.00'), '.')) AS ZITEM6_P
				     , DECODE(ZITEM7_S, '-1', '-', RTRIM(TO_CHAR(ZITEM7_P, 'FM9990.00'), '.')) AS ZITEM7_P
				FROM RMS_TOTAL A
				WHERE MANDT = '300'
				AND ZLEVEL = '1'
				
				UNION ALL
				  
				SELECT ZLEVEL
					 , ZREGION 
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', RTRIM(TO_CHAR(ZITEM1_P, 'FM9990.00'), '.')) AS ZITEM1_P
				     , DECODE(ZITEM2_S, '-1', '-', RTRIM(TO_CHAR(ZITEM2_P, 'FM9990.00'), '.')) AS ZITEM2_P
				     , DECODE(ZITEM3_S, '-1', '-', RTRIM(TO_CHAR(ZITEM3_P, 'FM9990.00'), '.')) AS ZITEM3_P
				     , DECODE(ZITEM4_S, '-1', '-', RTRIM(TO_CHAR(ZITEM4_P, 'FM9990.00'), '.')) AS ZITEM4_P
				     , DECODE(ZITEM5_S, '-1', '-', RTRIM(TO_CHAR(ZITEM5_P, 'FM9990.00'), '.')) AS ZITEM5_P
				     , DECODE(ZITEM6_S, '-1', '-', RTRIM(TO_CHAR(ZITEM6_P, 'FM9990.00'), '.')) AS ZITEM6_P
				     , DECODE(ZITEM7_S, '-1', '-', RTRIM(TO_CHAR(ZITEM7_P, 'FM9990.00'), '.')) AS ZITEM7_P
				FROM RMS_TOTAL A
				WHERE MANDT = '300'
				AND ZLEVEL IN ('2', '3', '4', '5')
				AND ZREGION = #{session_zregion}
			</if>
			<if test='session_zauth_grp == "NC"'>
				SELECT ZLEVEL
					 , ZREGION 
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', RTRIM(TO_CHAR(ZITEM1_P, 'FM9990.00'), '.')) AS ZITEM1_P
				     , DECODE(ZITEM2_S, '-1', '-', RTRIM(TO_CHAR(ZITEM2_P, 'FM9990.00'), '.')) AS ZITEM2_P
				     , DECODE(ZITEM3_S, '-1', '-', RTRIM(TO_CHAR(ZITEM3_P, 'FM9990.00'), '.')) AS ZITEM3_P
				     , DECODE(ZITEM4_S, '-1', '-', RTRIM(TO_CHAR(ZITEM4_P, 'FM9990.00'), '.')) AS ZITEM4_P
				     , DECODE(ZITEM5_S, '-1', '-', RTRIM(TO_CHAR(ZITEM5_P, 'FM9990.00'), '.')) AS ZITEM5_P
				     , DECODE(ZITEM6_S, '-1', '-', RTRIM(TO_CHAR(ZITEM6_P, 'FM9990.00'), '.')) AS ZITEM6_P
				     , DECODE(ZITEM7_S, '-1', '-', RTRIM(TO_CHAR(ZITEM7_P, 'FM9990.00'), '.')) AS ZITEM7_P
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  AND ZREGION = #{session_zregion}
				  
				  UNION ALL
				  
				SELECT ZLEVEL
					 , ZREGION 
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', RTRIM(TO_CHAR(ZITEM1_P, 'FM9990.00'), '.')) AS ZITEM1_P
				     , DECODE(ZITEM2_S, '-1', '-', RTRIM(TO_CHAR(ZITEM2_P, 'FM9990.00'), '.')) AS ZITEM2_P
				     , DECODE(ZITEM3_S, '-1', '-', RTRIM(TO_CHAR(ZITEM3_P, 'FM9990.00'), '.')) AS ZITEM3_P
				     , DECODE(ZITEM4_S, '-1', '-', RTRIM(TO_CHAR(ZITEM4_P, 'FM9990.00'), '.')) AS ZITEM4_P
				     , DECODE(ZITEM5_S, '-1', '-', RTRIM(TO_CHAR(ZITEM5_P, 'FM9990.00'), '.')) AS ZITEM5_P
				     , DECODE(ZITEM6_S, '-1', '-', RTRIM(TO_CHAR(ZITEM6_P, 'FM9990.00'), '.')) AS ZITEM6_P
				     , DECODE(ZITEM7_S, '-1', '-', RTRIM(TO_CHAR(ZITEM7_P, 'FM9990.00'), '.')) AS ZITEM7_P
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL IN ('2', '3', '4', '5')
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
			</if>
			<if test='session_zauth_grp == "NP"'>
				SELECT ZLEVEL
					 , ZREGION 
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', RTRIM(TO_CHAR(ZITEM1_P, 'FM9990.00'), '.')) AS ZITEM1_P
				     , DECODE(ZITEM2_S, '-1', '-', RTRIM(TO_CHAR(ZITEM2_P, 'FM9990.00'), '.')) AS ZITEM2_P
				     , DECODE(ZITEM3_S, '-1', '-', RTRIM(TO_CHAR(ZITEM3_P, 'FM9990.00'), '.')) AS ZITEM3_P
				     , DECODE(ZITEM4_S, '-1', '-', RTRIM(TO_CHAR(ZITEM4_P, 'FM9990.00'), '.')) AS ZITEM4_P
				     , DECODE(ZITEM5_S, '-1', '-', RTRIM(TO_CHAR(ZITEM5_P, 'FM9990.00'), '.')) AS ZITEM5_P
				     , DECODE(ZITEM6_S, '-1', '-', RTRIM(TO_CHAR(ZITEM6_P, 'FM9990.00'), '.')) AS ZITEM6_P
				     , DECODE(ZITEM7_S, '-1', '-', RTRIM(TO_CHAR(ZITEM7_P, 'FM9990.00'), '.')) AS ZITEM7_P
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  AND ZREGION = #{session_zregion}
				  
				  UNION ALL
				  
				SELECT ZLEVEL
					 , ZREGION 
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', RTRIM(TO_CHAR(ZITEM1_P, 'FM9990.00'), '.')) AS ZITEM1_P
				     , DECODE(ZITEM2_S, '-1', '-', RTRIM(TO_CHAR(ZITEM2_P, 'FM9990.00'), '.')) AS ZITEM2_P
				     , DECODE(ZITEM3_S, '-1', '-', RTRIM(TO_CHAR(ZITEM3_P, 'FM9990.00'), '.')) AS ZITEM3_P
				     , DECODE(ZITEM4_S, '-1', '-', RTRIM(TO_CHAR(ZITEM4_P, 'FM9990.00'), '.')) AS ZITEM4_P
				     , DECODE(ZITEM5_S, '-1', '-', RTRIM(TO_CHAR(ZITEM5_P, 'FM9990.00'), '.')) AS ZITEM5_P
				     , DECODE(ZITEM6_S, '-1', '-', RTRIM(TO_CHAR(ZITEM6_P, 'FM9990.00'), '.')) AS ZITEM6_P
				     , DECODE(ZITEM7_S, '-1', '-', RTRIM(TO_CHAR(ZITEM7_P, 'FM9990.00'), '.')) AS ZITEM7_P
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '2'
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				  
				  UNION ALL
				  
				SELECT ZLEVEL
					 , ZREGION 
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', RTRIM(TO_CHAR(ZITEM1_P, 'FM9990.00'), '.')) AS ZITEM1_P
				     , DECODE(ZITEM2_S, '-1', '-', RTRIM(TO_CHAR(ZITEM2_P, 'FM9990.00'), '.')) AS ZITEM2_P
				     , DECODE(ZITEM3_S, '-1', '-', RTRIM(TO_CHAR(ZITEM3_P, 'FM9990.00'), '.')) AS ZITEM3_P
				     , DECODE(ZITEM4_S, '-1', '-', RTRIM(TO_CHAR(ZITEM4_P, 'FM9990.00'), '.')) AS ZITEM4_P
				     , DECODE(ZITEM5_S, '-1', '-', RTRIM(TO_CHAR(ZITEM5_P, 'FM9990.00'), '.')) AS ZITEM5_P
				     , DECODE(ZITEM6_S, '-1', '-', RTRIM(TO_CHAR(ZITEM6_P, 'FM9990.00'), '.')) AS ZITEM6_P
				     , DECODE(ZITEM7_S, '-1', '-', RTRIM(TO_CHAR(ZITEM7_P, 'FM9990.00'), '.')) AS ZITEM7_P
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL IN ('3', '4', '5')
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				</if>
		</if>
		ORDER BY ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 현장용 ] 주요지표 엑셀다운					-->
	<!-- ********************************************** -->
	<resultMap type="exlMoniSumVO" id="excelMoniSum_ex_d">
		<id column="zlevel" 			property="zlevel" />
		<id column="zregion" 			property="zregion" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_id" 			property="zdept_id" />
		<id column="zdept_emp_nm" 		property="zdept_emp_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zdept_brch_nm" 		property="zdept_brch_nm" />
		<id column="zemp_nm" 			property="zemp_id" />
		<id column="zemp_id" 			property="zemp_nm" />
		<id column="zcls_nm" 			property="zcls_nm" />
		<id column="zcls_id" 			property="zcls_id" />
		<id column="zitem1_p" 			property="zitem1_p" />
		<id column="zitem2_p" 			property="zitem2_p" />
		<id column="zitem3_p" 			property="zitem3_p" />
		<id column="zitem4_p" 			property="zitem4_p" />
		<id column="zitem5_p" 			property="zitem5_p" />
		<id column="zitem6_p" 			property="zitem6_p" />
		<id column="zitem7_p" 			property="zitem7_p" />
		<id column="zadmin_rank1" 		property="zadmin_rank1" />
		<id column="zadmin_rank2" 		property="zadmin_rank2" />
	</resultMap>
	
	<select id="excelMoniSum_ex_d" parameterType="HashMap" resultMap="excelMoniSum_ex_d" >
	WITH RMS_TOTAL AS
	(
		SELECT A.*
			<if test='active_bcg_id == "N"'>
				, LAST_VALUE(ZADMIN_RANK IGNORE NULLS) OVER(ORDER BY A.ZREGION, A.ZDEPT_ID, A.ZDEPT_BRCH_ID, A.ZLEVEL) AS ZADMIN_RANK
				, LAST_VALUE(ZUP_RANK IGNORE NULLS) OVER(ORDER BY A.ZREGION, A.ZDEPT_ID, A.ZDEPT_BRCH_ID, A.ZLEVEL) AS ZUP_RANK
			</if>
			<if test='active_bcg_id == "C"'>
				, ZADMIN_RANK
				, ZUP_RANK
			</if>
			<if test='active_bcg_id == "S"'>
				, ZADMIN_RANK
				, ZUP_RANK
			</if>
		FROM ZSD7_RMS_TOTAL A
			, (SELECT *
               FROM ZSD7_RMS_ADMIN_R
               WHERE MANDT = '300'
               <choose>
			   		<when test='brch_gb == "LC"'>
						AND ZLEVEL IN ('1', '3')
					</when>
					<when test='brch_gb == "BL"'>
						AND ZLEVEL IN ('1', '2')
					</when>
					<otherwise>
						<if test='active_bcg_id == "N"'>
							AND ZLEVEL = '99'
						</if>
					</otherwise>
				</choose>
                ) B
		WHERE A.MANDT = '300'
        AND A.MANDT = B.MANDT(+)
        AND A.ZRMS_YM = B.ZRMS_YM(+)
        AND A.ZLEVEL = B.ZLEVEL(+)
        AND A.ZREGION = B.ZREGION(+)
        AND A.ZDEPT_ID = B.ZDEPT_ID(+)
        AND A.ZDEPT_BRCH_ID = B.ZDEPT_BRCH_ID(+)
		<if test='brch_gb == "LC"'>
			AND (A.ZLEVEL IN ('1', '2')
				OR (A.ZLEVEL IN ('3', '4', '5') AND EXISTS (SELECT 1 FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = TO_CHAR(ADD_MONTHS(TO_DATE(A.ZRMS_YM, 'YYYYMM'), -1), 'YYYYMM') AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID)))
		</if>
		<if test='brch_gb == "BL"'>   
			AND (A.ZLEVEL IN ('1', '2')
				OR (A.ZLEVEL IN ('3', '4', '5') AND NOT EXISTS (SELECT 1 FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = TO_CHAR(ADD_MONTHS(TO_DATE(A.ZRMS_YM, 'YYYYMM'), -1), 'YYYYMM') AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID)))
		</if>
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802' OR A.ZREGION = 'T410')
			</if>
			<if test='active_bcg_id == "C"'>
				AND A.ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND A.ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND A.ZRMS_YM = #{zreq_ym_b} 
				</if>
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			<if test='session_zregion_gb == "N"'>
				AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802')
			</if>
			<if test='session_zregion_gb == "C"'>
				AND A.ZREGION = 'T880'
			</if>
			<if test='session_zregion_gb == "S"'>
				AND A.ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND A.ZRMS_YM = #{zreq_ym_b} 
				</if>
			</if>
			AND A.ZREGION = #{session_zregion}
		</if>
	), RMS_TOTAL_R AS
		(
			SELECT MANDT, ZITEM_RATE, ZITEM_ID
		    FROM ZSD7_RMS_TOTAL_R A
		    WHERE MANDT = '300'
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND A.ZRMS_YM = #{zreq_ym_b} 
				</if>
			</if>
           <choose>
				<when test='brch_gb == "LC"'>
					 AND ZLEVEL = '3'
				</when>
				<when test='brch_gb == "BL"'>
					 AND ZLEVEL = '2'
				</when>
				<otherwise>
					<if test='active_bcg_id == "N"'>
						AND ZLEVEL = '99'
					</if>
				</otherwise>
			</choose>
		    <if test='active_bcg_id == "N"'>
				AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802' OR A.ZREGION = 'T410')
			</if>
			<if test='active_bcg_id == "C"'>
				AND A.ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND A.ZREGION = 'T885'
			</if>
		    ORDER BY ZITEM_ID, TO_NUMBER(ZITEM_RANK)
		)
		(
		-- 상위20%
			SELECT 'A' AS ZLEVEL, ' ' AS ZREGION, ' ' AS ZREGION_NM, ' ' AS ZDEPT_NM, ' ' AS ZDEPT_ID, ' ' AS ZDEPT_EMP_NM, ' ' AS ZDEPT_BRCH_ID, ' ' AS ZDEPT_BRCH_NM, ' ' AS ZEMP_NM, ' ' AS ZEMP_ID, ' ' AS ZCLS_NM, ' ' AS ZCLS_ID
			    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_info') WHERE RNUM = 
			       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_info')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM1_P
			    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_card') WHERE RNUM = 
			       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_card')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM2_P
			    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_tran') WHERE RNUM = 
			       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_tran')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM3_P
			    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_arre') WHERE RNUM = 
			        ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_arre')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM4_P
			    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_pay') WHERE RNUM = 
			       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_pay')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM5_P
			    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_summ') WHERE RNUM = 
			       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_summ')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM6_P
			    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_stmng') WHERE RNUM = 
			       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_stmng')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM7_P
			    , ' ' AS ZADMIN_RANK1
                , ' ' AS ZADMIN_RANK2
			FROM DUAL
		
			UNION ALL
			
			-- 평균
			SELECT 'B' AS ZLEVEL, ' ' AS ZREGION, ' ' AS ZREGION_NM, ' ' AS ZDEPT_NM, ' ' AS ZDEPT_ID, ' ' AS ZDEPT_EMP_NM, ' ' AS ZDEPT_BRCH_ID, ' ' AS ZDEPT_BRCH_NM, ' ' AS ZEMP_NM, ' ' AS ZEMP_ID, ' ' AS ZCLS_NM, ' ' AS ZCLS_ID
			    , RTRIM(TO_CHAR(ROUND(
                    CASE 
                        WHEN SUM(ZITEM1_S) = 0 OR SUM(ZITEM1_T) = 0
                        THEN 0
                        ELSE SUM(ZITEM1_S)/SUM(ZITEM1_T)*100
                    END   
                , 2), 'FM9990.00'), '.') AS ZITEM1_P
			    , RTRIM(TO_CHAR(ROUND(
                    CASE 
                        WHEN SUM(ZITEM2_S) = 0 OR SUM(ZITEM2_T) = 0
                        THEN 0
                        ELSE SUM(ZITEM2_S)/SUM(ZITEM2_T)*100
                    END   
                , 2), 'FM9990.00'), '.') AS ZITEM2_P
			    , RTRIM(TO_CHAR(ROUND(
                    CASE 
                        WHEN SUM(ZITEM3_S) = 0 OR SUM(ZITEM3_T) = 0
                        THEN 0
                        ELSE SUM(ZITEM3_S)/SUM(ZITEM3_T)*100
                    END   
                , 2), 'FM9990.00'), '.') AS ZITEM3_P
			    , RTRIM(TO_CHAR(ROUND(
                    CASE 
                        WHEN SUM(ZITEM4_S) = 0 OR SUM(ZITEM4_T) = 0
                        THEN 0
                        ELSE SUM(ZITEM4_S)/SUM(ZITEM4_T)*100
                    END   
                , 2), 'FM9990.00'), '.') AS ZITEM4_P
			    , RTRIM(TO_CHAR(ROUND(
                    CASE 
                        WHEN SUM(ZITEM5_S) = 0 OR SUM(ZITEM5_T) = 0
                        THEN 0
                        ELSE SUM(ZITEM5_S)/SUM(ZITEM5_T)*100
                    END   
                , 2), 'FM9990.00'), '.') AS ZITEM5_P
			    , RTRIM(TO_CHAR(ROUND(
                    CASE 
                        WHEN SUM(ZITEM6_S) = 0 OR SUM(ZITEM6_T) = 0
                        THEN 0
                        ELSE SUM(ZITEM6_S)/SUM(ZITEM6_T)*100
                    END   
                , 2), 'FM9990.00'), '.') AS ZITEM6_P
			    , RTRIM(TO_CHAR(ROUND(
                    CASE 
                        WHEN SUM(ZITEM7_S) = 0 OR SUM(ZITEM7_T) = 0
                        THEN 0
                        ELSE SUM(ZITEM7_S)/SUM(ZITEM7_T)*100
                    END   
                , 2), 'FM9990.00'), '.') AS ZITEM7_P
                , ' ' AS ZADMIN_RANK1
                , ' ' AS ZADMIN_RANK2
		    FROM RMS_TOTAL A
		    WHERE MANDT = '300'
		    AND ZLEVEL = '1'
		
			UNION ALL
			
			<if test='session_zregion_gb == "A"'>
				SELECT ZLEVEL
		             , ZREGION
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
					 , ZDEPT_ID
		             , (SELECT ZNM FROM ZSD7_LOGIN A WHERE MANDT = '300' AND ZAUTH_GRP = 'NC' AND ZLOCK = '1' AND VKBUR = A.ZDEPT_ID AND ROWNUM = 1
							AND EXISTS (SELECT 1 FROM KNVV WHERE MANDT = '300' AND KUNNR = A.KUNNR AND KVGR1 = '1')) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', RTRIM(TO_CHAR(ZITEM1_P, 'FM9990.00'), '.')) AS ZITEM1_P
				     , DECODE(ZITEM2_S, '-1', '-', RTRIM(TO_CHAR(ZITEM2_P, 'FM9990.00'), '.')) AS ZITEM2_P
				     , DECODE(ZITEM3_S, '-1', '-', RTRIM(TO_CHAR(ZITEM3_P, 'FM9990.00'), '.')) AS ZITEM3_P
				     , DECODE(ZITEM4_S, '-1', '-', RTRIM(TO_CHAR(ZITEM4_P, 'FM9990.00'), '.')) AS ZITEM4_P
				     , DECODE(ZITEM5_S, '-1', '-', RTRIM(TO_CHAR(ZITEM5_P, 'FM9990.00'), '.')) AS ZITEM5_P
				     , DECODE(ZITEM6_S, '-1', '-', RTRIM(TO_CHAR(ZITEM6_P, 'FM9990.00'), '.')) AS ZITEM6_P
				     , DECODE(ZITEM7_S, '-1', '-', RTRIM(TO_CHAR(ZITEM7_P, 'FM9990.00'), '.')) AS ZITEM7_P
				     , TO_CHAR(ZADMIN_RANK) AS ZADMIN_RANK1
				     , TO_CHAR(ZUP_RANK) AS ZADMIN_RANK2
		    FROM RMS_TOTAL A
		    WHERE MANDT = '300'
		    AND ((ZLEVEL = '1' AND EXISTS (SELECT 1 FROM RMS_TOTAL WHERE MANDT = '300' AND ZRMS_YM = A.ZRMS_YM AND ZLEVEL = '2' AND ZREGION = A.ZREGION)) OR 
			     (ZLEVEL = '2' AND EXISTS (SELECT 1 FROM RMS_TOTAL WHERE MANDT = '300' AND ZRMS_YM = A.ZRMS_YM AND ZLEVEL = '3' AND ZREGION = A.ZREGION AND ZDEPT_ID = A.ZDEPT_ID)) OR
			      ZLEVEL IN ('3', '4', '5'))
			</if>
			<if test='session_zregion_gb != "A"'>
				<if test='session_zauth_grp == "NI" or session_zauth_grp == "NX"'>
				SELECT ZLEVEL
		             , ZREGION
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ZSD7_LOGIN A WHERE MANDT = '300' AND ZAUTH_GRP = 'NC' AND ZLOCK = '1' AND VKBUR = A.ZDEPT_ID AND ROWNUM = 1
							AND EXISTS (SELECT 1 FROM KNVV WHERE MANDT = '300' AND KUNNR = A.KUNNR AND KVGR1 = '1')) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', RTRIM(TO_CHAR(ZITEM1_P, 'FM9990.00'), '.')) AS ZITEM1_P
				     , DECODE(ZITEM2_S, '-1', '-', RTRIM(TO_CHAR(ZITEM2_P, 'FM9990.00'), '.')) AS ZITEM2_P
				     , DECODE(ZITEM3_S, '-1', '-', RTRIM(TO_CHAR(ZITEM3_P, 'FM9990.00'), '.')) AS ZITEM3_P
				     , DECODE(ZITEM4_S, '-1', '-', RTRIM(TO_CHAR(ZITEM4_P, 'FM9990.00'), '.')) AS ZITEM4_P
				     , DECODE(ZITEM5_S, '-1', '-', RTRIM(TO_CHAR(ZITEM5_P, 'FM9990.00'), '.')) AS ZITEM5_P
				     , DECODE(ZITEM6_S, '-1', '-', RTRIM(TO_CHAR(ZITEM6_P, 'FM9990.00'), '.')) AS ZITEM6_P
				     , DECODE(ZITEM7_S, '-1', '-', RTRIM(TO_CHAR(ZITEM7_P, 'FM9990.00'), '.')) AS ZITEM7_P
				     , TO_CHAR(ZADMIN_RANK) AS ZADMIN_RANK1
				     , TO_CHAR(ZUP_RANK) AS ZADMIN_RANK2
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  
				  UNION ALL
				  
				SELECT ZLEVEL
		             , ZREGION
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ZSD7_LOGIN A WHERE MANDT = '300' AND ZAUTH_GRP = 'NC' AND ZLOCK = '1' AND VKBUR = A.ZDEPT_ID AND ROWNUM = 1
							AND EXISTS (SELECT 1 FROM KNVV WHERE MANDT = '300' AND KUNNR = A.KUNNR AND KVGR1 = '1')) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', RTRIM(TO_CHAR(ZITEM1_P, 'FM9990.00'), '.')) AS ZITEM1_P
				     , DECODE(ZITEM2_S, '-1', '-', RTRIM(TO_CHAR(ZITEM2_P, 'FM9990.00'), '.')) AS ZITEM2_P
				     , DECODE(ZITEM3_S, '-1', '-', RTRIM(TO_CHAR(ZITEM3_P, 'FM9990.00'), '.')) AS ZITEM3_P
				     , DECODE(ZITEM4_S, '-1', '-', RTRIM(TO_CHAR(ZITEM4_P, 'FM9990.00'), '.')) AS ZITEM4_P
				     , DECODE(ZITEM5_S, '-1', '-', RTRIM(TO_CHAR(ZITEM5_P, 'FM9990.00'), '.')) AS ZITEM5_P
				     , DECODE(ZITEM6_S, '-1', '-', RTRIM(TO_CHAR(ZITEM6_P, 'FM9990.00'), '.')) AS ZITEM6_P
				     , DECODE(ZITEM7_S, '-1', '-', RTRIM(TO_CHAR(ZITEM7_P, 'FM9990.00'), '.')) AS ZITEM7_P
				     , TO_CHAR(ZADMIN_RANK) AS ZADMIN_RANK1
				     , TO_CHAR(ZUP_RANK) AS ZADMIN_RANK2
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL IN ('2', '3', '4', '5')
				  AND ZREGION = #{session_zregion}
				</if>
				<if test='session_zauth_grp == "NC"'>
				SELECT ZLEVEL
		             , ZREGION
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ZSD7_LOGIN A WHERE MANDT = '300' AND ZAUTH_GRP = 'NC' AND ZLOCK = '1' AND VKBUR = A.ZDEPT_ID AND ROWNUM = 1
							AND EXISTS (SELECT 1 FROM KNVV WHERE MANDT = '300' AND KUNNR = A.KUNNR AND KVGR1 = '1')) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', RTRIM(TO_CHAR(ZITEM1_P, 'FM9990.00'), '.')) AS ZITEM1_P
				     , DECODE(ZITEM2_S, '-1', '-', RTRIM(TO_CHAR(ZITEM2_P, 'FM9990.00'), '.')) AS ZITEM2_P
				     , DECODE(ZITEM3_S, '-1', '-', RTRIM(TO_CHAR(ZITEM3_P, 'FM9990.00'), '.')) AS ZITEM3_P
				     , DECODE(ZITEM4_S, '-1', '-', RTRIM(TO_CHAR(ZITEM4_P, 'FM9990.00'), '.')) AS ZITEM4_P
				     , DECODE(ZITEM5_S, '-1', '-', RTRIM(TO_CHAR(ZITEM5_P, 'FM9990.00'), '.')) AS ZITEM5_P
				     , DECODE(ZITEM6_S, '-1', '-', RTRIM(TO_CHAR(ZITEM6_P, 'FM9990.00'), '.')) AS ZITEM6_P
				     , DECODE(ZITEM7_S, '-1', '-', RTRIM(TO_CHAR(ZITEM7_P, 'FM9990.00'), '.')) AS ZITEM7_P
				     , TO_CHAR(ZADMIN_RANK) AS ZADMIN_RANK1
				     , TO_CHAR(ZUP_RANK) AS ZADMIN_RANK2
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  AND ZREGION = #{session_zregion}
				  
				  UNION ALL
				  
				SELECT ZLEVEL
		             , ZREGION
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ZSD7_LOGIN A WHERE MANDT = '300' AND ZAUTH_GRP = 'NC' AND ZLOCK = '1' AND VKBUR = A.ZDEPT_ID AND ROWNUM = 1
							AND EXISTS (SELECT 1 FROM KNVV WHERE MANDT = '300' AND KUNNR = A.KUNNR AND KVGR1 = '1')) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', RTRIM(TO_CHAR(ZITEM1_P, 'FM9990.00'), '.')) AS ZITEM1_P
				     , DECODE(ZITEM2_S, '-1', '-', RTRIM(TO_CHAR(ZITEM2_P, 'FM9990.00'), '.')) AS ZITEM2_P
				     , DECODE(ZITEM3_S, '-1', '-', RTRIM(TO_CHAR(ZITEM3_P, 'FM9990.00'), '.')) AS ZITEM3_P
				     , DECODE(ZITEM4_S, '-1', '-', RTRIM(TO_CHAR(ZITEM4_P, 'FM9990.00'), '.')) AS ZITEM4_P
				     , DECODE(ZITEM5_S, '-1', '-', RTRIM(TO_CHAR(ZITEM5_P, 'FM9990.00'), '.')) AS ZITEM5_P
				     , DECODE(ZITEM6_S, '-1', '-', RTRIM(TO_CHAR(ZITEM6_P, 'FM9990.00'), '.')) AS ZITEM6_P
				     , DECODE(ZITEM7_S, '-1', '-', RTRIM(TO_CHAR(ZITEM7_P, 'FM9990.00'), '.')) AS ZITEM7_P
				     , TO_CHAR(ZADMIN_RANK) AS ZADMIN_RANK1
				     , TO_CHAR(ZUP_RANK) AS ZADMIN_RANK2
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL IN ('2', '3', '4', '5')
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				</if>
				<if test='session_zauth_grp == "NP"'>
				SELECT ZLEVEL
		             , ZREGION
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ZSD7_LOGIN A WHERE MANDT = '300' AND ZAUTH_GRP = 'NC' AND ZLOCK = '1' AND VKBUR = A.ZDEPT_ID AND ROWNUM = 1
							AND EXISTS (SELECT 1 FROM KNVV WHERE MANDT = '300' AND KUNNR = A.KUNNR AND KVGR1 = '1')) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', RTRIM(TO_CHAR(ZITEM1_P, 'FM9990.00'), '.')) AS ZITEM1_P
				     , DECODE(ZITEM2_S, '-1', '-', RTRIM(TO_CHAR(ZITEM2_P, 'FM9990.00'), '.')) AS ZITEM2_P
				     , DECODE(ZITEM3_S, '-1', '-', RTRIM(TO_CHAR(ZITEM3_P, 'FM9990.00'), '.')) AS ZITEM3_P
				     , DECODE(ZITEM4_S, '-1', '-', RTRIM(TO_CHAR(ZITEM4_P, 'FM9990.00'), '.')) AS ZITEM4_P
				     , DECODE(ZITEM5_S, '-1', '-', RTRIM(TO_CHAR(ZITEM5_P, 'FM9990.00'), '.')) AS ZITEM5_P
				     , DECODE(ZITEM6_S, '-1', '-', RTRIM(TO_CHAR(ZITEM6_P, 'FM9990.00'), '.')) AS ZITEM6_P
				     , DECODE(ZITEM7_S, '-1', '-', RTRIM(TO_CHAR(ZITEM7_P, 'FM9990.00'), '.')) AS ZITEM7_P
				     , TO_CHAR(ZADMIN_RANK) AS ZADMIN_RANK1
				     , TO_CHAR(ZUP_RANK) AS ZADMIN_RANK2
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  AND ZREGION = #{session_zregion}
				  
				  UNION ALL
				  
				SELECT ZLEVEL
		             , ZREGION
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ZSD7_LOGIN A WHERE MANDT = '300' AND ZAUTH_GRP = 'NC' AND ZLOCK = '1' AND VKBUR = A.ZDEPT_ID AND ROWNUM = 1
							AND EXISTS (SELECT 1 FROM KNVV WHERE MANDT = '300' AND KUNNR = A.KUNNR AND KVGR1 = '1')) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', RTRIM(TO_CHAR(ZITEM1_P, 'FM9990.00'), '.')) AS ZITEM1_P
				     , DECODE(ZITEM2_S, '-1', '-', RTRIM(TO_CHAR(ZITEM2_P, 'FM9990.00'), '.')) AS ZITEM2_P
				     , DECODE(ZITEM3_S, '-1', '-', RTRIM(TO_CHAR(ZITEM3_P, 'FM9990.00'), '.')) AS ZITEM3_P
				     , DECODE(ZITEM4_S, '-1', '-', RTRIM(TO_CHAR(ZITEM4_P, 'FM9990.00'), '.')) AS ZITEM4_P
				     , DECODE(ZITEM5_S, '-1', '-', RTRIM(TO_CHAR(ZITEM5_P, 'FM9990.00'), '.')) AS ZITEM5_P
				     , DECODE(ZITEM6_S, '-1', '-', RTRIM(TO_CHAR(ZITEM6_P, 'FM9990.00'), '.')) AS ZITEM6_P
				     , DECODE(ZITEM7_S, '-1', '-', RTRIM(TO_CHAR(ZITEM7_P, 'FM9990.00'), '.')) AS ZITEM7_P
				     , TO_CHAR(ZADMIN_RANK) AS ZADMIN_RANK1
				     , TO_CHAR(ZUP_RANK) AS ZADMIN_RANK2
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '2'
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				  
				  UNION ALL
				  
				SELECT ZLEVEL
		             , ZREGION
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ZSD7_LOGIN A WHERE MANDT = '300' AND ZAUTH_GRP = 'NC' AND ZLOCK = '1' AND VKBUR = A.ZDEPT_ID AND ROWNUM = 1
							AND EXISTS (SELECT 1 FROM KNVV WHERE MANDT = '300' AND KUNNR = A.KUNNR AND KVGR1 = '1')) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', RTRIM(TO_CHAR(ZITEM1_P, 'FM9990.00'), '.')) AS ZITEM1_P
				     , DECODE(ZITEM2_S, '-1', '-', RTRIM(TO_CHAR(ZITEM2_P, 'FM9990.00'), '.')) AS ZITEM2_P
				     , DECODE(ZITEM3_S, '-1', '-', RTRIM(TO_CHAR(ZITEM3_P, 'FM9990.00'), '.')) AS ZITEM3_P
				     , DECODE(ZITEM4_S, '-1', '-', RTRIM(TO_CHAR(ZITEM4_P, 'FM9990.00'), '.')) AS ZITEM4_P
				     , DECODE(ZITEM5_S, '-1', '-', RTRIM(TO_CHAR(ZITEM5_P, 'FM9990.00'), '.')) AS ZITEM5_P
				     , DECODE(ZITEM6_S, '-1', '-', RTRIM(TO_CHAR(ZITEM6_P, 'FM9990.00'), '.')) AS ZITEM6_P
				     , DECODE(ZITEM7_S, '-1', '-', RTRIM(TO_CHAR(ZITEM7_P, 'FM9990.00'), '.')) AS ZITEM7_P
				     , TO_CHAR(ZADMIN_RANK) AS ZADMIN_RANK1
				     , TO_CHAR(ZUP_RANK) AS ZADMIN_RANK2
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL IN ('3', '4', '5')
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				</if>
			</if>
		)
		<choose>
			<when test='brch_gb == "LC"'>
		        <choose>
					<when test='order == "DESC"'>
						ORDER BY ZREGION, ZDEPT_ID, DECODE(ZLEVEL, '2', 1, 2), TO_NUMBER(DECODE(ZADMIN_RANK, '-', '9999', ' ', '9999', ZADMIN_RANK)) DESC, ZDEPT_BRCH_ID, ZEMP_ID, ZCLS_ID, ZLEVEL
					</when>
					<when test='order == "ASC"'>
						 ORDER BY ZREGION, ZDEPT_ID, DECODE(ZLEVEL, '2', 1, 2),TO_NUMBER(DECODE(ZADMIN_RANK, '-', '9999', ' ', '9999', ZADMIN_RANK)) ASC, ZDEPT_BRCH_ID, ZEMP_ID, ZCLS_ID, ZLEVEL
					</when>
					<otherwise>
						ORDER BY ZREGION, ZDEPT_ID NULLS FIRST, ZDEPT_BRCH_ID NULLS FIRST, ZEMP_ID NULLS FIRST, ZCLS_ID NULLS FIRST, ZLEVEL
					</otherwise>
				</choose>
			</when>
			<when test='brch_gb == "BL"'>
		        <choose>
					<when test='order == "DESC"'>
						ORDER BY ZREGION, DECODE(ZLEVEL, '1', 1, 2), TO_NUMBER(DECODE(ZADMIN_RANK, '-', '9999', ' ', '9999', ZADMIN_RANK)) DESC, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID, ZCLS_ID, ZLEVEL
					</when>
					<when test='order == "ASC"'>
						ORDER BY ZREGION, DECODE(ZLEVEL, '1', 1, 2), TO_NUMBER(DECODE(ZADMIN_RANK, '-', '9999', ' ', '9999', ZADMIN_RANK)) ASC, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID, ZCLS_ID, ZLEVEL
					</when>
					<otherwise>
						ORDER BY ZREGION, ZDEPT_ID NULLS FIRST, ZDEPT_BRCH_ID NULLS FIRST, ZEMP_ID NULLS FIRST, ZCLS_ID NULLS FIRST, ZLEVEL
					</otherwise>
				</choose>
			</when>
			<otherwise>
				ORDER BY ZREGION, ZDEPT_ID NULLS FIRST, ZDEPT_BRCH_ID NULLS FIRST, ZEMP_ID NULLS FIRST, ZCLS_ID NULLS FIRST, ZLEVEL
			</otherwise>
		</choose>
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 현장용 ] 주요지표 엑셀다운 건수				-->
	<!-- ********************************************** -->
	<resultMap type="exlMoniSumVO" id="excelMoniSum_d_cnt">
		<id column="zlevel" 			property="zlevel" />
		<id column="zregion" 			property="zregion" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_id" 			property="zdept_id" />
		<id column="zdept_emp_nm" 		property="zdept_emp_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zdept_brch_nm" 		property="zdept_brch_nm" />
		<id column="zemp_nm" 			property="zemp_id" />
		<id column="zemp_id" 			property="zemp_nm" />
		<id column="zcls_nm" 			property="zcls_nm" />
		<id column="zcls_id" 			property="zcls_id" />
		<id column="zitem1_s" 			property="zitem1_s" />
		<id column="zitem2_s" 			property="zitem2_s" />
		<id column="zitem3_s" 			property="zitem3_s" />
		<id column="zitem4_s" 			property="zitem4_s" />
		<id column="zitem5_s" 			property="zitem5_s" />
		<id column="zitem6_s" 			property="zitem6_s" />
		<id column="zitem7_s" 			property="zitem7_s" />
	</resultMap>
	
	<select id="excelMoniSum_d_cnt" parameterType="HashMap" resultMap="excelMoniSum_d_cnt" >
	WITH ORG_NM AS
	(
		 SELECT ZDEPT_ID, ZDEPT_BRCH_ID, ZDUTY_CDE, LISTAGG(ZNM, ',') WITHIN GROUP(ORDER BY ZNM) AS ZNM
		 FROM ZSD7_LOGIN A
		     , ZSD7_ORG_MT B
		 WHERE A.MANDT = '300' 
		 AND A.ZLOCK = '1' 
		 AND B.ZRCD_YM = #{zreq_ym_b}
		 AND A.MANDT = B.MANDT
		 AND A.KUNNR = B.ZEMP_ID
		 GROUP BY ZDEPT_ID, ZDEPT_BRCH_ID, ZDUTY_CDE
	)
	,RMS_TOTAL AS
	(
		SELECT *
		FROM ZSD7_RMS_TOTAL A
		WHERE MANDT = '300'
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802' OR ZREGION = 'T410') -- T410 : 성장사업본부
			</if>
			<if test='active_bcg_id == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM = #{zreq_ym_b}
				</if>
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			<if test='session_zregion_gb == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802')
			</if>
			<if test='session_zregion_gb == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='session_zregion_gb == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM = #{zreq_ym_b}
				</if>
			</if>
		</if>
	)
		<if test='session_zregion_gb == "A"'>
		SELECT ZLEVEL
			 , ZREGION 
			 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
             , ZDEPT_ID
             , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
             , ZDEPT_BRCH_ID
             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
             , ZCLS_ID
			 , DECODE(ZITEM1_S, '-1', '-', ZITEM1_S) AS ZITEM1_S
			 , DECODE(ZITEM2_S, '-1', '-', ZITEM2_S) AS ZITEM2_S
			 , DECODE(ZITEM3_S, '-1', '-', ZITEM3_S) AS ZITEM3_S
			 , DECODE(ZITEM4_S, '-1', '-', ZITEM4_S) AS ZITEM4_S
			 , DECODE(ZITEM5_S, '-1', '-', ZITEM5_S) AS ZITEM5_S
			 , DECODE(ZITEM6_S, '-1', '-', ZITEM6_S) AS ZITEM6_S
			 , DECODE(ZITEM7_S, '-1', '-', ZITEM7_S) AS ZITEM7_S
		FROM RMS_TOTAL A
		WHERE MANDT = '300'
		AND ((ZLEVEL = '1' AND EXISTS (SELECT 1 FROM RMS_TOTAL WHERE MANDT = '300' AND ZREGION = A.ZREGION AND ZLEVEL = '2'))
			OR (ZLEVEL = '2' AND EXISTS (SELECT 1 FROM RMS_TOTAL WHERE MANDT = '300' AND ZREGION = A.ZREGION AND ZDEPT_ID = A.ZDEPT_ID AND ZLEVEL = '3'))
			OR ZLEVEL IN ('3', '4', '5')
		)
		</if>
		<if test='session_zregion_gb != "A"'>
			<if test='session_zauth_grp == "NI" or session_zauth_grp == "NX"'>
				SELECT ZLEVEL
					 , ZREGION 
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', ZITEM1_S) AS ZITEM1_S
				     , DECODE(ZITEM2_S, '-1', '-', ZITEM2_S) AS ZITEM2_S
				     , DECODE(ZITEM3_S, '-1', '-', ZITEM3_S) AS ZITEM3_S
				     , DECODE(ZITEM4_S, '-1', '-', ZITEM4_S) AS ZITEM4_S
				     , DECODE(ZITEM5_S, '-1', '-', ZITEM5_S) AS ZITEM5_S
				     , DECODE(ZITEM6_S, '-1', '-', ZITEM6_S) AS ZITEM6_S
				     , DECODE(ZITEM7_S, '-1', '-', ZITEM7_S) AS ZITEM7_S
				FROM RMS_TOTAL A
				WHERE MANDT = '300'
				AND ZLEVEL = '1'
				
				UNION ALL
				  
				SELECT ZLEVEL
					 , ZREGION 
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', ZITEM1_S) AS ZITEM1_S
				     , DECODE(ZITEM2_S, '-1', '-', ZITEM2_S) AS ZITEM2_S
				     , DECODE(ZITEM3_S, '-1', '-', ZITEM3_S) AS ZITEM3_S
				     , DECODE(ZITEM4_S, '-1', '-', ZITEM4_S) AS ZITEM4_S
				     , DECODE(ZITEM5_S, '-1', '-', ZITEM5_S) AS ZITEM5_S
				     , DECODE(ZITEM6_S, '-1', '-', ZITEM6_S) AS ZITEM6_S
				     , DECODE(ZITEM7_S, '-1', '-', ZITEM7_S) AS ZITEM7_S
				FROM RMS_TOTAL A
				WHERE MANDT = '300'
				AND ZLEVEL IN ('2', '3', '4', '5')
				AND ZREGION = #{session_zregion}
			</if>
			<if test='session_zauth_grp == "NC"'>
				SELECT ZLEVEL
					 , ZREGION 
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', ZITEM1_S) AS ZITEM1_S
				     , DECODE(ZITEM2_S, '-1', '-', ZITEM2_S) AS ZITEM2_S
				     , DECODE(ZITEM3_S, '-1', '-', ZITEM3_S) AS ZITEM3_S
				     , DECODE(ZITEM4_S, '-1', '-', ZITEM4_S) AS ZITEM4_S
				     , DECODE(ZITEM5_S, '-1', '-', ZITEM5_S) AS ZITEM5_S
				     , DECODE(ZITEM6_S, '-1', '-', ZITEM6_S) AS ZITEM6_S
				     , DECODE(ZITEM7_S, '-1', '-', ZITEM7_S) AS ZITEM7_S
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  AND ZREGION = #{session_zregion}
				  
				  UNION ALL
				  
				SELECT ZLEVEL
					 , ZREGION 
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', ZITEM1_S) AS ZITEM1_S
				     , DECODE(ZITEM2_S, '-1', '-', ZITEM2_S) AS ZITEM2_S
				     , DECODE(ZITEM3_S, '-1', '-', ZITEM3_S) AS ZITEM3_S
				     , DECODE(ZITEM4_S, '-1', '-', ZITEM4_S) AS ZITEM4_S
				     , DECODE(ZITEM5_S, '-1', '-', ZITEM5_S) AS ZITEM5_S
				     , DECODE(ZITEM6_S, '-1', '-', ZITEM6_S) AS ZITEM6_S
				     , DECODE(ZITEM7_S, '-1', '-', ZITEM7_S) AS ZITEM7_S
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL IN ('2', '3', '4', '5')
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
			</if>
			<if test='session_zauth_grp == "NP"'>
				SELECT ZLEVEL
					 , ZREGION 
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', ZITEM1_S) AS ZITEM1_S
				     , DECODE(ZITEM2_S, '-1', '-', ZITEM2_S) AS ZITEM2_S
				     , DECODE(ZITEM3_S, '-1', '-', ZITEM3_S) AS ZITEM3_S
				     , DECODE(ZITEM4_S, '-1', '-', ZITEM4_S) AS ZITEM4_S
				     , DECODE(ZITEM5_S, '-1', '-', ZITEM5_S) AS ZITEM5_S
				     , DECODE(ZITEM6_S, '-1', '-', ZITEM6_S) AS ZITEM6_S
				     , DECODE(ZITEM7_S, '-1', '-', ZITEM7_S) AS ZITEM7_S
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  AND ZREGION = #{session_zregion}
				  
				  UNION ALL
				  
				SELECT ZLEVEL
					 , ZREGION 
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', ZITEM1_S) AS ZITEM1_S
				     , DECODE(ZITEM2_S, '-1', '-', ZITEM2_S) AS ZITEM2_S
				     , DECODE(ZITEM3_S, '-1', '-', ZITEM3_S) AS ZITEM3_S
				     , DECODE(ZITEM4_S, '-1', '-', ZITEM4_S) AS ZITEM4_S
				     , DECODE(ZITEM5_S, '-1', '-', ZITEM5_S) AS ZITEM5_S
				     , DECODE(ZITEM6_S, '-1', '-', ZITEM6_S) AS ZITEM6_S
				     , DECODE(ZITEM7_S, '-1', '-', ZITEM7_S) AS ZITEM7_S
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '2'
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				  
				  UNION ALL
				  
				SELECT ZLEVEL
					 , ZREGION 
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', ZITEM1_S) AS ZITEM1_S
				     , DECODE(ZITEM2_S, '-1', '-', ZITEM2_S) AS ZITEM2_S
				     , DECODE(ZITEM3_S, '-1', '-', ZITEM3_S) AS ZITEM3_S
				     , DECODE(ZITEM4_S, '-1', '-', ZITEM4_S) AS ZITEM4_S
				     , DECODE(ZITEM5_S, '-1', '-', ZITEM5_S) AS ZITEM5_S
				     , DECODE(ZITEM6_S, '-1', '-', ZITEM6_S) AS ZITEM6_S
				     , DECODE(ZITEM7_S, '-1', '-', ZITEM7_S) AS ZITEM7_S
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL IN ('3', '4', '5')
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				</if>
		</if>
		ORDER BY ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 현장용 ] 주요지표 엑셀다운 건수				-->
	<!-- ********************************************** -->
	<resultMap type="exlMoniSumVO" id="excelMoniSum_ex_d_cnt">
		<id column="zlevel" 			property="zlevel" />
		<id column="zregion" 			property="zregion" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_id" 			property="zdept_id" />
		<id column="zdept_emp_nm" 		property="zdept_emp_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zdept_brch_nm" 		property="zdept_brch_nm" />
		<id column="zemp_nm" 			property="zemp_id" />
		<id column="zemp_id" 			property="zemp_nm" />
		<id column="zcls_nm" 			property="zcls_nm" />
		<id column="zcls_id" 			property="zcls_id" />
		<id column="zitem1_s" 			property="zitem1_s" />
		<id column="zitem2_s" 			property="zitem2_s" />
		<id column="zitem3_s" 			property="zitem3_s" />
		<id column="zitem4_s" 			property="zitem4_s" />
		<id column="zitem5_s" 			property="zitem5_s" />
		<id column="zitem6_s" 			property="zitem6_s" />
		<id column="zitem7_s" 			property="zitem7_s" />
		<id column="zadmin_rank1" 		property="zadmin_rank1" />
		<id column="zadmin_rank2" 		property="zadmin_rank2" />
	</resultMap>
	
	<select id="excelMoniSum_ex_d_cnt" parameterType="HashMap" resultMap="excelMoniSum_ex_d_cnt" >
	WITH RMS_TOTAL AS
	(
		SELECT A.*
			<if test='active_bcg_id == "N"'>
				, LAST_VALUE(ZADMIN_RANK IGNORE NULLS) OVER(ORDER BY A.ZREGION, A.ZDEPT_ID, A.ZDEPT_BRCH_ID, A.ZLEVEL) AS ZADMIN_RANK
				, LAST_VALUE(ZUP_RANK IGNORE NULLS) OVER(ORDER BY A.ZREGION, A.ZDEPT_ID, A.ZDEPT_BRCH_ID, A.ZLEVEL) AS ZUP_RANK
			</if>
			<if test='active_bcg_id == "C"'>
				, ZADMIN_RANK
				, ZUP_RANK
			</if>
			<if test='active_bcg_id == "S"'>
				, ZADMIN_RANK
				, ZUP_RANK
			</if>
		FROM ZSD7_RMS_TOTAL A
			, (SELECT *
               FROM ZSD7_RMS_ADMIN_R
               WHERE MANDT = '300'
               <choose>
			   		<when test='brch_gb == "LC"'>
						AND ZLEVEL IN ('1', '3')
					</when>
					<when test='brch_gb == "BL"'>
						AND ZLEVEL IN ('1', '2')
					</when>
					<otherwise>
						<if test='active_bcg_id == "N"'>
							AND ZLEVEL = '99'
						</if>
					</otherwise>
				</choose>
                ) B
		WHERE A.MANDT = '300'
        AND A.MANDT = B.MANDT(+)
        AND A.ZRMS_YM = B.ZRMS_YM(+)
        AND A.ZLEVEL = B.ZLEVEL(+)
        AND A.ZREGION = B.ZREGION(+)
        AND A.ZDEPT_ID = B.ZDEPT_ID(+)
        AND A.ZDEPT_BRCH_ID = B.ZDEPT_BRCH_ID(+)
		<if test='brch_gb == "LC"'>
			AND (A.ZLEVEL IN ('1', '2')
				OR (A.ZLEVEL IN ('3', '4', '5') AND EXISTS (SELECT 1 FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = TO_CHAR(ADD_MONTHS(TO_DATE(A.ZRMS_YM, 'YYYYMM'), -1), 'YYYYMM') AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID)))
		</if>
		<if test='brch_gb == "BL"'>   
			AND (A.ZLEVEL IN ('1', '2')
				OR (A.ZLEVEL IN ('3', '4', '5') AND NOT EXISTS (SELECT 1 FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = TO_CHAR(ADD_MONTHS(TO_DATE(A.ZRMS_YM, 'YYYYMM'), -1), 'YYYYMM') AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID)))
		</if>
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802' OR A.ZREGION = 'T410')
			</if>
			<if test='active_bcg_id == "C"'>
				AND A.ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND A.ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND A.ZRMS_YM = #{zreq_ym_b} 
				</if>
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			<if test='session_zregion_gb == "N"'>
				AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802')
			</if>
			<if test='session_zregion_gb == "C"'>
				AND A.ZREGION = 'T880'
			</if>
			<if test='session_zregion_gb == "S"'>
				AND A.ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND A.ZRMS_YM = #{zreq_ym_b} 
				</if>
			</if>
			AND A.ZREGION = #{session_zregion}
		</if>
	), RMS_TOTAL_R AS
		(
			SELECT MANDT, ZITEM_RATE, ZITEM_ID, ZLEVEL, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID
		    FROM ZSD7_RMS_TOTAL_R A
		    WHERE MANDT = '300'
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND A.ZRMS_YM = #{zreq_ym_b} 
				</if>
			</if>
           <choose>
				<when test='brch_gb == "LC"'>
					 AND ZLEVEL = '3'
				</when>
				<when test='brch_gb == "BL"'>
					 AND ZLEVEL = '2'
				</when>
				<otherwise>
					<if test='active_bcg_id == "N"'>
						AND ZLEVEL = '99'
					</if>
				</otherwise>
			</choose>
		    <if test='active_bcg_id == "N"'>
				AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802' OR A.ZREGION = 'T410')
			</if>
			<if test='active_bcg_id == "C"'>
				AND A.ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND A.ZREGION = 'T885'
			</if>
		    ORDER BY ZITEM_ID, TO_NUMBER(ZITEM_RANK)
		)
		(
		-- 상위20%
			SELECT 'A' AS ZLEVEL, ' ' AS ZREGION, ' ' AS ZREGION_NM, ' ' AS ZDEPT_NM, ' ' AS ZDEPT_ID, ' ' AS ZDEPT_EMP_NM, ' ' AS ZDEPT_BRCH_ID, ' ' AS ZDEPT_BRCH_NM, ' ' AS ZEMP_NM, ' ' AS ZEMP_ID, ' ' AS ZCLS_NM, ' ' AS ZCLS_ID
 				, TO_CHAR((SELECT (SELECT ZITEM1_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_arre') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_arre')*20/100))) AS ZITEM1_S
         	    , TO_CHAR((SELECT (SELECT ZITEM2_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_card') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_card')*20/100))) AS ZITEM2_S
         	    , TO_CHAR((SELECT (SELECT ZITEM3_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_info') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_info')*20/100))) AS ZITEM3_S
         	    , TO_CHAR((SELECT (SELECT ZITEM4_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_pay') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_pay')*20/100))) AS ZITEM4_S
         	    , TO_CHAR((SELECT (SELECT ZITEM5_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_stmng') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_stmng')*20/100))) AS ZITEM5_S
         	    , TO_CHAR((SELECT (SELECT ZITEM6_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_summ') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_summ')*20/100))) AS ZITEM6_S
         	    , TO_CHAR((SELECT (SELECT ZITEM7_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_tran') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_tran')*20/100))) AS ZITEM7_S
			    , ' ' AS ZADMIN_RANK1
                , ' ' AS ZADMIN_RANK2
			FROM DUAL
		
			UNION ALL
			
			<if test='session_zregion_gb == "A"'>
				SELECT ZLEVEL
		             , ZREGION
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ZSD7_LOGIN A WHERE MANDT = '300' AND ZAUTH_GRP = 'NC' AND ZLOCK = '1' AND VKBUR = A.ZDEPT_ID AND ROWNUM = 1
							AND EXISTS (SELECT 1 FROM KNVV WHERE MANDT = '300' AND KUNNR = A.KUNNR AND KVGR1 = '1')) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', ZITEM1_S) AS ZITEM1_S
				     , DECODE(ZITEM2_S, '-1', '-', ZITEM2_S) AS ZITEM2_S
				     , DECODE(ZITEM3_S, '-1', '-', ZITEM3_S) AS ZITEM3_S
				     , DECODE(ZITEM4_S, '-1', '-', ZITEM4_S) AS ZITEM4_S
				     , DECODE(ZITEM5_S, '-1', '-', ZITEM5_S) AS ZITEM5_S
				     , DECODE(ZITEM6_S, '-1', '-', ZITEM6_S) AS ZITEM6_S
				     , DECODE(ZITEM7_S, '-1', '-', ZITEM7_S) AS ZITEM7_S
				     , TO_CHAR(ZADMIN_RANK) AS ZADMIN_RANK1
				     , TO_CHAR(ZUP_RANK) AS ZADMIN_RANK2
		    FROM RMS_TOTAL A
		    WHERE MANDT = '300'
		    AND ((ZLEVEL = '1' AND EXISTS (SELECT 1 FROM RMS_TOTAL WHERE MANDT = '300' AND ZRMS_YM = A.ZRMS_YM AND ZLEVEL = '2' AND ZREGION = A.ZREGION)) OR 
			     (ZLEVEL = '2' AND EXISTS (SELECT 1 FROM RMS_TOTAL WHERE MANDT = '300' AND ZRMS_YM = A.ZRMS_YM AND ZLEVEL = '3' AND ZREGION = A.ZREGION AND ZDEPT_ID = A.ZDEPT_ID)) OR
			      ZLEVEL IN ('3', '4', '5'))
			</if>
			<if test='session_zregion_gb != "A"'>
				<if test='session_zauth_grp == "NI" or session_zauth_grp == "NX"'>
				SELECT ZLEVEL
		             , ZREGION
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ZSD7_LOGIN A WHERE MANDT = '300' AND ZAUTH_GRP = 'NC' AND ZLOCK = '1' AND VKBUR = A.ZDEPT_ID AND ROWNUM = 1
							AND EXISTS (SELECT 1 FROM KNVV WHERE MANDT = '300' AND KUNNR = A.KUNNR AND KVGR1 = '1')) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', ZITEM1_S) AS ZITEM1_S
				     , DECODE(ZITEM2_S, '-1', '-', ZITEM2_S) AS ZITEM2_S
				     , DECODE(ZITEM3_S, '-1', '-', ZITEM3_S) AS ZITEM3_S
				     , DECODE(ZITEM4_S, '-1', '-', ZITEM4_S) AS ZITEM4_S
				     , DECODE(ZITEM5_S, '-1', '-', ZITEM5_S) AS ZITEM5_S
				     , DECODE(ZITEM6_S, '-1', '-', ZITEM6_S) AS ZITEM6_S
				     , DECODE(ZITEM7_S, '-1', '-', ZITEM7_S) AS ZITEM7_S
				     , TO_CHAR(ZADMIN_RANK) AS ZADMIN_RANK1
				     , TO_CHAR(ZUP_RANK) AS ZADMIN_RANK2
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  
				  UNION ALL
				  
				SELECT ZLEVEL
		             , ZREGION
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ZSD7_LOGIN A WHERE MANDT = '300' AND ZAUTH_GRP = 'NC' AND ZLOCK = '1' AND VKBUR = A.ZDEPT_ID AND ROWNUM = 1
							AND EXISTS (SELECT 1 FROM KNVV WHERE MANDT = '300' AND KUNNR = A.KUNNR AND KVGR1 = '1')) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', ZITEM1_S) AS ZITEM1_S
				     , DECODE(ZITEM2_S, '-1', '-', ZITEM2_S) AS ZITEM2_S
				     , DECODE(ZITEM3_S, '-1', '-', ZITEM3_S) AS ZITEM3_S
				     , DECODE(ZITEM4_S, '-1', '-', ZITEM4_S) AS ZITEM4_S
				     , DECODE(ZITEM5_S, '-1', '-', ZITEM5_S) AS ZITEM5_S
				     , DECODE(ZITEM6_S, '-1', '-', ZITEM6_S) AS ZITEM6_S
				     , DECODE(ZITEM7_S, '-1', '-', ZITEM7_S) AS ZITEM7_S
				     , TO_CHAR(ZADMIN_RANK) AS ZADMIN_RANK1
				     , TO_CHAR(ZUP_RANK) AS ZADMIN_RANK2
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL IN ('2', '3', '4', '5')
				  AND ZREGION = #{session_zregion}
				</if>
				<if test='session_zauth_grp == "NC"'>
				SELECT ZLEVEL
		             , ZREGION
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ZSD7_LOGIN A WHERE MANDT = '300' AND ZAUTH_GRP = 'NC' AND ZLOCK = '1' AND VKBUR = A.ZDEPT_ID AND ROWNUM = 1
							AND EXISTS (SELECT 1 FROM KNVV WHERE MANDT = '300' AND KUNNR = A.KUNNR AND KVGR1 = '1')) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', ZITEM1_S) AS ZITEM1_S
				     , DECODE(ZITEM2_S, '-1', '-', ZITEM2_S) AS ZITEM2_S
				     , DECODE(ZITEM3_S, '-1', '-', ZITEM3_S) AS ZITEM3_S
				     , DECODE(ZITEM4_S, '-1', '-', ZITEM4_S) AS ZITEM4_S
				     , DECODE(ZITEM5_S, '-1', '-', ZITEM5_S) AS ZITEM5_S
				     , DECODE(ZITEM6_S, '-1', '-', ZITEM6_S) AS ZITEM6_S
				     , DECODE(ZITEM7_S, '-1', '-', ZITEM7_S) AS ZITEM7_S
				     , TO_CHAR(ZADMIN_RANK) AS ZADMIN_RANK1
				     , TO_CHAR(ZUP_RANK) AS ZADMIN_RANK2
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  AND ZREGION = #{session_zregion}
				  
				  UNION ALL
				  
				SELECT ZLEVEL
		             , ZREGION
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ZSD7_LOGIN A WHERE MANDT = '300' AND ZAUTH_GRP = 'NC' AND ZLOCK = '1' AND VKBUR = A.ZDEPT_ID AND ROWNUM = 1
							AND EXISTS (SELECT 1 FROM KNVV WHERE MANDT = '300' AND KUNNR = A.KUNNR AND KVGR1 = '1')) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', ZITEM1_S) AS ZITEM1_S
				     , DECODE(ZITEM2_S, '-1', '-', ZITEM2_S) AS ZITEM2_S
				     , DECODE(ZITEM3_S, '-1', '-', ZITEM3_S) AS ZITEM3_S
				     , DECODE(ZITEM4_S, '-1', '-', ZITEM4_S) AS ZITEM4_S
				     , DECODE(ZITEM5_S, '-1', '-', ZITEM5_S) AS ZITEM5_S
				     , DECODE(ZITEM6_S, '-1', '-', ZITEM6_S) AS ZITEM6_S
				     , DECODE(ZITEM7_S, '-1', '-', ZITEM7_S) AS ZITEM7_S
				     , TO_CHAR(ZADMIN_RANK) AS ZADMIN_RANK1
				     , TO_CHAR(ZUP_RANK) AS ZADMIN_RANK2
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL IN ('2', '3', '4', '5')
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				</if>
				<if test='session_zauth_grp == "NP"'>
				SELECT ZLEVEL
		             , ZREGION
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ZSD7_LOGIN A WHERE MANDT = '300' AND ZAUTH_GRP = 'NC' AND ZLOCK = '1' AND VKBUR = A.ZDEPT_ID AND ROWNUM = 1
							AND EXISTS (SELECT 1 FROM KNVV WHERE MANDT = '300' AND KUNNR = A.KUNNR AND KVGR1 = '1')) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', ZITEM1_S) AS ZITEM1_S
				     , DECODE(ZITEM2_S, '-1', '-', ZITEM2_S) AS ZITEM2_S
				     , DECODE(ZITEM3_S, '-1', '-', ZITEM3_S) AS ZITEM3_S
				     , DECODE(ZITEM4_S, '-1', '-', ZITEM4_S) AS ZITEM4_S
				     , DECODE(ZITEM5_S, '-1', '-', ZITEM5_S) AS ZITEM5_S
				     , DECODE(ZITEM6_S, '-1', '-', ZITEM6_S) AS ZITEM6_S
				     , DECODE(ZITEM7_S, '-1', '-', ZITEM7_S) AS ZITEM7_S
				     , TO_CHAR(ZADMIN_RANK) AS ZADMIN_RANK1
				     , TO_CHAR(ZUP_RANK) AS ZADMIN_RANK2
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  AND ZREGION = #{session_zregion}
				  
				  UNION ALL
				  
				SELECT ZLEVEL
		             , ZREGION
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ZSD7_LOGIN A WHERE MANDT = '300' AND ZAUTH_GRP = 'NC' AND ZLOCK = '1' AND VKBUR = A.ZDEPT_ID AND ROWNUM = 1
							AND EXISTS (SELECT 1 FROM KNVV WHERE MANDT = '300' AND KUNNR = A.KUNNR AND KVGR1 = '1')) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', ZITEM1_S) AS ZITEM1_S
				     , DECODE(ZITEM2_S, '-1', '-', ZITEM2_S) AS ZITEM2_S
				     , DECODE(ZITEM3_S, '-1', '-', ZITEM3_S) AS ZITEM3_S
				     , DECODE(ZITEM4_S, '-1', '-', ZITEM4_S) AS ZITEM4_S
				     , DECODE(ZITEM5_S, '-1', '-', ZITEM5_S) AS ZITEM5_S
				     , DECODE(ZITEM6_S, '-1', '-', ZITEM6_S) AS ZITEM6_S
				     , DECODE(ZITEM7_S, '-1', '-', ZITEM7_S) AS ZITEM7_S
				     , TO_CHAR(ZADMIN_RANK) AS ZADMIN_RANK1
				     , TO_CHAR(ZUP_RANK) AS ZADMIN_RANK2
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '2'
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				  
				  UNION ALL
				  
				SELECT ZLEVEL
		             , ZREGION
					 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		             , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		             , ZDEPT_ID
		             , (SELECT ZNM FROM ZSD7_LOGIN A WHERE MANDT = '300' AND ZAUTH_GRP = 'NC' AND ZLOCK = '1' AND VKBUR = A.ZDEPT_ID AND ROWNUM = 1
							AND EXISTS (SELECT 1 FROM KNVV WHERE MANDT = '300' AND KUNNR = A.KUNNR AND KVGR1 = '1')) AS ZDEPT_EMP_NM
		             , ZDEPT_BRCH_ID
		             , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
		             , DECODE(A.ZEMP_ID , ' ', ' ', (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1)) AS ZEMP_NM
		             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		             , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		             , ZCLS_ID
				     , DECODE(ZITEM1_S, '-1', '-', ZITEM1_S) AS ZITEM1_S
				     , DECODE(ZITEM2_S, '-1', '-', ZITEM2_S) AS ZITEM2_S
				     , DECODE(ZITEM3_S, '-1', '-', ZITEM3_S) AS ZITEM3_S
				     , DECODE(ZITEM4_S, '-1', '-', ZITEM4_S) AS ZITEM4_S
				     , DECODE(ZITEM5_S, '-1', '-', ZITEM5_S) AS ZITEM5_S
				     , DECODE(ZITEM6_S, '-1', '-', ZITEM6_S) AS ZITEM6_S
				     , DECODE(ZITEM7_S, '-1', '-', ZITEM7_S) AS ZITEM7_S
				     , TO_CHAR(ZADMIN_RANK) AS ZADMIN_RANK1
				     , TO_CHAR(ZUP_RANK) AS ZADMIN_RANK2
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL IN ('3', '4', '5')
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				</if>
			</if>
		)
		<choose>
			<when test='brch_gb == "LC"'>
		        <choose>
					<when test='order == "DESC"'>
						ORDER BY ZREGION, ZDEPT_ID, DECODE(ZLEVEL, '2', 1, 2), TO_NUMBER(DECODE(ZADMIN_RANK, '-', '9999', ' ', '9999', ZADMIN_RANK)) DESC, ZDEPT_BRCH_ID, ZEMP_ID, ZCLS_ID, ZLEVEL
					</when>
					<when test='order == "ASC"'>
						 ORDER BY ZREGION, ZDEPT_ID, DECODE(ZLEVEL, '2', 1, 2),TO_NUMBER(DECODE(ZADMIN_RANK, '-', '9999', ' ', '9999', ZADMIN_RANK)) ASC, ZDEPT_BRCH_ID, ZEMP_ID, ZCLS_ID, ZLEVEL
					</when>
					<otherwise>
						ORDER BY ZREGION, ZDEPT_ID NULLS FIRST, ZDEPT_BRCH_ID NULLS FIRST, ZEMP_ID NULLS FIRST, ZCLS_ID NULLS FIRST, ZLEVEL
					</otherwise>
				</choose>
			</when>
			<when test='brch_gb == "BL"'>
		        <choose>
					<when test='order == "DESC"'>
						ORDER BY ZREGION, DECODE(ZLEVEL, '1', 1, 2), TO_NUMBER(DECODE(ZADMIN_RANK, '-', '9999', ' ', '9999', ZADMIN_RANK)) DESC, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID, ZCLS_ID, ZLEVEL
					</when>
					<when test='order == "ASC"'>
						ORDER BY ZREGION, DECODE(ZLEVEL, '1', 1, 2), TO_NUMBER(DECODE(ZADMIN_RANK, '-', '9999', ' ', '9999', ZADMIN_RANK)) ASC, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID, ZCLS_ID, ZLEVEL
					</when>
					<otherwise>
						ORDER BY ZREGION, ZDEPT_ID NULLS FIRST, ZDEPT_BRCH_ID NULLS FIRST, ZEMP_ID NULLS FIRST, ZCLS_ID NULLS FIRST, ZLEVEL
					</otherwise>
				</choose>
			</when>
			<otherwise>
				ORDER BY ZREGION, ZDEPT_ID NULLS FIRST, ZDEPT_BRCH_ID NULLS FIRST, ZEMP_ID NULLS FIRST, ZCLS_ID NULLS FIRST, ZLEVEL
			</otherwise>
		</choose>
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 현장용 ] 긴급교재 엑셀다운					-->
	<!-- ********************************************** -->
	<resultMap type="exlStmApplyVO" id="exlStmApply_d">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zemp_nm" 			property="zemp_nm" />
		<id column="zemp_id" 			property="zemp_id" />
		<id column="zauth_grp" 			property="zauth_grp" />
		<id column="zmon_cnt" 			property="zmon_cnt" />
		<id column="znew_cnt" 			property="znew_cnt" />
		<id column="znew_rate" 			property="znew_rate" />
		<id column="zreq_cnt" 			property="zreq_cnt" />
		<id column="zreq_vol" 			property="zreq_vol" />
		<id column="zmon_cnt_p" 		property="zmon_cnt_p" />
		<id column="zreq_non_vol" 		property="zreq_non_vol" />
		<id column="zgrund_01" 			property="zgrund_01" />
		<id column="zgrund_01_p" 		property="zgrund_01_p" />
		<id column="zgrund_04" 			property="zgrund_04" />
		<id column="zgrund_04_p" 		property="zgrund_04_p" />
		<id column="zgrund_06" 			property="zgrund_06" />
		<id column="zgrund_06_p" 		property="zgrund_06_p" />
		<id column="zgrund_03" 			property="zgrund_03" />
		<id column="zgrund_03_p" 		property="zgrund_03_p" />
		<id column="zgrund_05" 			property="zgrund_05" />
		<id column="zgrund_05_p" 		property="zgrund_05_p" />
		<id column="zgrund_07" 			property="zgrund_07" />
		<id column="zgrund_07_p" 		property="zgrund_07_p" />
		<id column="zgrund_etc" 		property="zgrund_etc" />
		<id column="zgrund_etc_p" 		property="zgrund_etc_p" />
	</resultMap>
	
	<select id="excelStmApply_d" parameterType="HashMap" resultMap="exlStmApply_d" > 
		SELECT ZRMS_YM
			 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
			 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
			 , ZDEPT_BRCH_ID || DECODE(TRIM(ZLC_NM), '', ' ', '(' || ZLC_NM || ')') AS ZDEPT_BRCH_ID
             , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
			 , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
			 , DECODE((SELECT ZAUTH_GRP FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = ZEMP_ID AND ROWNUM = 1), 'NC', '사업국장', 'NE', '행정교사', 'NP', '팀장', 'NT', '교사') AS ZAUTH_GRP
		     , ZMON_CNT 
		     , ZNEW_CNT	
		     , RTRIM(TO_CHAR(ZNEW_RATE, 'FM9990.00'), '.') AS ZNEW_RATE
		     , ZREQ_CNT	
		     , ZREQ_VOL	
		     , RTRIM(TO_CHAR(ROUND(DECODE(ZMON_CNT, 0, 0, (ZREQ_VOL / ZMON_CNT)*100), 1), 'FM9990.00'), '.') AS ZMON_CNT_P
		     , ZREQ_NON_VOL
		     , ZGRUND_01 -- 신입(복회)
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_01 / ZREQ_VOL)*100), 1)) AS ZGRUND_01_P -- 신입(복회) 비중
		     , ZGRUND_04 -- 진도변경(오류)
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_04 / ZREQ_VOL)*100), 1)) AS ZGRUND_04_P -- 진도변경(오류) 비중
		     , ZGRUND_06 -- 교재추가 불출
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_06 / ZREQ_VOL)*100), 1)) AS ZGRUND_06_P -- 교재추가 불출 비중
		     , ZGRUND_03 -- 전환
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_03 / ZREQ_VOL)*100), 1)) AS ZGRUND_03_P -- 전환 비중
		     , ZGRUND_05 -- 입회 유도샘플
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_05 / ZREQ_VOL)*100), 1)) AS ZGRUND_05_P -- 입회 유도샘플 비중
		     , ZGRUND_07 -- 진도 미입력
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_07 / ZREQ_VOL)*100), 1)) AS ZGRUND_07_P -- 진도 미입력 비중
		     , (ZGRUND_02+ZGRUND_08+ZGRUND_09+ZGRUND_10+ZGRUND_11+ZGRUND_12+ZGRUND_13+ZGRUND_14+ZGRUND_15+ZGRUND_16) AS ZGRUND_ETC -- 기타
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, ((ZGRUND_02+ZGRUND_08+ZGRUND_09+ZGRUND_10+ZGRUND_11+ZGRUND_12+ZGRUND_13+ZGRUND_14+ZGRUND_15+ZGRUND_16) / ZREQ_VOL)*100), 1)) AS ZGRUND_ETC_P -- 기타 비중
		FROM ZSD7_RMS_STMNG_D A
		WHERE MANDT = '300'
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802' OR ZREGION = 'T410') -- T410 : 성장사업본부
			</if>
			<if test='active_bcg_id == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			<if test='zregion != null and zregion != ""'>
				AND ZREGION = #{zregion}
			</if>
			<if test='zdept_id != null and zdept_id != ""'>
				AND ZDEPT_ID = #{zdept_id}
			</if>
			<if test='zdept_brch_id != null and zdept_brch_id != ""'>
				AND ZDEPT_BRCH_ID = #{zdept_brch_id}
			</if>
			<if test='zemp_id != null and zemp_id != ""'>
				AND ZEMP_ID = #{zemp_id}
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			<if test='session_zregion_gb == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802')
			</if>
			<if test='session_zregion_gb == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='session_zregion_gb == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			
			<if test="session_zauth_grp == 'NI' or session_zauth_grp == 'NX'">
				AND ZREGION = #{session_zregion}
				<if test='zdept_id != null and zdept_id != ""'>
					AND ZDEPT_ID = #{zdept_id}
				</if>
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if> 
			<if test="session_zauth_grp == 'NC' or session_zauth_grp == 'NE'">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
			<if test="session_zauth_grp == 'NP' ">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				AND ZDEPT_BRCH_ID = #{session_zdept_brch_id}
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
		</if>
		ORDER BY ZRMS_YM DESC, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 관리용 ] 긴급교재 엑셀다운					-->
	<!-- ********************************************** -->
	<resultMap type="exlStmApplyVO" id="exlStmApply_da">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zemp_id" 			property="zemp_id" />
		<id column="zauth_grp" 			property="zauth_grp" />
		<id column="zemp_nm" 			property="zemp_nm" />
		<id column="zmon_cnt" 			property="zmon_cnt" />
		<id column="znew_cnt" 			property="znew_cnt" />
		<id column="znew_rate" 			property="znew_rate" />
		<id column="zreq_cnt" 			property="zreq_cnt" />
		<id column="zreq_vol" 			property="zreq_vol" />
		<id column="zmon_cnt_p" 		property="zmon_cnt_p" />
		<id column="zreq_non_vol" 		property="zreq_non_vol" />
		<id column="zgrund_01" 			property="zgrund_01" />
		<id column="zgrund_01_p" 		property="zgrund_01_p" />
		<id column="zgrund_04" 			property="zgrund_04" />
		<id column="zgrund_04_p" 		property="zgrund_04_p" />
		<id column="zgrund_06" 			property="zgrund_06" />
		<id column="zgrund_06_p" 		property="zgrund_06_p" />
		<id column="zgrund_03" 			property="zgrund_03" />
		<id column="zgrund_03_p" 		property="zgrund_03_p" />
		<id column="zgrund_05" 			property="zgrund_05" />
		<id column="zgrund_05_p" 		property="zgrund_05_p" />
		<id column="zgrund_07" 			property="zgrund_07" />
		<id column="zgrund_07_p" 		property="zgrund_07_p" />
		<id column="zgrund_02" 			property="zgrund_02" />
		<id column="zgrund_02_p" 		property="zgrund_02_p" />
		<id column="zgrund_08" 			property="zgrund_08" />
		<id column="zgrund_08_p" 		property="zgrund_08_p" />
		<id column="zgrund_09" 			property="zgrund_09" />
		<id column="zgrund_09_p" 		property="zgrund_09_p" />
		<id column="zgrund_11" 			property="zgrund_11" />
		<id column="zgrund_11_p" 		property="zgrund_11_p" />
		<id column="zgrund_10" 			property="zgrund_10" />
		<id column="zgrund_10_p" 		property="zgrund_10_p" />
		<id column="zgrund_13" 			property="zgrund_13" />
		<id column="zgrund_13_p" 		property="zgrund_13_p" />
		<id column="zgrund_12" 			property="zgrund_12" />
		<id column="zgrund_12_p" 		property="zgrund_12_p" />
		<id column="zgrund_14" 			property="zgrund_14" />
		<id column="zgrund_14_p" 		property="zgrund_14_p" />
	</resultMap>
	
	<select id="excelStmApply_da" parameterType="HashMap" resultMap="exlStmApply_da" > 
		SELECT ZRMS_YM
			 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
			 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
			 , ZDEPT_BRCH_ID || DECODE(TRIM(ZLC_NM), '', ' ', '(' || ZLC_NM || ')') AS ZDEPT_BRCH_ID
             , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
             , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
             , DECODE((SELECT ZAUTH_GRP FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = ZEMP_ID AND ROWNUM = 1), 'NC', '사업국장', 'NE', '행정교사', 'NP', '팀장', 'NT', '교사') AS ZAUTH_GRP
		     , ZMON_CNT 
		     , ZNEW_CNT	
		     , RTRIM(TO_CHAR(ZNEW_RATE, 'FM9990.00'), '.') AS ZNEW_RATE 	
		     , ZREQ_CNT	
		     , ZREQ_VOL	
		     , RTRIM(TO_CHAR(ROUND(DECODE(ZMON_CNT, 0, 0, (ZREQ_VOL / ZMON_CNT)*100), 1), 'FM9990.00'), '.') AS ZMON_CNT_P
		     , ZREQ_NON_VOL
		     , ZGRUND_01 -- 신입(복회)
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_01 / ZREQ_VOL)*100), 1)) AS ZGRUND_01_P -- 신입(복회) 비중
		     , ZGRUND_04 -- 진도변경(오류)
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_04 / ZREQ_VOL)*100), 1)) AS ZGRUND_04_P -- 진도변경(오류) 비중
		     , ZGRUND_06 -- 교재추가 불출
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_06 / ZREQ_VOL)*100), 1)) AS ZGRUND_06_P -- 교재추가 불출 비중
		     , ZGRUND_03 -- 전환
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_03 / ZREQ_VOL)*100), 1)) AS ZGRUND_03_P -- 전환 비중
		     , ZGRUND_05 -- 입회 유도샘플
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_05 / ZREQ_VOL)*100), 1)) AS ZGRUND_05_P -- 입회 유도샘플 비중
		     , ZGRUND_07 -- 진도 미입력
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_07 / ZREQ_VOL)*100), 1)) AS ZGRUND_07_P -- 진도 미입력 비중
		     , ZGRUND_02 -- 전입 미입력
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_02 / ZREQ_VOL)*100), 1)) AS ZGRUND_02_P -- 전입 비중
		     , ZGRUND_08 -- 물류배송오류
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_08 / ZREQ_VOL)*100), 1)) AS ZGRUND_08_P -- 물류배송오류 비중
		     , ZGRUND_09 -- 교실분리 인수인계
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_09 / ZREQ_VOL)*100), 1)) AS ZGRUND_09_P -- 교실분리 인수인계 비중
		     , ZGRUND_11 -- SP교재신청
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_11 / ZREQ_VOL)*100), 1)) AS ZGRUND_11_P -- SP교재신청 비중
		     , ZGRUND_10 -- 기타파손, 분실등
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_10 / ZREQ_VOL)*100), 1)) AS ZGRUND_10_P -- 기타파손, 분실등 비중
		     , ZGRUND_13 -- 교육용
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_13 / ZREQ_VOL)*100), 1)) AS ZGRUND_13_P -- 교육용 비중
		     , ZGRUND_12 -- 해외이민
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_12 / ZREQ_VOL)*100), 1)) AS ZGRUND_12_P -- 해외이민 비중
		     , ZGRUND_14 -- MCM
		     , TO_CHAR(ROUND(DECODE(ZREQ_VOL, 0, 0, (ZGRUND_14 / ZREQ_VOL)*100), 1)) AS ZGRUND_14_P -- MCM 비중
		FROM ZSD7_RMS_STMNG_D A
		WHERE MANDT = '300'
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802' OR ZREGION = 'T410') -- T410 : 성장사업본부
			</if>
			<if test='active_bcg_id == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			<if test='zregion != null and zregion != ""'>
				AND ZREGION = #{zregion}
			</if>
			<if test='zdept_id != null and zdept_id != ""'>
				AND ZDEPT_ID = #{zdept_id}
			</if>
			<if test='zdept_brch_id != null and zdept_brch_id != ""'>
				AND ZDEPT_BRCH_ID = #{zdept_brch_id}
			</if>
			<if test='zemp_id != null and zemp_id != ""'>
				AND ZEMP_ID = #{zemp_id}
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			AND 1 = 2
		</if>
		ORDER BY ZRMS_YM DESC, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 현장용 ] 써밋제품미학습Risk 엑셀다운			-->
	<!-- ********************************************** -->
	<resultMap type="exlSmiRiskVO" id="exlSmiRisk_d">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zemp_nm" 			property="zemp_nm" />
		<id column="zemp_id" 			property="zemp_id" />
		<id column="zauth_grp" 			property="zauth_grp" />
		<id column="zlc_nm" 			property="zlc_nm" />
		<id column="kunnr" 				property="kunnr" />
		<id column="zmbr_nm" 			property="zmbr_nm" />
		<id column="zgrade_cde" 		property="zgrade_cde" />
		<id column="matnr" 				property="matnr" />
		<id column="matnr_nm" 			property="matnr_nm" />
		<id column="zcls_nm" 			property="zcls_nm" />
		<id column="zdup_month" 		property="zdup_month" />
	</resultMap>
	
	<select id="excelSmiRisk_d" parameterType="HashMap" resultMap="exlSmiRisk_d" > 
		SELECT ZRMS_YM 
             , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
		     , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		     , DECODE((SELECT ZAUTH_GRP FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = ZEMP_ID AND ROWNUM = 1), 'NC', '사업국장', 'NE', '행정교사', 'NP', '팀장', 'NT', '교사') AS ZAUTH_GRP
		     , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
		     , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
		     , ZDEPT_BRCH_ID || DECODE(TRIM(ZLC_NM), '', ' ', '(' || ZLC_NM || ')') AS ZDEPT_BRCH_ID
		     , ZLC_NM
		     , KUNNR
		     , ZMBR_NM
		     , ZGRADE_CDE
		     , MATNR
		     , (SELECT MAKTX FROM MAKT WHERE MANDT = '300' AND MATNR = A.MATNR) AS MATNR_NM
		     , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
		     , DECODE(ZDUP_MONTH, 0, ' ', ZDUP_MONTH) AS ZDUP_MONTH
		FROM ZSD7_RMS_SUMM_D A
		WHERE MANDT = '300'
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802' OR ZREGION = 'T410') -- T410 : 성장사업본부
			</if>
			<if test='active_bcg_id == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			<if test='zregion != null and zregion != ""'>
				AND ZREGION = #{zregion}
			</if>
			<if test='zdept_id != null and zdept_id != ""'>
				AND ZDEPT_ID = #{zdept_id}
			</if>
			<if test='zdept_brch_id != null and zdept_brch_id != ""'>
				AND ZDEPT_BRCH_ID = #{zdept_brch_id}
			</if>
			<if test='zemp_id != null and zemp_id != ""'>
				AND ZEMP_ID = #{zemp_id}
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			<if test='session_zregion_gb == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802')
			</if>
			<if test='session_zregion_gb == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='session_zregion_gb == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			
			<if test="session_zauth_grp == 'NI' or session_zauth_grp == 'NX'">
				AND ZREGION = #{session_zregion}
				<if test='zdept_id != null and zdept_id != ""'>
					AND ZDEPT_ID = #{zdept_id}
				</if>
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if> 
			<if test="session_zauth_grp == 'NC' or session_zauth_grp == 'NE'">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
			<if test="session_zauth_grp == 'NP' ">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				AND ZDEPT_BRCH_ID = #{session_zdept_brch_id}
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
		</if>
		ORDER BY ZRMS_YM DESC, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 현장용 ] 월별 모니터링 엑셀다운				-->
	<!-- ********************************************** -->
	<resultMap type="exlMonMoniVO" id="exlMonMoni_d">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zitem1_p" 			property="zitem1_p" />
		<id column="zitem2_p" 			property="zitem2_p" />
		<id column="zitem3_p" 			property="zitem3_p" />
		<id column="zitem4_p" 			property="zitem4_p" />
		<id column="zitem5_p" 			property="zitem5_p" />
		<id column="zitem6_p" 			property="zitem6_p" />
		<id column="zitem7_p" 			property="zitem7_p" />
		<id column="zadmin_rank" 		property="zadmin_rank" />
		<id column="zup_rank" 			property="zup_rank" />
	</resultMap>
	
	<select id="excelMonMoni_d" parameterType="HashMap" resultMap="exlMonMoni_d" >
	    WITH RMS_TOTAL AS
        (
                SELECT A.*
                     , ZADMIN_RANK
                     , ZUP_RANK
                FROM ZSD7_RMS_TOTAL A
                   , ZSD7_RMS_ADMIN_R B
                WHERE A.MANDT = '300'
                AND A.ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
                AND A.ZLEVEL = #{zlevel}
                AND A.MANDT = B.MANDT(+)
                AND A.ZRMS_YM = B.ZRMS_YM(+)
                AND A.ZLEVEL = B.ZLEVEL(+)
                AND A.ZREGION = B.ZREGION(+)
                AND A.ZDEPT_ID = B.ZDEPT_ID(+)
                AND A.ZDEPT_BRCH_ID = B.ZDEPT_BRCH_ID(+)
				<if test='zlevel == "1"'>
					AND A.ZREGION = #{zregion}
				</if>
				<if test='zlevel == "2"'>
					AND A.ZREGION = #{zregion}
					AND A.ZDEPT_ID = #{zdept_id}
				</if>
				<if test='zlevel == "3"'>
					AND A.ZREGION = #{zregion}
					AND A.ZDEPT_ID = #{zdept_id}
					AND A.ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zlevel == "4"'>
					AND A.ZREGION = #{zregion}
					AND A.ZDEPT_ID = #{zdept_id}
					AND A.ZDEPT_BRCH_ID = #{zdept_brch_id}
					AND A.ZEMP_ID = #{zemp_id}
				</if>
        )
        SELECT '' ZRMS_YM
    	    , RTRIM(TO_CHAR(ROUND(
                      CASE 
                          WHEN SUM(ZITEM1_S) = 0 OR SUM(ZITEM1_T) = 0
                          THEN 0
                          ELSE SUM(ZITEM1_S)/SUM(ZITEM1_T)*100
                      END   
                  , 2), 'FM9990.00'), '.') AS ZITEM1_P
    	    , RTRIM(TO_CHAR(ROUND(
                      CASE 
                          WHEN SUM(ZITEM2_S) = 0 OR SUM(ZITEM2_T) = 0
                          THEN 0
                          ELSE SUM(ZITEM2_S)/SUM(ZITEM2_T)*100
                      END   
                  , 2), 'FM9990.00'), '.') AS ZITEM2_P
    	    , RTRIM(TO_CHAR(ROUND(
                      CASE 
                          WHEN SUM(ZITEM3_S) = 0 OR SUM(ZITEM3_T) = 0
                          THEN 0
                          ELSE SUM(ZITEM3_S)/SUM(ZITEM3_T)*100
                      END   
                  , 2), 'FM9990.00'), '.') AS ZITEM3_P
    	    , RTRIM(TO_CHAR(ROUND(
                      CASE 
                          WHEN SUM(ZITEM4_S) = 0 OR SUM(ZITEM4_T) = 0
                          THEN 0
                          ELSE SUM(ZITEM4_S)/SUM(ZITEM4_T)*100
                      END   
                  , 2), 'FM9990.00'), '.') AS ZITEM4_P
    	    , RTRIM(TO_CHAR(ROUND(
                      CASE 
                          WHEN SUM(ZITEM5_S) = 0 OR SUM(ZITEM5_T) = 0
                          THEN 0
                          ELSE SUM(ZITEM5_S)/SUM(ZITEM5_T)*100
                      END   
                  , 2), 'FM9990.00'), '.') AS ZITEM5_P
    	    , RTRIM(TO_CHAR(ROUND(
                      CASE 
                          WHEN SUM(ZITEM6_S) = 0 OR SUM(ZITEM6_T) = 0
                          THEN 0
                          ELSE SUM(ZITEM6_S)/SUM(ZITEM6_T)*100
                      END   
                  , 2), 'FM9990.00'), '.') AS ZITEM6_P
    	    , RTRIM(TO_CHAR(ROUND(
                      CASE 
                          WHEN SUM(ZITEM7_S) = 0 OR SUM(ZITEM7_T) = 0
                          THEN 0
                          ELSE SUM(ZITEM7_S)/SUM(ZITEM7_T)*100
                      END   
                  , 2), 'FM9990.00'), '.') AS ZITEM7_P
            , ' ' AS ZADMIN_RANK
            , ' ' AS ZUP_RANK
          FROM RMS_TOTAL
    
          UNION ALL
    
          SELECT ZRMS_YM
               , RTRIM(TO_CHAR(ROUND(ZITEM1_P, 2), 'FM9990.00'), '.') AS ZITEM1_P
               , RTRIM(TO_CHAR(ROUND(ZITEM2_P, 2), 'FM9990.00'), '.') AS ZITEM2_P
               , RTRIM(TO_CHAR(ROUND(ZITEM3_P, 2), 'FM9990.00'), '.') AS ZITEM3_P
               , RTRIM(TO_CHAR(ROUND(ZITEM4_P, 2), 'FM9990.00'), '.') AS ZITEM4_P
               , RTRIM(TO_CHAR(ROUND(ZITEM5_P, 2), 'FM9990.00'), '.') AS ZITEM5_P
               , RTRIM(TO_CHAR(ROUND(ZITEM6_P, 2), 'FM9990.00'), '.') AS ZITEM6_P
               , RTRIM(TO_CHAR(ROUND(ZITEM7_P, 2), 'FM9990.00'), '.') AS ZITEM7_P
               , NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK
               , NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZUP_RANK
          FROM RMS_TOTAL
          
          ORDER BY ZRMS_YM NULLS FIRST
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 현장용 ] 월별 모니터링 엑셀다운-대상건수		-->
	<!-- ********************************************** -->
	<select id="excelMonMoni_d_cnt" parameterType="HashMap" resultMap="exlMonMoni_d" >
	    WITH RMS_TOTAL AS
        (
                SELECT A.*
                     , ZADMIN_RANK
                     , ZUP_RANK
                FROM ZSD7_RMS_TOTAL A
                   , ZSD7_RMS_ADMIN_R B
                WHERE A.MANDT = '300'
                AND A.ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
                AND A.ZLEVEL = #{zlevel}
                AND A.MANDT = B.MANDT(+)
                AND A.ZRMS_YM = B.ZRMS_YM(+)
                AND A.ZLEVEL = B.ZLEVEL(+)
                AND A.ZREGION = B.ZREGION(+)
                AND A.ZDEPT_ID = B.ZDEPT_ID(+)
                AND A.ZDEPT_BRCH_ID = B.ZDEPT_BRCH_ID(+)
				<if test='zlevel == "1"'>
					AND A.ZREGION = #{zregion}
				</if>
				<if test='zlevel == "2"'>
					AND A.ZREGION = #{zregion}
					AND A.ZDEPT_ID = #{zdept_id}
				</if>
				<if test='zlevel == "3"'>
					AND A.ZREGION = #{zregion}
					AND A.ZDEPT_ID = #{zdept_id}
					AND A.ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zlevel == "4"'>
					AND A.ZREGION = #{zregion}
					AND A.ZDEPT_ID = #{zdept_id}
					AND A.ZDEPT_BRCH_ID = #{zdept_brch_id}
					AND A.ZEMP_ID = #{zemp_id}
				</if>
        )
          SELECT ZRMS_YM
 	        	, ZITEM1_S AS ZITEM1_P
            	, ZITEM2_S AS ZITEM2_P
            	, ZITEM3_S AS ZITEM3_P
            	, ZITEM4_S AS ZITEM4_P
            	, ZITEM5_S AS ZITEM5_P
            	, ZITEM6_S AS ZITEM6_P
            	, ZITEM7_S AS ZITEM7_P
                , NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK
                , NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZUP_RANK
          FROM RMS_TOTAL
          
          ORDER BY ZRMS_YM NULLS FIRST
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 현장용 ] 0개월학습 엑셀다운					-->
	<!-- ********************************************** -->
	<resultMap type="exlNstZeroStudyVO" id="exlNstZeroStudy_d">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zregion" 			property="zregion" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_id" 			property="zdept_id" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zdept_team_empid" 	property="zdept_team_empid" />
		<id column="zdept_team_empnm" 	property="zdept_team_empnm" />
		<id column="in_lc_nm" 			property="in_lc_nm" />
		<id column="zemp_id" 			property="zemp_id" />
		<id column="zemp_nm" 			property="zemp_nm" />
		<id column="out_zregion" 		property="out_zregion" />
		<id column="out_zregion_nm" 	property="out_zregion_nm" />
		<id column="out_zdept_id" 		property="out_zdept_id" />
		<id column="out_zdept_nm" 		property="out_zdept_nm" />
		<id column="out_zdept_brch_id" 	property="out_zdept_brch_id" />
		<id column="out_team_empid" 	property="out_team_empid" />
		<id column="out_team_empnm" 	property="out_team_empnm" />
		<id column="out_lc_nm" 			property="out_lc_nm" />
		<id column="out_zemp_id" 		property="out_zemp_id" />
		<id column="out_zemp_nm" 		property="out_zemp_nm" />
		<id column="zgrade_cde" 		property="zgrade_cde" />
		<id column="kunnr" 				property="kunnr" />
		<id column="zmbr_nm" 			property="zmbr_nm" />
		<id column="matnr" 				property="matnr" />
		<id column="matnr_nm" 			property="matnr_nm" />
		<id column="out_post_dt" 		property="out_post_dt" />
		<id column="out_gubun" 			property="out_gubun" />
		<id column="in_post_dt" 		property="in_post_dt" />
		<id column="in_gubun" 			property="in_gubun" />
		<id column="zlastfee_ym" 		property="zlastfee_ym" />
	</resultMap>
	
	<select id="excelNstZeroStudy_d" parameterType="HashMap" resultMap="exlNstZeroStudy_d" > 
        SELECT ZRMS_YM
              , ZREGION
              , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
              , ZDEPT_ID
              , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
              , ZDEPT_BRCH_ID
              , ZDEPT_TEAM_EMPID
              , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZDEPT_TEAM_EMPID AND ROWNUM = 1) AS ZDEPT_TEAM_EMPNM
              , IN_LC_NM
              , ZEMP_ID
              , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
              , OUT_ZREGION
              , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.OUT_ZREGION) AS OUT_ZREGION_NM
              , OUT_ZDEPT_ID
              , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.OUT_ZDEPT_ID) AS OUT_ZDEPT_NM
              , OUT_ZDEPT_BRCH_ID
              , OUT_TEAM_EMPID
              , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.OUT_TEAM_EMPID AND ROWNUM = 1) AS OUT_TEAM_EMPNM
              , OUT_LC_NM
              , OUT_ZEMP_ID
              , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.OUT_ZEMP_ID AND ROWNUM = 1) AS OUT_ZEMP_NM
              , ZGRADE_CDE
              , KUNNR
              , ZMBR_NM
              , MATNR
              , (SELECT MAKTX FROM MAKT WHERE MANDT = '300' AND MATNR = A.MATNR) AS MATNR_NM
              , OUT_POST_DT
              , (SELECT ZCODENM FROM ZSD_COCDT WHERE MANDT = '300' AND ZGRCODE = 'N006' AND ZCODE = A.OUT_GUBUN) AS OUT_GUBUN
              , IN_POST_DT
              , (SELECT ZCODENM FROM ZSD_COCDT WHERE MANDT = '300' AND ZGRCODE = 'N006' AND ZCODE = A.IN_GUBUN) AS IN_GUBUN
              , ZLASTFEE_YM
        FROM ZSD7_RMS_FAKE_D A
		WHERE MANDT = '300'
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802' OR ZREGION = 'T410') -- T410 : 성장사업본부
			</if>
			<if test='active_bcg_id == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			<if test='zregion != null and zregion != ""'>
				AND ZREGION = #{zregion}
			</if>
			<if test='zdept_id != null and zdept_id != ""'>
				AND ZDEPT_ID = #{zdept_id}
			</if>
			<if test='zdept_brch_id != null and zdept_brch_id != ""'>
				AND ZDEPT_BRCH_ID = #{zdept_brch_id}
			</if>
			<if test='zemp_id != null and zemp_id != ""'>
				AND ZEMP_ID = #{zemp_id}
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			<if test='session_zregion_gb == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802')
			</if>
			<if test='session_zregion_gb == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='session_zregion_gb == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			
			<if test="session_zauth_grp == 'NI' or session_zauth_grp == 'NX'">
				AND ZREGION = #{session_zregion}
				<if test='zdept_id != null and zdept_id != ""'>
					AND ZDEPT_ID = #{zdept_id}
				</if>
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if> 
			<if test="session_zauth_grp == 'NC' or session_zauth_grp == 'NE'">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
			<if test="session_zauth_grp == 'NP' ">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				AND ZDEPT_BRCH_ID = #{session_zdept_brch_id}
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
		</if>
		ORDER BY ZRMS_YM DESC, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 관리용 ] 0개월학습 엑셀다운					-->
	<!-- ********************************************** -->
	<resultMap type="exlNstZeroStudyVO" id="exlNstZeroStudy_da">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zregion" 			property="zregion" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_id" 			property="zdept_id" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zdept_team_empid" 	property="zdept_team_empid" />
		<id column="zdept_team_empnm" 	property="zdept_team_empnm" />
		<id column="in_lc_nm" 			property="in_lc_nm" />
		<id column="zemp_id" 			property="zemp_id" />
		<id column="zemp_nm" 			property="zemp_nm" />
		<id column="out_zregion" 		property="out_zregion" />
		<id column="out_zregion_nm" 	property="out_zregion_nm" />
		<id column="out_zdept_id" 		property="out_zdept_id" />
		<id column="out_zdept_nm" 		property="out_zdept_nm" />
		<id column="out_zdept_brch_id" 	property="out_zdept_brch_id" />
		<id column="out_team_empid" 	property="out_team_empid" />
		<id column="out_team_empnm" 	property="out_team_empnm" />
		<id column="out_lc_nm" 			property="out_lc_nm" />
		<id column="out_zemp_id" 		property="out_zemp_id" />
		<id column="out_zemp_nm" 		property="out_zemp_nm" />
		<id column="kunnr" 				property="kunnr" />
		<id column="zmbr_nm" 			property="zmbr_nm" />
		<id column="zgrade_cde" 		property="zgrade_cde" />
		<id column="matnr" 				property="matnr" />
		<id column="matnr_nm" 			property="matnr_nm" />
		<id column="matnr_point" 		property="matnr_point" />
		<id column="out_post_dt" 		property="out_post_dt" />
		<id column="out_gubun" 			property="out_gubun" />
		<id column="in_post_dt" 		property="in_post_dt" />
		<id column="in_gubun" 			property="in_gubun" />
		<id column="ins_zregion" 		property="ins_zregion" />
		<id column="ins_zregion_nm" 	property="ins_zregion_nm" />
		<id column="ins_zdept_id" 		property="ins_zdept_id" />
		<id column="ins_zdept_nm" 		property="ins_zdept_nm" />
		<id column="ins_zdept_brch_id" 	property="ins_zdept_brch_id" />
		<id column="ins_team_empid" 	property="ins_team_empid" />
		<id column="ins_team_empnm" 	property="ins_team_empnm" />
		<id column="ins_zemp_id" 		property="ins_zemp_id" />
		<id column="ins_zemp_nm" 		property="ins_zemp_nm" />
		<id column="trn_matnr" 			property="trn_matnr" />
		<id column="trn_matnr_point" 	property="trn_matnr_point" />
		<id column="zaddr" 				property="zaddr" />
		<id column="zlastfee_ym" 		property="zlastfee_ym" />
		<id column="zbf_matnr_all" 		property="zbf_matnr_all" />
		<id column="matnr_all" 			property="matnr_all" />
		<id column="znew_mem_chk" 		property="znew_mem_chk" />
		<id column="zco_kunnr" 			property="zco_kunnr" />
	</resultMap>
	
	<select id="excelNstZeroStudy_da" parameterType="HashMap" resultMap="exlNstZeroStudy_da" > 
        SELECT ZRMS_YM
              , ZREGION
              , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
              , ZDEPT_ID
              , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
              , ZDEPT_BRCH_ID
              , ZDEPT_TEAM_EMPID
              , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZDEPT_TEAM_EMPID AND ROWNUM = 1) AS ZDEPT_TEAM_EMPNM
              , IN_LC_NM
              , ZEMP_ID
              , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
              , OUT_ZREGION
              , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.OUT_ZREGION) AS OUT_ZREGION_NM
              , OUT_ZDEPT_ID
              , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.OUT_ZDEPT_ID) AS OUT_ZDEPT_NM
              , OUT_ZDEPT_BRCH_ID
              , OUT_TEAM_EMPID
              , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.OUT_TEAM_EMPID AND ROWNUM = 1) AS OUT_TEAM_EMPNM
              , OUT_LC_NM
              , OUT_ZEMP_ID
              , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.OUT_ZEMP_ID AND ROWNUM = 1) AS OUT_ZEMP_NM
              , KUNNR
              , ZMBR_NM
              , ZGRADE_CDE
              , MATNR
              , (SELECT MAKTX FROM MAKT WHERE MANDT = '300' AND MATNR = A.MATNR) AS MATNR_NM
              , MATNR_POINT
              , OUT_POST_DT
              , (SELECT ZCODENM FROM ZSD_COCDT WHERE MANDT = '300' AND ZGRCODE = 'N006' AND ZCODE = A.OUT_GUBUN) AS OUT_GUBUN
              , IN_POST_DT
              , (SELECT ZCODENM FROM ZSD_COCDT WHERE MANDT = '300' AND ZGRCODE = 'N006' AND ZCODE = A.IN_GUBUN) AS IN_GUBUN
              , INS_ZREGION
              , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.INS_ZREGION) AS INS_ZREGION_NM
              , INS_ZDEPT_ID
              , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.INS_ZDEPT_ID) AS INS_ZDEPT_NM
              , INS_ZDEPT_BRCH_ID
              , INS_ZEMP_ID
              , INS_TEAM_EMPID
              , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.INS_TEAM_EMPID AND ROWNUM = 1) AS INS_TEAM_EMPNM
              , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.INS_ZEMP_ID AND ROWNUM = 1) AS INS_ZEMP_NM
              , TRN_MATNR
              , TRN_MATNR_POINT
              , ZADDR
              , ZLASTFEE_YM
              , ZBF_MATNR_ALL
              , MATNR_ALL
              , ZNEW_MEM_CHK
              , ZCO_KUNNR
        FROM ZSD7_RMS_FAKE_DA A
		WHERE MANDT = '300'
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802' OR ZREGION = 'T410') -- T410 : 성장사업본부
			</if>
			<if test='active_bcg_id == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			<if test='zregion != null and zregion != ""'>
				AND ZREGION = #{zregion}
			</if>
			<if test='zdept_id != null and zdept_id != ""'>
				AND ZDEPT_ID = #{zdept_id}
			</if>
			<if test='zdept_brch_id != null and zdept_brch_id != ""'>
				AND ZDEPT_BRCH_ID = #{zdept_brch_id}
			</if>
			<if test='zemp_id != null and zemp_id != ""'>
				AND ZEMP_ID = #{zemp_id}
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			AND 1 = 2
		</if>
		ORDER BY ZRMS_YM DESC, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID
	</select>
	
	<resultMap type="sumMainVO" id="exlSumMainRank">
		<id column="zlevel" 			property="zlevel" />
		<id column="zregion" 			property="zregion" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_id" 			property="zdept_id" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_emp_nm" 		property="zdept_emp_nm" />
		<id column="zbrch_emp_nm" 		property="zbrch_emp_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zdept_brch_nm" 		property="zdept_brch_nm" />
		<id column="rms_arre_r" 		property="rms_arre_r" />
		<id column="rms_card_r" 		property="rms_card_r" />
		<id column="rms_info_r" 		property="rms_info_r" />
		<id column="rms_pay_r" 			property="rms_pay_r" />
		<id column="rms_stmng_r" 		property="rms_stmng_r" />
		<id column="rms_summ_r" 		property="rms_summ_r" />
		<id column="rms_tran_r" 		property="rms_tran_r" />
		<id column="zsub_rank" 			property="zsub_rank" />
		<id column="zup_rank" 			property="zup_rank" />
	</resultMap>
	
	<select id="excelSumMainRank_ind" parameterType="HashMap" resultMap="exlSumMainRank" >
		WITH ORG_NM AS
		(
			 SELECT ZDEPT_ID, ZDEPT_BRCH_ID, ZDUTY_CDE, LISTAGG(ZNM, ',') WITHIN GROUP(ORDER BY ZNM) AS ZNM
			 FROM ZSD7_LOGIN A
			     , ZSD7_ORG_MT B
			 WHERE A.MANDT = '300' 
			 AND A.ZLOCK = '1' 
			 AND B.ZRCD_YM = #{zreq_ym}
			 AND A.MANDT = B.MANDT
			 AND A.KUNNR = B.ZEMP_ID
			 GROUP BY ZDEPT_ID, ZDEPT_BRCH_ID, ZDUTY_CDE
		)
		,RMS_TOTAL AS
		(
		    SELECT A.*
                  , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
                  , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
                  , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
                  , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
                  , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '2' AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID) AS ZBRCH_EMP_NM
                  , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
                  , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
				  , ZADMIN_RANK
				  , ZUP_RANK
		    FROM ZSD7_RMS_TOTAL A
                , (SELECT *
                   FROM ZSD7_RMS_ADMIN_R
                   WHERE MANDT = '300'
                   <choose>
						<when test='brch_gb == "LC"'>
							AND ZLEVEL IN ('1', '3')
						</when>
						<when test='brch_gb == "BL"'>
							AND ZLEVEL IN ('1', '2')
						</when>
						<otherwise>
							<if test='active_bcg_id == "N"'>
								AND ZLEVEL = '99'
							</if>
						</otherwise>
					</choose>
                   ) B
		    WHERE A.MANDT = '300'
		    AND A.ZRMS_YM = #{zreq_ym}
            AND A.MANDT = B.MANDT(+)
            AND A.ZRMS_YM = B.ZRMS_YM(+)
            AND A.ZLEVEL = B.ZLEVEL(+)
            AND A.ZREGION = B.ZREGION(+)
            AND A.ZDEPT_ID = B.ZDEPT_ID(+)
            AND A.ZDEPT_BRCH_ID = B.ZDEPT_BRCH_ID(+)
		    AND (
			        A.ZLEVEL = '1' OR 
			        A.ZLEVEL = '2' OR
			        (A.ZLEVEL = '3' 
			        <if test='brch_gb == "LC"'>
			            AND EXISTS (SELECT 1 FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = TO_CHAR(ADD_MONTHS(TO_DATE(A.ZRMS_YM, 'YYYYMM'), -1), 'YYYYMM') AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID)
			        </if>
			        <if test='brch_gb == "BL"'>   
			            AND NOT EXISTS (SELECT 1 FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID)
			        </if>
			        )
			    )
		    <if test='active_bcg_id == "N"'>
				AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802' OR A.ZREGION = 'T410')
			</if>
			<if test='active_bcg_id == "C"'>
				AND A.ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND A.ZREGION = 'T885'
			</if>
		), RMS_TOTAL_R AS
		(
			SELECT MANDT, ZITEM_RATE, ZITEM_ID
		    FROM ZSD7_RMS_TOTAL_R A
		    WHERE MANDT = '300'
		    AND ZRMS_YM = #{zreq_ym}
           <choose>
				<when test='brch_gb == "LC"'>
					 AND ZLEVEL = '3'
				</when>
				<when test='brch_gb == "BL"'>
					 AND ZLEVEL = '2'
				</when>
				<otherwise>
					<if test='active_bcg_id == "N"'>
						AND ZLEVEL = '99'
					</if>
				</otherwise>
			</choose>
		    <if test='active_bcg_id == "N"'>
				AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802' OR A.ZREGION = 'T410')
			</if>
			<if test='active_bcg_id == "C"'>
				AND A.ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND A.ZREGION = 'T885'
			</if>
		    ORDER BY ZITEM_ID, TO_NUMBER(ZITEM_RANK)
		)
		
		SELECT ZLEVEL
			  , ZREGION
			  , ZREGION_NM
			  , ZDEPT_ID
			  , ZDEPT_EMP_NM
			  , ZDEPT_NM
			  , ZBRCH_EMP_NM
			  , ZDEPT_BRCH_ID
			  , ZDEPT_BRCH_NM
			  , ZITEM1_P AS RMS_INFO_R     
			  , ZITEM2_P AS RMS_CARD_R     
			  , ZITEM3_P AS RMS_TRAN_R     
			  , ZITEM4_P AS RMS_ARRE_R     
			  , ZITEM5_P AS RMS_PAY_R      
			  , ZITEM6_P AS RMS_SUMM_R     
			  , ZITEM7_P AS RMS_STMNG_R    
			  , ZADMIN_RANK1 AS ZSUB_RANK
			  , ZADMIN_RANK2 AS ZUP_RANK
		FROM(
			SELECT *
			FROM(
				-- 상위20%
				SELECT #{zreq_ym} AS ZRMS_YM, 'A' AS ZLEVEL, ' ' AS ZREGION, ' ' AS ZREGION_NM, ' ' AS ZDEPT_ID, ' ' AS ZDEPT_EMP_NM, ' ' AS ZDEPT_NM, ' ' AS ZBRCH_EMP_NM, ' ' AS ZDEPT_BRCH_ID, ' ' AS ZDEPT_BRCH_NM, ' ' AS ZEMP_ID, ' ' AS ZEMP_NM, ' ' AS ZCLS_ID, ' ' AS ZCLS_NM
				    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_info') WHERE RNUM = 
				       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_info')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM1_P
				    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_card') WHERE RNUM = 
				       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_card')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM2_P
				    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_tran') WHERE RNUM = 
				       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_tran')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM3_P
				    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_arre') WHERE RNUM = 
				        ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_arre')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM4_P
				    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_pay') WHERE RNUM = 
				       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_pay')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM5_P
				    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_summ') WHERE RNUM = 
				       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_summ')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM6_P
				    , RTRIM(TO_CHAR(ROUND((SELECT ZITEM_RATE FROM (SELECT ROWNUM AS RNUM, ZITEM_RATE FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_stmng') WHERE RNUM = 
				       ROUND((SELECT COUNT(1) FROM RMS_TOTAL_R WHERE MANDT = '300' AND ZITEM_ID = 'rms_stmng')/100*20) ), 2), 'FM9990.00'), '.') AS ZITEM7_P
				    , ' ' AS ZADMIN_RANK1
				    , ' ' AS ZADMIN_RANK2
	                , 'Y' AS CHECK_GB
				FROM DUAL
			
				UNION ALL
				
				-- 평균
				SELECT #{zreq_ym} AS ZRMS_YM, 'B' AS ZLEVEL, ' ' AS ZREGION, ' ' AS ZREGION_NM, ' ' AS ZDEPT_ID, ' ' AS ZDEPT_EMP_NM, ' ' AS ZDEPT_NM, ' ' AS ZBRCH_EMP_NM, ' ' AS ZDEPT_BRCH_ID, ' ' AS ZDEPT_BRCH_NM, ' ' AS ZEMP_ID, ' ' AS ZEMP_NM, ' ' AS ZCLS_ID, ' ' AS ZCLS_NM
				    , RTRIM(TO_CHAR(ROUND(
	                    CASE 
	                        WHEN SUM(ZITEM1_S) = 0 OR SUM(ZITEM1_T) = 0
	                        THEN 0
	                        ELSE SUM(ZITEM1_S)/SUM(ZITEM1_T)*100
	                    END   
	                , 2), 'FM9990.00'), '.') AS ZITEM1_P
				    , RTRIM(TO_CHAR(ROUND(
	                    CASE 
	                        WHEN SUM(ZITEM2_S) = 0 OR SUM(ZITEM2_T) = 0
	                        THEN 0
	                        ELSE SUM(ZITEM2_S)/SUM(ZITEM2_T)*100
	                    END   
	                , 2), 'FM9990.00'), '.') AS ZITEM2_P
				    , RTRIM(TO_CHAR(ROUND(
	                    CASE 
	                        WHEN SUM(ZITEM3_S) = 0 OR SUM(ZITEM3_T) = 0
	                        THEN 0
	                        ELSE SUM(ZITEM3_S)/SUM(ZITEM3_T)*100
	                    END   
	                , 2), 'FM9990.00'), '.') AS ZITEM3_P
				    , RTRIM(TO_CHAR(ROUND(
	                    CASE 
	                        WHEN SUM(ZITEM4_S) = 0 OR SUM(ZITEM4_T) = 0
	                        THEN 0
	                        ELSE SUM(ZITEM4_S)/SUM(ZITEM4_T)*100
	                    END   
	                , 2), 'FM9990.00'), '.') AS ZITEM4_P
				    , RTRIM(TO_CHAR(ROUND(
	                    CASE 
	                        WHEN SUM(ZITEM5_S) = 0 OR SUM(ZITEM5_T) = 0
	                        THEN 0
	                        ELSE SUM(ZITEM5_S)/SUM(ZITEM5_T)*100
	                    END   
	                , 2), 'FM9990.00'), '.') AS ZITEM5_P
				    , RTRIM(TO_CHAR(ROUND(
	                    CASE 
	                        WHEN SUM(ZITEM6_S) = 0 OR SUM(ZITEM6_T) = 0
	                        THEN 0
	                        ELSE SUM(ZITEM6_S)/SUM(ZITEM6_T)*100
	                    END   
	                , 2), 'FM9990.00'), '.') AS ZITEM6_P
				    , RTRIM(TO_CHAR(ROUND(
	                    CASE 
	                        WHEN SUM(ZITEM7_S) = 0 OR SUM(ZITEM7_T) = 0
	                        THEN 0
	                        ELSE SUM(ZITEM7_S)/SUM(ZITEM7_T)*100
	                    END   
	                , 2), 'FM9990.00'), '.') AS ZITEM7_P
	                , ' ' AS ZADMIN_RANK1
	                , ' ' AS ZADMIN_RANK2
	                , 'Y' AS CHECK_GB
			    FROM RMS_TOTAL A
			    WHERE MANDT = '300'
			    AND ZLEVEL = '1'
			
				UNION ALL
				
				<if test='session_zregion_gb == "A"'>
			    SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
				    , RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
				    , RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
				    , RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
				    , RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
				    , RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
				    , RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
				    , RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
		    		, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
		    		, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
		    		, 'Y' AS CHECK_GB
			    FROM RMS_TOTAL A
			    WHERE MANDT = '300'
			    AND ((ZLEVEL = '1' AND EXISTS (SELECT 1 FROM RMS_TOTAL WHERE MANDT = '300' AND ZRMS_YM = A.ZRMS_YM AND ZLEVEL = '2' AND ZREGION = A.ZREGION)) OR 
				     (ZLEVEL = '2' AND EXISTS (SELECT 1 FROM RMS_TOTAL WHERE MANDT = '300' AND ZRMS_YM = A.ZRMS_YM AND ZLEVEL = '3' AND ZREGION = A.ZREGION AND ZDEPT_ID = A.ZDEPT_ID)) OR
				      ZLEVEL = '3')
				</if>
				<if test='session_zregion_gb != "A"'>
					<if test='session_zauth_grp == "NI" or session_zauth_grp == "NX"'>
					SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
				    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
				    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
				    	 	, DECODE(ZREGION, #{session_zregion}, 'Y', 'N') AS CHECK_GB
					  FROM RMS_TOTAL A
					  WHERE MANDT = '300'
					  AND ZLEVEL = '1'
					  
					  UNION ALL
					  
					  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
				    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
				    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
				    	 	, 'Y' AS CHECK_GB
					  FROM RMS_TOTAL A
					  WHERE MANDT = '300'
					  AND ZLEVEL IN ('2', '3')
					  AND ZREGION = #{session_zregion}
					</if>
					<if test='session_zauth_grp == "NC"'>
					 SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
				    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
				    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
				    	 	, DECODE(ZREGION, #{session_zregion}, 'Y', 'N') AS CHECK_GB
					  FROM RMS_TOTAL A
					  WHERE MANDT = '300'
					  AND ZLEVEL = '1'
					  AND ZREGION = #{session_zregion}
					  
					  UNION ALL
					  
					  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
				    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
				    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
				    	 	, 'Y' AS CHECK_GB
					  FROM RMS_TOTAL A
					  WHERE MANDT = '300'
					  AND ZLEVEL IN ('2', '3')
					  AND ZREGION = #{session_zregion}
					  AND ZDEPT_ID = #{session_zdept_id}
					</if>
					<if test='session_zauth_grp == "NP"'>
					 SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
				    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
				    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
				    	 	, 'Y' AS CHECK_GB
					  FROM RMS_TOTAL A
					  WHERE MANDT = '300'
					  AND ZLEVEL = '1'
					  AND ZREGION = #{session_zregion}
					  
					  UNION ALL
					  
					  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
				    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
				    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
				    	 	, 'Y' AS CHECK_GB
					  FROM RMS_TOTAL A
					  WHERE MANDT = '300'
					  AND ZLEVEL = '2'
					  AND ZREGION = #{session_zregion}
					  AND ZDEPT_ID = #{session_zdept_id}
					  
					  UNION ALL
					  
					  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ROUND(ZITEM1_P, 2)), 'FM9990.00'), '.') AS ZITEM1_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ROUND(ZITEM2_P, 2)), 'FM9990.00'), '.') AS ZITEM2_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ROUND(ZITEM3_P, 2)), 'FM9990.00'), '.') AS ZITEM3_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ROUND(ZITEM4_P, 2)), 'FM9990.00'), '.') AS ZITEM4_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ROUND(ZITEM5_P, 2)), 'FM9990.00'), '.') AS ZITEM5_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ROUND(ZITEM6_P, 2)), 'FM9990.00'), '.') AS ZITEM6_P
				    	 	, RTRIM(TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ROUND(ZITEM7_P, 2)), 'FM9990.00'), '.') AS ZITEM7_P
				    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
				    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
				    	 	, 'Y' AS CHECK_GB
					  FROM RMS_TOTAL A
					  WHERE MANDT = '300'
					  AND ZLEVEL = '3'
					  AND ZREGION = #{session_zregion}
					  AND ZDEPT_ID = #{session_zdept_id}
					</if>
				</if>
			)
			ORDER BY TO_NUMBER(DECODE(TRIM(ZLEVEL), 'A', 0, 'B', 0, (NVL(REPLACE(TRIM(ZADMIN_RANK1), '-', ''), 9999)))), ZREGION, ZDEPT_ID NULLS FIRST, ZDEPT_BRCH_ID NULLS FIRST, ZEMP_ID NULLS FIRST, ZCLS_ID NULLS FIRST, ZLEVEL
		)
		
	</select>
	
	<select id="excelSumMainRank_cnt" parameterType="HashMap" resultMap="exlSumMainRank" > 
		WITH ORG_NM AS
		(
			 SELECT ZDEPT_ID, ZDEPT_BRCH_ID, ZDUTY_CDE, LISTAGG(ZNM, ',') WITHIN GROUP(ORDER BY ZNM) AS ZNM
			 FROM ZSD7_LOGIN A
			     , ZSD7_ORG_MT B
			 WHERE A.MANDT = '300' 
			 AND A.ZLOCK = '1' 
			 AND B.ZRCD_YM = #{zreq_ym}
			 AND A.MANDT = B.MANDT
			 AND A.KUNNR = B.ZEMP_ID
			 GROUP BY ZDEPT_ID, ZDEPT_BRCH_ID, ZDUTY_CDE
		)
		,RMS_TOTAL AS
		(
		    SELECT A.*
                  , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
                  , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '1' AND ZDEPT_ID = A.ZDEPT_ID) AS ZDEPT_EMP_NM
                  , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
                  , NVL((SELECT ZLC_NM FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID), ' ') AS ZDEPT_BRCH_NM
                  , (SELECT ZNM FROM ORG_NM WHERE ZDUTY_CDE = '2' AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID) AS ZBRCH_EMP_NM
                  , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
                  , (SELECT ZCLS_NM FROM ZSD7_CLS WHERE MANDT = '300' AND ZCLS_ID = A.ZCLS_ID) AS ZCLS_NM
				  , ZADMIN_RANK
				  , ZUP_RANK
		    FROM ZSD7_RMS_TOTAL A
                , (SELECT *
                   FROM ZSD7_RMS_ADMIN_R
                   WHERE MANDT = '300'
                   <choose>
						<when test='brch_gb == "LC"'>
							AND ZLEVEL IN ('1', '3')
						</when>
						<when test='brch_gb == "BL"'>
							AND ZLEVEL IN ('1', '2')
						</when>
						<otherwise>
							<if test='active_bcg_id == "N"'>
								AND ZLEVEL = '99'
							</if>
						</otherwise>
					</choose>
                   ) B
		    WHERE A.MANDT = '300'
		    AND A.ZRMS_YM = #{zreq_ym}
            AND A.MANDT = B.MANDT(+)
            AND A.ZRMS_YM = B.ZRMS_YM(+)
            AND A.ZLEVEL = B.ZLEVEL(+)
            AND A.ZREGION = B.ZREGION(+)
            AND A.ZDEPT_ID = B.ZDEPT_ID(+)
            AND A.ZDEPT_BRCH_ID = B.ZDEPT_BRCH_ID(+)
		    AND (
			        A.ZLEVEL = '1' OR 
			        A.ZLEVEL = '2' OR
			        (A.ZLEVEL = '3' 
			        <if test='brch_gb == "LC"'>
			            AND EXISTS (SELECT 1 FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = TO_CHAR(ADD_MONTHS(TO_DATE(A.ZRMS_YM, 'YYYYMM'), -1), 'YYYYMM') AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID)
			        </if>
			        <if test='brch_gb == "BL"'>   
			            AND NOT EXISTS (SELECT 1 FROM ZSD7_LC_ORG_MT WHERE MANDT = '300' AND ZRCD_YM = A.ZRMS_YM AND ZDEPT_ID = A.ZDEPT_ID AND ZDEPT_BRCH_ID = A.ZDEPT_BRCH_ID)
			        </if>
			        )
			    )
		    <if test='active_bcg_id == "N"'>
				AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802' OR A.ZREGION = 'T410')
			</if>
			<if test='active_bcg_id == "C"'>
				AND A.ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND A.ZREGION = 'T885'
			</if>
		), RMS_TOTAL_R AS
		(
			SELECT MANDT, ZITEM_RATE, ZITEM_ID, ZLEVEL, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID
		    FROM ZSD7_RMS_TOTAL_R A
		    WHERE MANDT = '300'
		    AND ZRMS_YM = #{zreq_ym}
           <choose>
				<when test='brch_gb == "LC"'>
					 AND ZLEVEL = '3'
				</when>
				<when test='brch_gb == "BL"'>
					 AND ZLEVEL = '2'
				</when>
				<otherwise>
					<if test='active_bcg_id == "N"'>
						AND ZLEVEL = '99'
					</if>
				</otherwise>
			</choose>
		    <if test='active_bcg_id == "N"'>
				AND (A.ZREGION LIKE 'T3%' OR A.ZREGION = 'T802' OR A.ZREGION = 'T410')
			</if>
			<if test='active_bcg_id == "C"'>
				AND A.ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND A.ZREGION = 'T885'
			</if>
		    ORDER BY ZITEM_ID, TO_NUMBER(ZITEM_RANK)
		)
		SELECT ZLEVEL
			  , ZREGION
			  , ZREGION_NM
			  , ZDEPT_ID
			  , ZDEPT_EMP_NM
			  , ZDEPT_NM
			  , ZBRCH_EMP_NM
			  , ZDEPT_BRCH_ID
			  , ZDEPT_BRCH_NM
			  , TO_CHAR(ZITEM1_S) AS RMS_INFO_R 
			  , TO_CHAR(ZITEM2_S) AS RMS_CARD_R 
			  , TO_CHAR(ZITEM3_S) AS RMS_TRAN_R 
			  , TO_CHAR(ZITEM4_S) AS RMS_ARRE_R 
			  , TO_CHAR(ZITEM5_S) AS RMS_PAY_R  
			  , TO_CHAR(ZITEM6_S) AS RMS_SUMM_R 
			  , TO_CHAR(ZITEM7_S) AS RMS_STMNG_R
			  , ZADMIN_RANK1 AS ZSUB_RANK
			  , ZADMIN_RANK2 AS ZUP_RANK
		FROM(
			-- 상위20%
			SELECT #{zreq_ym} AS ZRMS_YM, 'A' AS ZLEVEL, ' ' AS ZREGION, ' ' AS ZREGION_NM, ' ' AS ZDEPT_ID, ' ' AS ZDEPT_EMP_NM, ' ' AS ZDEPT_NM, ' ' AS ZBRCH_EMP_NM, ' ' AS ZDEPT_BRCH_ID, ' ' AS ZDEPT_BRCH_NM, ' ' AS ZEMP_ID, ' ' AS ZEMP_NM, ' ' AS ZCLS_ID, ' ' AS ZCLS_NM
 				 , TO_CHAR((SELECT (SELECT ZITEM1_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_arre') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_arre')*20/100))) AS ZITEM1_S
         	     , TO_CHAR((SELECT (SELECT ZITEM2_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_card') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_card')*20/100))) AS ZITEM2_S
         	     , TO_CHAR((SELECT (SELECT ZITEM3_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_info') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_info')*20/100))) AS ZITEM3_S
         	     , TO_CHAR((SELECT (SELECT ZITEM4_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_pay') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_pay')*20/100))) AS ZITEM4_S
         	     , TO_CHAR((SELECT (SELECT ZITEM5_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_stmng') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_stmng')*20/100))) AS ZITEM5_S
         	     , TO_CHAR((SELECT (SELECT ZITEM6_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_summ') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_summ')*20/100))) AS ZITEM6_S
         	     , TO_CHAR((SELECT (SELECT ZITEM7_S FROM RMS_TOTAL WHERE ZREGION = TT1.ZREGION AND ZDEPT_ID = TT1.ZDEPT_ID AND ZDEPT_BRCH_ID = TT1.ZDEPT_BRCH_ID) FROM (SELECT ROWNUM AS RNUM, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_tran') TT1 WHERE RNUM = ROUND((SELECT COUNT(*) FROM RMS_TOTAL_R WHERE ZITEM_ID = 'rms_tran')*20/100))) AS ZITEM7_S
			    , ' ' AS ZADMIN_RANK1
			    , ' ' AS ZADMIN_RANK2
                , 'Y' AS CHECK_GB
			FROM DUAL
			
			UNION ALL
			
			<if test='session_zregion_gb == "A"'>
		    SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
				, TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
				, TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
				, TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
				, TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
				, TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
				, TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
				, TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
	    		, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
	    		, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
	    		, 'Y' AS CHECK_GB
		    FROM RMS_TOTAL A
		    WHERE MANDT = '300'
		    AND ((ZLEVEL = '1' AND EXISTS (SELECT 1 FROM RMS_TOTAL WHERE MANDT = '300' AND ZRMS_YM = A.ZRMS_YM AND ZLEVEL = '2' AND ZREGION = A.ZREGION)) OR 
			     (ZLEVEL = '2' AND EXISTS (SELECT 1 FROM RMS_TOTAL WHERE MANDT = '300' AND ZRMS_YM = A.ZRMS_YM AND ZLEVEL = '3' AND ZREGION = A.ZREGION AND ZDEPT_ID = A.ZDEPT_ID)) OR
			      ZLEVEL = '3')
			</if>
			<if test='session_zregion_gb != "A"'>
				<if test='session_zauth_grp == "NI" or session_zauth_grp == "NX"'>
				SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, DECODE(ZREGION, #{session_zregion}, 'Y', 'N') AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  
				  UNION ALL
				  
				  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL IN ('2', '3')
				  AND ZREGION = #{session_zregion}
				</if>
				<if test='session_zauth_grp == "NC"'>
				 SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, DECODE(ZREGION, #{session_zregion}, 'Y', 'N') AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  AND ZREGION = #{session_zregion}
				  
				  UNION ALL
				  
				  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL IN ('2', '3')
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				</if>
				<if test='session_zauth_grp == "NP"'>
				 SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '1'
				  AND ZREGION = #{session_zregion}
				  
				  UNION ALL
				  
				  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '2'
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				  
				  UNION ALL
				  
				  SELECT ZRMS_YM, ZLEVEL, ZREGION, ZREGION_NM, ZDEPT_ID, ZDEPT_EMP_NM, ZDEPT_NM, ZBRCH_EMP_NM, ZDEPT_BRCH_ID, ZDEPT_BRCH_NM, ZEMP_ID, ZEMP_NM, ZCLS_ID, ZCLS_NM
					    , TO_CHAR(DECODE(ZITEM1_S, '-1', '-', ZITEM1_S)) AS ZITEM1_S
					    , TO_CHAR(DECODE(ZITEM2_S, '-1', '-', ZITEM2_S)) AS ZITEM2_S
					    , TO_CHAR(DECODE(ZITEM3_S, '-1', '-', ZITEM3_S)) AS ZITEM3_S
					    , TO_CHAR(DECODE(ZITEM4_S, '-1', '-', ZITEM4_S)) AS ZITEM4_S
					    , TO_CHAR(DECODE(ZITEM5_S, '-1', '-', ZITEM5_S)) AS ZITEM5_S
					    , TO_CHAR(DECODE(ZITEM6_S, '-1', '-', ZITEM6_S)) AS ZITEM6_S
					    , TO_CHAR(DECODE(ZITEM7_S, '-1', '-', ZITEM7_S)) AS ZITEM7_S
			    	 	, NVL(TO_CHAR(ZADMIN_RANK), '-') AS ZADMIN_RANK1
			    	 	, NVL(TO_CHAR(ZUP_RANK), '-') AS ZADMIN_RANK2
			    	 	, 'Y' AS CHECK_GB
				  FROM RMS_TOTAL A
				  WHERE MANDT = '300'
				  AND ZLEVEL = '3'
				  AND ZREGION = #{session_zregion}
				  AND ZDEPT_ID = #{session_zdept_id}
				</if>
			</if>
		)
		ORDER BY TO_NUMBER(DECODE(TRIM(ZLEVEL), 'A', 0, 'B', 0, (NVL(REPLACE(TRIM(ZADMIN_RANK1), '-', ''), 9999)))), ZREGION, ZDEPT_ID NULLS FIRST, ZDEPT_BRCH_ID NULLS FIRST, ZEMP_ID NULLS FIRST, ZCLS_ID NULLS FIRST, ZLEVEL
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 현장용 ] 자동이체중복 엑셀다운				-->
	<!-- ********************************************** -->
	<resultMap type="exlTrsDupVO" id="exlTrsDup_d">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zdept_team_empnm"	property="zdept_team_empnm" />
		<id column="zdept_team_empid"	property="zdept_team_empid" />
		<id column="zemp_nm" 			property="zemp_nm" />
		<id column="zemp_id" 			property="zemp_id" />
		<id column="zmbr_nm" 			property="zmbr_nm" />
		<id column="kunnr" 				property="kunnr" />
		<id column="zgrade_cde" 		property="zgrade_cde" />
		<id column="matnr_nm" 			property="matnr_nm" />
		<id column="matnr" 				property="matnr" />
		<id column="zbank_credc_gb" 	property="zbank_credc_gb" />
		<id column="ztrs_acct_dt" 		property="ztrs_acct_dt" />
		<id column="ztrs_rcpt_amt" 		property="ztrs_rcpt_amt" />
		<id column="zbank_credc_id" 	property="zbank_credc_id" />
		<id column="ztrs_card_bk_no" 	property="ztrs_card_bk_no" />
		<id column="ztrs_rsd_nm" 		property="ztrs_rsd_nm" />
	</resultMap>
	
	<select id="excelTrsDup_d" parameterType="HashMap" resultMap="exlTrsDup_d" > 
		SELECT ZRMS_YM
		     , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
			 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
			 , ZDEPT_BRCH_ID || DECODE(TRIM(ZLC_NM), '', ' ', '(' || ZLC_NM || ')') AS ZDEPT_BRCH_ID
		     , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZDEPT_TEAM_EMPID AND ROWNUM = 1) AS ZDEPT_TEAM_EMPNM
		     , ZDEPT_TEAM_EMPID
		     , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
			 , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		     , ZMBR_NM
		     , KUNNR
		     , ZGRADE_CDE
		     , (SELECT MAKTX FROM MAKT WHERE MANDT = '300' AND MATNR = A.MATNR) AS MATNR_NM
		     , MATNR
		     , DECODE(ZBANK_CREDC_GB, 'C', '카드', 'B', '자동이체') AS ZBANK_CREDC_GB
		     , ZTRS_ACCT_DT
		     , ZTRS_RCPT_AMT
		     , (SELECT ZBANK_CREDC_NM FROM ZSD7_BK_CRDC_ORG WHERE MANDT = '300' AND ZBANK_CREDC_GB = A.ZBANK_CREDC_GB AND ZBANK_CREDC_ID = A.ZBANK_CREDC_ID) AS ZBANK_CREDC_ID
		     , SUBSTR(SCP.DEC_B64('DAMO', 'SID', 'ACCOUNT_CODE', ZTRS_CARD_BK_NO), 0, 4) || '******' || SUBSTR(SCP.DEC_B64('DAMO', 'SID', 'ACCOUNT_CODE', ZTRS_CARD_BK_NO), 13, 4) AS ZTRS_CARD_BK_NO
		     , RPAD(SUBSTR(ZTRS_RSD_NM, 0, 1), LENGTH(ZTRS_RSD_NM), '*') || SUBSTR(ZTRS_RSD_NM, -1) AS ZTRS_RSD_NM
		FROM ZSD7_RMS_TRS_D A
		WHERE MANDT = '300'
		AND ZBIZ_GB = ' ' -- 현장용은 공공지원 포함X
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802' OR ZREGION = 'T410') -- T410 : 성장사업본부
			</if>
			<if test='active_bcg_id == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			<if test='zregion != null and zregion != ""'>
				AND ZREGION = #{zregion}
			</if>
			<if test='zdept_id != null and zdept_id != ""'>
				AND ZDEPT_ID = #{zdept_id}
			</if>
			<if test='zdept_brch_id != null and zdept_brch_id != ""'>
				AND ZDEPT_BRCH_ID = #{zdept_brch_id}
			</if>
			<if test='zemp_id != null and zemp_id != ""'>
				AND ZEMP_ID = #{zemp_id}
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			<if test='session_zregion_gb == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802')
			</if>
			<if test='session_zregion_gb == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='session_zregion_gb == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			
			<if test="session_zauth_grp == 'NI' or session_zauth_grp == 'NX'">
				AND ZREGION = #{session_zregion}
				<if test='zdept_id != null and zdept_id != ""'>
					AND ZDEPT_ID = #{zdept_id}
				</if>
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if> 
			<if test="session_zauth_grp == 'NC' or session_zauth_grp == 'NE'">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
			<if test="session_zauth_grp == 'NP' ">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				AND ZDEPT_BRCH_ID = #{session_zdept_brch_id}
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
		</if>
		ORDER BY ZRMS_YM DESC, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID
	</select>
	
	<!-- ********************************************** -->
	<!-- [ 관리용 ] 자동이체중복 엑셀다운				-->
	<!-- ********************************************** -->
	<resultMap type="exlTrsDupVO" id="exlTrsDup_da">
		<id column="zrms_ym" 			property="zrms_ym" />
		<id column="zregion_nm" 		property="zregion_nm" />
		<id column="zdept_nm" 			property="zdept_nm" />
		<id column="zdept_brch_id" 		property="zdept_brch_id" />
		<id column="zdept_team_empnm"	property="zdept_team_empnm" />
		<id column="zdept_team_empid"	property="zdept_team_empid" />
		<id column="zemp_nm" 			property="zemp_nm" />
		<id column="zemp_id" 			property="zemp_id" />
		<id column="zmbr_nm" 			property="zmbr_nm" />
		<id column="kunnr" 				property="kunnr" />
		<id column="zgrade_cde" 		property="zgrade_cde" />
		<id column="matnr_nm" 			property="matnr_nm" />
		<id column="matnr" 				property="matnr" />
		<id column="zbank_credc_gb" 	property="zbank_credc_gb" />
		<id column="zrcpt_dt_schd" 		property="zrcpt_dt_schd" />
		<id column="ztrs_acct_dt" 		property="ztrs_acct_dt" />
		<id column="ztrs_rcpt_amt" 		property="ztrs_rcpt_amt" />
		<id column="zbank_credc_id" 	property="zbank_credc_id" />
		<id column="ztrs_card_bk_no" 	property="ztrs_card_bk_no" />
		<id column="ztrs_rsd_nm" 		property="ztrs_rsd_nm" />
		<id column="zbiz_gb" 			property="zbiz_gb" />
	</resultMap>
	
	<select id="excelTrsDup_da" parameterType="HashMap" resultMap="exlTrsDup_da" > 
		SELECT ZRMS_YM
		     , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZREGION) AS ZREGION_NM
			 , (SELECT NAME1 FROM ZFIT010 WHERE MANDT = '300' AND BRANCH = A.ZDEPT_ID) AS ZDEPT_NM
			 , ZDEPT_BRCH_ID || DECODE(TRIM(ZLC_NM), '', ' ', '(' || ZLC_NM || ')') AS ZDEPT_BRCH_ID
		     , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZDEPT_TEAM_EMPID AND ROWNUM = 1) AS ZDEPT_TEAM_EMPNM
		     , ZDEPT_TEAM_EMPID
		     , (SELECT ZNM FROM ZSD7_LOGIN WHERE MANDT = '300' AND KUNNR = A.ZEMP_ID AND ROWNUM = 1) AS ZEMP_NM
			 , SUBSTR(ZEMP_ID, 3) AS ZEMP_ID
		     , ZMBR_NM
		     , KUNNR
		     , ZGRADE_CDE
		     , (SELECT MAKTX FROM MAKT WHERE MANDT = '300' AND MATNR = A.MATNR) AS MATNR_NM
		     , MATNR
		     , DECODE(ZBANK_CREDC_GB, 'C', '카드', 'B', '자동이체') AS ZBANK_CREDC_GB
		     , ZRCPT_DT_SCHD
		     , ZTRS_ACCT_DT
		     , ZTRS_RCPT_AMT
		     , (SELECT ZBANK_CREDC_NM FROM ZSD7_BK_CRDC_ORG WHERE MANDT = '300' AND ZBANK_CREDC_GB = A.ZBANK_CREDC_GB AND ZBANK_CREDC_ID = A.ZBANK_CREDC_ID) AS ZBANK_CREDC_ID
		     , SUBSTR(SCP.DEC_B64('DAMO', 'SID', 'ACCOUNT_CODE', ZTRS_CARD_BK_NO), 0, 4) || '******' || SUBSTR(SCP.DEC_B64('DAMO', 'SID', 'ACCOUNT_CODE', ZTRS_CARD_BK_NO), 13, 4) AS ZTRS_CARD_BK_NO
		     , ZTRS_RSD_NM
		     , DECODE(ZBIZ_GB, '1', '공공지원', '2', '단체', '3', 'B2B', '4', '조직원자녀') AS ZBIZ_GB
		FROM ZSD7_RMS_TRS_D A
		WHERE MANDT = '300'
		<if test='session_zregion_gb == "A"'>
			<if test='active_bcg_id == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802' OR ZREGION = 'T410') -- T410 : 성장사업본부
			</if>
			<if test='active_bcg_id == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='active_bcg_id == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			<if test='zregion != null and zregion != ""'>
				AND ZREGION = #{zregion}
			</if>
			<if test='zdept_id != null and zdept_id != ""'>
				AND ZDEPT_ID = #{zdept_id}
			</if>
			<if test='zdept_brch_id != null and zdept_brch_id != ""'>
				AND ZDEPT_BRCH_ID = #{zdept_brch_id}
			</if>
			<if test='zemp_id != null and zemp_id != ""'>
				AND ZEMP_ID = #{zemp_id}
			</if>
		</if>
		<if test='session_zregion_gb != "A"'>
			<if test='session_zregion_gb == "N"'>
				AND (ZREGION LIKE 'T3%' OR ZREGION = 'T802')
			</if>
			<if test='session_zregion_gb == "C"'>
				AND ZREGION = 'T880'
			</if>
			<if test='session_zregion_gb == "S"'>
				AND ZREGION = 'T885'
			</if>
			
			<if test='zreq_ym_a != null and zreq_ym_a != ""'>
				<if test='zreq_ym_b != null and zreq_ym_b != ""'>
					AND ZRMS_YM BETWEEN #{zreq_ym_b} AND #{zreq_ym_a}
				</if>
			</if>
			
			<if test="session_zauth_grp == 'NI' or session_zauth_grp == 'NX'">
				AND ZREGION = #{session_zregion}
				<if test='zdept_id != null and zdept_id != ""'>
					AND ZDEPT_ID = #{zdept_id}
				</if>
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if> 
			<if test="session_zauth_grp == 'NC' or session_zauth_grp == 'NE'">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				<if test='zdept_brch_id != null and zdept_brch_id != ""'>
					AND ZDEPT_BRCH_ID = #{zdept_brch_id}
				</if>
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
			<if test="session_zauth_grp == 'NP' ">
				AND ZREGION = #{session_zregion}
				AND ZDEPT_ID = #{session_zdept_id}
				AND ZDEPT_BRCH_ID = #{session_zdept_brch_id}
				<if test='zemp_id != null and zemp_id != ""'>
					AND ZEMP_ID = #{zemp_id}
				</if>
			</if>
		</if>
		ORDER BY ZRMS_YM DESC, ZREGION, ZDEPT_ID, ZDEPT_BRCH_ID, ZEMP_ID
	</select>

</mapper>
